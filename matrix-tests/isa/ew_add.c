#include "utils.h"
#include <riscv_matrix.h>

static void test_maddu_mm() {
  // uint8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(7);
  const uint8_t u8_src1[] = {43, 45, 7,  22, 44, 47, 24,
                             10, 8,  26, 48, 49, 22, 36};
  const uint8_t u8_src2[] = {40, 35, 13, 19, 21, 41, 31,
                             5,  14, 47, 36, 26, 30, 31};
  const uint8_t u8_ans[] = {83, 80, 20, 41, 65, 88, 55,
                            15, 22, 73, 84, 75, 52, 67};
  muint8m1_t u8_ts1 = mlce8_m1(u8_src1, 7 * sizeof(uint8_t));
  muint8m1_t u8_ts2 = mlce8_m1(u8_src2, 7 * sizeof(uint8_t));
  muint8m1_t u8_out = maddu_mm(u8_ts1, u8_ts2);
  msce8_m(u8_out, u8_buffer, 7 * sizeof(uint8_t));
  EXCEPT_U8_ARRAY_EQ(u8_ans, u8_buffer, 14, "  MADDU.MM UINT8  M1");
  // uint16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(5);
  const uint16_t u16_src1[] = {233, 203, 197, 195, 128, 173, 139, 221,
                               230, 138, 254, 164, 230, 247, 239};
  const uint16_t u16_src2[] = {153, 154, 224, 246, 249, 250, 220, 251,
                               202, 235, 144, 250, 210, 170, 146};
  const uint16_t u16_ans[] = {386, 357, 421, 441, 377, 423, 359, 472,
                              432, 373, 398, 414, 440, 417, 385};
  muint16m1_t u16_ts1 = mlce16_m1(u16_src1, 5 * sizeof(uint16_t));
  muint16m1_t u16_ts2 = mlce16_m1(u16_src2, 5 * sizeof(uint16_t));
  muint16m1_t u16_out = maddu_mm(u16_ts1, u16_ts2);
  msce16_m(u16_out, u16_buffer, 5 * sizeof(uint16_t));
  EXCEPT_U16_ARRAY_EQ(u16_ans, u16_buffer, 15, "  MADDU.MM UINT16 M1");
  // uint32
  msettype(E32, M1, BA);
  msettilemi(3);
  msettileni(4);
  const uint32_t u32_src1[] = {67071479,  214995387, 256629414, 20012980,
                               204067724, 204267011, 62787065,  16926981,
                               34189641,  104540282, 116931175, 13446000};
  const uint32_t u32_src2[] = {96700412, 119969622, 119021257, 95712297,
                               11604944, 138204964, 104320076, 62248569,
                               43491242, 109161149, 191564507, 253914764};
  const uint32_t u32_ans[] = {163771891, 334965009, 375650671, 115725277,
                              215672668, 342471975, 167107141, 79175550,
                              77680883,  213701431, 308495682, 267360764};
  muint32m1_t u32_ts1 = mlce32_m1(u32_src1, 4 * sizeof(uint32_t));
  muint32m1_t u32_ts2 = mlce32_m1(u32_src2, 4 * sizeof(uint32_t));
  muint32m1_t u32_out = maddu_mm(u32_ts1, u32_ts2);
  msce32_m(u32_out, u32_buffer, 4 * sizeof(uint32_t));
  EXCEPT_U32_ARRAY_EQ(u32_ans, u32_buffer, 12, "  MADDU.MM UINT32 M1");
  // int64
  msettype(E64, M1, BA);
  msettilemi(4);
  msettileni(2);
  const uint64_t u64_src1[] = {383322669779901569,  3338125884871015006,
                               1431738439956356114, 3288702792891066236,
                               1485939492977194875, 3221682736631003630,
                               3115294347905528094, 1386940953938899094};
  const uint64_t u64_src2[] = {1471915455470453214, 1793602393825249437,
                               168882268184628631,  1939841490446021379,
                               728113426480206325,  1436129718281632831,
                               1622180687162834541, 990059164535352687};
  const uint64_t u64_ans[] = {1855238125250354783, 5131728278696264443,
                              1600620708140984745, 5228544283337087615,
                              2214052919457401200, 4657812454912636461,
                              4737475035068362635, 2377000118474251781};
  muint64m1_t u64_ts1 = mlce64_m1(u64_src1, 2 * sizeof(uint64_t));
  muint64m1_t u64_ts2 = mlce64_m1(u64_src2, 2 * sizeof(uint64_t));
  muint64m1_t u64_out = maddu_mm(u64_ts1, u64_ts2);
  msce64_m(u64_out, u64_buffer, 2 * sizeof(uint64_t));
  EXCEPT_U64_ARRAY_EQ(u64_ans, u64_buffer, 8, "  MADDU.MM UINT64 M1");
  // M2
  // uint8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(20);
  const uint8_t u8_src1_m2[] = {14, 89, 65, 30, 90, 49, 51, 7,  28, 3,
                                80, 56, 77, 24, 35, 18, 20, 56, 70, 67,
                                71, 73, 44, 63, 2,  85, 32, 88, 26, 27,
                                8,  84, 44, 16, 54, 22, 37, 6,  2,  7};
  const uint8_t u8_src2_m2[] = {69, 18, 22, 53, 83, 22, 24, 90, 89, 54,
                                92, 95, 25, 90, 19, 21, 13, 38, 52, 33,
                                91, 93, 12, 93, 1,  93, 70, 62, 67, 99,
                                2,  76, 78, 31, 49, 52, 24, 99, 65, 25};
  const uint8_t u8_ans_m2[] = {83,  107, 87,  83,  173, 71,  75,  97,  117, 57,
                               172, 151, 102, 114, 54,  39,  33,  94,  122, 100,
                               162, 166, 56,  156, 3,   178, 102, 150, 93,  126,
                               10,  160, 122, 47,  103, 74,  61,  105, 67,  32};
  muint8m2_t u8_ts1_m2 = mlce8_m2(u8_src1_m2, 20 * sizeof(uint8_t));
  muint8m2_t u8_ts2_m2 = mlce8_m2(u8_src2_m2, 20 * sizeof(uint8_t));
  muint8m2_t u8_out_m2 = maddu_mm(u8_ts1_m2, u8_ts2_m2);
  msce8_m(u8_out_m2, u8_buffer, 20 * sizeof(uint8_t));
  EXCEPT_U8_ARRAY_EQ(u8_ans_m2, u8_buffer, 2 * 20, "  MADDU.MM UINT8  M2");
  // uint16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(10);
  const uint16_t u16_src1_m2[] = {
      94,  64,  232, 224, 65, 97, 222, 183, 167, 143, 126, 244, 51,  115, 53,
      230, 176, 124, 122, 44, 4,  110, 63,  50,  147, 243, 6,   129, 6,   18};
  const uint16_t u16_src2_m2[] = {
      216, 13,  205, 95,  254, 220, 253, 210, 45, 205, 213, 103, 230, 145, 233,
      169, 203, 28,  239, 187, 152, 191, 128, 58, 143, 86,  165, 70,  102, 228};
  const uint16_t u16_ans_m2[] = {310, 77,  437, 319, 319, 317, 475, 393,
                                 212, 348, 339, 347, 281, 260, 286, 399,
                                 379, 152, 361, 231, 156, 301, 191, 108,
                                 290, 329, 171, 199, 108, 246};
  muint16m2_t u16_ts1_m2 = mlce16_m2(u16_src1_m2, 10 * sizeof(uint16_t));
  muint16m2_t u16_ts2_m2 = mlce16_m2(u16_src2_m2, 10 * sizeof(uint16_t));
  muint16m2_t u16_out_m2 = maddu_mm(u16_ts1_m2, u16_ts2_m2);
  msce16_m(u16_out_m2, u16_buffer, 10 * sizeof(uint16_t));
  EXCEPT_U16_ARRAY_EQ(u16_ans_m2, u16_buffer, 3 * 10, " MADDU.MM UINT16 M2");
  // uint32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(6);
  const uint32_t u32_src1_m2[] = {
      124932, 124128, 97956,  98478,  84876,  119253, 89746,  88686,
      72337,  87802,  124924, 67519,  79766,  121433, 121877, 114285,
      95466,  114609, 126396, 123457, 130290, 114866, 94888,  69388};
  const uint32_t u32_src2_m2[] = {102038, 84017, 77731,  99926,  81949,  106709,
                                  82727,  70489, 70015,  100441, 76147,  92528,
                                  93751,  89521, 72345,  96419,  79376,  102850,
                                  81531,  78890, 125623, 82390,  103420, 66499};
  const uint32_t u32_ans_m2[] = {
      226970, 208145, 175687, 198404, 166825, 225962, 172473, 159175,
      142352, 188243, 201071, 160047, 173517, 210954, 194222, 210704,
      174842, 217459, 207927, 202347, 255913, 197256, 198308, 135887};
  muint32m2_t u32_ts1_m2 = mlce32_m2(u32_src1_m2, 6 * sizeof(uint32_t));
  muint32m2_t u32_ts2_m2 = mlce32_m2(u32_src2_m2, 6 * sizeof(uint32_t));
  muint32m2_t u32_out_m2 = maddu_mm(u32_ts1_m2, u32_ts2_m2);
  msce32_m(u32_out_m2, u32_buffer, 6 * sizeof(uint32_t));
  EXCEPT_U32_ARRAY_EQ(u32_ans_m2, u32_buffer, 4 * 6, " MADDU.MM UINT32 M2");
  // int64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const uint64_t u64_src1_m2[] = {
      4668035561, 4756017879, 5004659102, 8065591832, 5787988829,
      7211537883, 8054027911, 5256306565, 5539130784, 5818203168,
      5727353337, 5808299727, 6607480204, 4298045620, 4987007215,
      6187927024, 6705413448, 7977414768, 7161108993, 7623286354};
  const uint64_t u64_src2_m2[] = {
      6465181971, 6191146527, 5556345346, 6687485546, 4677895383,
      8442285892, 5416105264, 6386753637, 8452497956, 5366765920,
      6472638309, 8206071917, 7588485835, 7147672189, 7470770695,
      5199679985, 5977404381, 4936912870, 5906756723, 5846229946};
  const uint64_t u64_ans_m2[] = {
      11133217532, 10947164406, 10561004448, 14753077378, 10465884212,
      15653823775, 13470133175, 11643060202, 13991628740, 11184969088,
      12199991646, 14014371644, 14195966039, 11445717809, 12457777910,
      11387607009, 12682817829, 12914327638, 13067865716, 13469516300};
  muint64m2_t u64_ts1_m2 = mlce64_m2(u64_src1_m2, 4 * sizeof(uint64_t));
  muint64m2_t u64_ts2_m2 = mlce64_m2(u64_src2_m2, 4 * sizeof(uint64_t));
  muint64m2_t u64_out_m2 = maddu_mm(u64_ts1_m2, u64_ts2_m2);
  msce64_m(u64_out_m2, u64_buffer, 4 * sizeof(uint64_t));
  EXCEPT_U64_ARRAY_EQ(u64_ans_m2, u64_buffer, 5 * 4, " MADDU.MM UINT64 M2");
  // M4
  // uint8
  msettype(E8, M4, BA);
  msettilemi(2);
  msettileni(34);
  const uint8_t u8_src1_m4[] = {
      4,  20, 72, 36, 80, 37, 69, 93, 30, 44, 34, 74, 36, 92, 35, 94, 88,
      78, 7,  68, 64, 31, 34, 45, 49, 76, 6,  46, 90, 22, 69, 65, 48, 48,
      78, 20, 9,  37, 49, 26, 76, 37, 15, 62, 32, 58, 37, 92, 76, 11, 17,
      43, 77, 22, 31, 9,  0,  38, 59, 93, 75, 43, 91, 9,  83, 96, 84, 72};
  const uint8_t u8_src2_m4[] = {
      15, 62, 7,  0,  45, 77, 21, 52, 84, 76, 99, 96, 95, 51, 63, 41, 93,
      19, 20, 20, 12, 27, 34, 32, 0,  5,  45, 34, 56, 29, 48, 74, 50, 31,
      87, 76, 12, 79, 84, 33, 51, 85, 13, 24, 89, 1,  54, 17, 61, 73, 33,
      73, 94, 79, 20, 9,  95, 79, 89, 85, 62, 74, 33, 99, 96, 40, 58, 8};
  const uint8_t u8_ans_m4[] = {
      19,  82,  79,  36,  125, 114, 90,  145, 114, 120, 133, 170, 131, 143,
      98,  135, 181, 97,  27,  88,  76,  58,  68,  77,  49,  81,  51,  80,
      146, 51,  117, 139, 98,  79,  165, 96,  21,  116, 133, 59,  127, 122,
      28,  86,  121, 59,  91,  109, 137, 84,  50,  116, 171, 101, 51,  18,
      95,  117, 148, 178, 137, 117, 124, 108, 179, 136, 142, 80};
  muint8m4_t u8_ts1_m4 = mlce8_m4(u8_src1_m4, 34 * sizeof(uint8_t));
  muint8m4_t u8_ts2_m4 = mlce8_m4(u8_src2_m4, 34 * sizeof(uint8_t));
  muint8m4_t u8_out_m4 = maddu_mm(u8_ts1_m4, u8_ts2_m4);
  msce8_m(u8_out_m4, u8_buffer, 34 * sizeof(uint8_t));
  EXCEPT_U8_ARRAY_EQ(u8_ans_m4, u8_buffer, 2 * 34, " MADDU.MM UINT8  M4");
  // uint16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(18);
  const uint16_t u16_src1_m4[] = {
      12585, 4693,  4163,  7480,  7214,  17462, 9008,  2502,  9698,
      14558, 8262,  20662, 1298,  6461,  23031, 15596, 1450,  17910,
      10409, 16249, 14438, 19036, 8715,  8238,  20841, 9531,  15383,
      2629,  24088, 12028, 2205,  19114, 8055,  9322,  4240,  10760,
      14229, 5304,  23718, 13549, 17635, 3707,  5177,  19135, 24255,
      19916, 18423, 19435, 752,   16266, 16456, 2318,  13379, 7420};
  const uint16_t u16_src2_m4[] = {
      17364, 6307,  20857, 24463, 11376, 21184, 16848, 22244, 5489,
      15638, 14368, 9399,  345,   14273, 3107,  14625, 1717,  16100,
      8436,  1190,  2860,  9234,  4582,  1763,  6929,  9199,  6135,
      19750, 23432, 14245, 17283, 5086,  24999, 20388, 6302,  14310,
      25319, 16742, 6395,  13665, 14711, 391,   2754,  1666,  20165,
      13453, 1007,  12031, 8958,  3100,  7109,  22880, 10266, 10426};
  const uint16_t u16_ans_m4[] = {
      29949, 11000, 25020, 31943, 18590, 38646, 25856, 24746, 15187,
      30196, 22630, 30061, 1643,  20734, 26138, 30221, 3167,  34010,
      18845, 17439, 17298, 28270, 13297, 10001, 27770, 18730, 21518,
      22379, 47520, 26273, 19488, 24200, 33054, 29710, 10542, 25070,
      39548, 22046, 30113, 27214, 32346, 4098,  7931,  20801, 44420,
      33369, 19430, 31466, 9710,  19366, 23565, 25198, 23645, 17846};
  muint16m4_t u16_ts1_m4 = mlce16_m4(u16_src1_m4, 18 * sizeof(uint16_t));
  muint16m4_t u16_ts2_m4 = mlce16_m4(u16_src2_m4, 18 * sizeof(uint16_t));
  muint16m4_t u16_out_m4 = maddu_mm(u16_ts1_m4, u16_ts2_m4);
  msce16_m(u16_out_m4, u16_buffer, 18 * sizeof(uint16_t));
  EXCEPT_U16_ARRAY_EQ(u16_ans_m4, u16_buffer, 3 * 18, " MADDU.MM UINT16 M4");
  // uint32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(10);
  const uint32_t u32_src1_m4[] = {
      1633377, 4305348, 4284781, 341799,  4081363, 355788,  6036076, 555655,
      5981421, 3097454, 3547309, 2022936, 2220700, 1833820, 322082,  2580335,
      2187090, 5912200, 1401941, 3916181, 2056862, 231817,  1648190, 2015148,
      2212127, 1315961, 4730215, 6443490, 5908121, 4733733, 5008498, 4579128,
      4094983, 311167,  216758,  1269857, 1450411, 2621353, 642361,  4425154};
  const uint32_t u32_src2_m4[] = {
      6287441, 3739581, 2792934, 941508,  4178917, 6027006, 1730496, 2148890,
      729375,  3509387, 3933356, 5611741, 3414178, 1060346, 381558,  5532149,
      6071843, 2712226, 406231,  1817006, 1584127, 1294111, 2995964, 1850652,
      2683949, 4633837, 2641303, 2881954, 2249737, 415746,  1786967, 6060845,
      6288124, 1881360, 5801766, 5804012, 1716495, 4832046, 150168,  6065745};
  const uint32_t u32_ans_m4[] = {
      7920818,  8044929, 7077715, 1283307, 8260280, 6382794, 7766572, 2704545,
      6710796,  6606841, 7480665, 7634677, 5634878, 2894166, 703640,  8112484,
      8258933,  8624426, 1808172, 5733187, 3640989, 1525928, 4644154, 3865800,
      4896076,  5949798, 7371518, 9325444, 8157858, 5149479, 6795465, 10639973,
      10383107, 2192527, 6018524, 7073869, 3166906, 7453399, 792529,  10490899};
  muint32m4_t u32_ts1_m4 = mlce32_m4(u32_src1_m4, 10 * sizeof(uint32_t));
  muint32m4_t u32_ts2_m4 = mlce32_m4(u32_src2_m4, 10 * sizeof(uint32_t));
  muint32m4_t u32_out_m4 = maddu_mm(u32_ts1_m4, u32_ts2_m4);
  msce32_m(u32_out_m4, u32_buffer, 10 * sizeof(uint32_t));
  EXCEPT_U32_ARRAY_EQ(u32_ans_m4, u32_buffer, 4 * 10, " MADDU.MM UINT32 M4");
  // int64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(6);
  const uint64_t u64_src1_m4[] = {
      243126687683, 228161630958, 299210790854, 173468154411, 35347645341,
      192745678958, 78071789841,  109149708126, 292231147319, 396943421956,
      232458112322, 80725213541,  154174465738, 280926383191, 370364511615,
      60527752869,  101447354248, 390355987180, 10447900349,  257704500265,
      61970850179,  234044096210, 82164990825,  187308948074, 174241161386,
      372946962727, 94813911508,  275723904552, 146794069643, 377617931397};
  const uint64_t u64_src2_m4[] = {
      310419291031, 245396136226, 263810927328, 14738714585,  241749891571,
      11624353898,  421862736430, 127753437825, 109083706140, 329752093791,
      65079289046,  411137778665, 224410915605, 422730476117, 106683087121,
      310436879809, 327954757756, 382040485961, 118509788301, 348286661313,
      413749053317, 334494510715, 224598064246, 349930611117, 196146572390,
      305845446262, 162522493030, 291107593972, 416737943953, 353859294044};
  const uint64_t u64_ans_m4[] = {
      553545978714, 473557767184, 563021718182, 188206868996, 277097536912,
      204370032856, 499934526271, 236903145951, 401314853459, 726695515747,
      297537401368, 491862992206, 378585381343, 703656859308, 477047598736,
      370964632678, 429402112004, 772396473141, 128957688650, 605991161578,
      475719903496, 568538606925, 306763055071, 537239559191, 370387733776,
      678792408989, 257336404538, 566831498524, 563532013596, 731477225441};
  muint64m4_t u64_ts1_m4 = mlce64_m4(u64_src1_m4, 6 * sizeof(uint64_t));
  muint64m4_t u64_ts2_m4 = mlce64_m4(u64_src2_m4, 6 * sizeof(uint64_t));
  muint64m4_t u64_out_m4 = maddu_mm(u64_ts1_m4, u64_ts2_m4);
  msce64_m(u64_out_m4, u64_buffer, 6 * sizeof(uint64_t));
  EXCEPT_U64_ARRAY_EQ(u64_ans_m4, u64_buffer, 5 * 6, " MADDU.MM UINT64 M4");
}

static void test_madd_mm() {
  // M1
  // int8
  msettype(E8, M1, BA);
  msettilemi(3);
  msettileni(5);
  const int8_t i8_src1[] = {3, 1, 3, 1, 5, 2, -3, 0, 4, -6, -3, 1, 1, 1, -6};
  const int8_t i8_src2[] = {-1, 6, -1, -6, 0,  -8, 3, 2,
                            3,  1, 3,  -8, -6, -8, -7};
  const int8_t i8_ans[] = {2, 7, 2, -5, 5, -6, 0, 2, 7, -5, 0, -7, -5, -7, -13};
  mint8m1_t i8_ts1 = mlce8_m1(i8_src1, 5 * sizeof(int8_t));
  mint8m1_t i8_ts2 = mlce8_m1(i8_src2, 5 * sizeof(int8_t));
  mint8m1_t i8_out = madd_mm(i8_ts1, i8_ts2);
  msce8_m(i8_out, i8_buffer, 5 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans, i8_buffer, 15, " MADD.MM  INT8   M1");
  // int16
  msettype(E16, M1, BA);
  msettilemi(2);
  msettileni(7);
  const int16_t i16_src1[] = {841,  831, 734,  -729, 78,   -246, -96,
                              -645, 139, -595, -148, -852, 760,  -507};
  const int16_t i16_src2[] = {-554, 51,  -729, 529,  -43,  990,  -566,
                              -132, 389, -455, -395, -915, -136, -620};
  const int16_t i16_ans[] = {287,  882, 5,     -200, 35,    744, -662,
                             -777, 528, -1050, -543, -1767, 624, -1127};
  mint16m1_t i16_ts1 = mlce16_m1(i16_src1, 7 * sizeof(int16_t));
  mint16m1_t i16_ts2 = mlce16_m1(i16_src2, 7 * sizeof(int16_t));
  mint16m1_t i16_out = madd_mm(i16_ts1, i16_ts2);
  msce16_m(i16_out, i16_buffer, 7 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans, i16_buffer, 14, " MADD.MM  INT16  M1");
  // int32
  msettype(E32, M1, BA);
  msettilemi(6);
  msettileni(2);
  const int32_t i32_src1[] = {6480, 6894, -2327, 1435, 4823,  -2890,
                              7602, 4914, 5496,  2781, -3690, 1414};
  const int32_t i32_src2[] = {-5526, 1986, 6667, 9211,  4230,  8311,
                              -1225, 9018, -160, -5570, -9783, 9497};
  const int32_t i32_ans[] = {954,  8880,  4340, 10646, 9053,   5421,
                             6377, 13932, 5336, -2789, -13473, 10911};
  mint32m1_t i32_ts1 = mlce32_m1(i32_src1, 2 * sizeof(int32_t));
  mint32m1_t i32_ts2 = mlce32_m1(i32_src2, 2 * sizeof(int32_t));
  mint32m1_t i32_out = madd_mm(i32_ts1, i32_ts2);
  msce32_m(i32_out, i32_buffer, 2 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans, i32_buffer, 12, " MADD.MM  INT32  M1");
  // int64
  msettype(E64, M1, BA);
  msettilemi(3);
  msettileni(2);
  const int64_t i64_src1[] = {73860661116012776,  10571542802871856,
                              8803382633303340,   137316402710326456,
                              163143090173676705, 52360584838692445};
  const int64_t i64_src2[] = {-144292917563725837, -136033611258666548,
                              214864728194509944,  -180392864092058939,
                              -116026454683576354, -159432962971347539};
  const int64_t i64_ans[] = {-70432256447713061, -125462068455794692,
                             223668110827813284, -43076461381732483,
                             47116635490100351,  -107072378132655094};
  mint64m1_t i64_ts1 = mlce64_m1(i64_src1, 2 * sizeof(int64_t));
  mint64m1_t i64_ts2 = mlce64_m1(i64_src2, 2 * sizeof(int64_t));
  mint64m1_t i64_out = madd_mm(i64_ts1, i64_ts2);
  msce64_m(i64_out, i64_buffer, 2 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans, i64_buffer, 6, " MADD.MM  INT64  M1");
  // M2
  // int8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const int8_t i8_src1_m2[] = {
      -3, 0,  4, 6,  7,   -10, -10, -12, -8,  0, -5, 0,   -6,  11,  10,  -12,
      -6, -2, 5, -6, -11, 2,   4,   11,  1,   7, 1,  -10, 7,   -11, -12, -9,
      1,  -4, 1, -1, -4,  4,   -12, -3,  1,   6, -2, -2,  11,  6,   -12, 8,
      5,  -8, 7, -6, 3,   -7,  -4,  7,   -11, 8, 5,  7,   -10, 0,   8,   10};
  const int8_t i8_src2_m2[] = {
      1,  0,   -11, 10, -8, 8,   3,  -5,  11, -2, 10,  3,   4,  8,  0,  4,
      8,  8,   -11, 3,  -3, 11,  -7, -10, -9, 1,  -11, 10,  4,  2,  8,  -7,
      9,  -10, -7,  0,  0,  -10, 3,  -8,  6,  -9, -12, -9,  5,  -8, 3,  8,
      11, -3,  -3,  -4, -6, 10,  -4, 4,   9,  9,  -2,  -10, -7, -5, -7, 11};
  const int8_t i8_ans_m2[] = {
      -2, 0,   -7, 16,  -1,  -2, -7, -17, 3,  -2, 5,   3,   -2,  19, 10, -8,
      2,  6,   -6, -3,  -14, 13, -3, 1,   -8, 8,  -10, 0,   11,  -9, -4, -16,
      10, -14, -6, -1,  -4,  -6, -9, -11, 7,  -3, -14, -11, 16,  -2, -9, 16,
      16, -11, 4,  -10, -3,  3,  -8, 11,  -2, 17, 3,   -3,  -17, -5, 1,  21};
  mint8m2_t i8_ts1_m2 = mlce8_m2(i8_src1_m2, 32 * sizeof(int8_t));
  mint8m2_t i8_ts2_m2 = mlce8_m2(i8_src2_m2, 32 * sizeof(int8_t));
  mint8m2_t i8_out_m2 = madd_mm(i8_ts1_m2, i8_ts2_m2);
  msce8_m(i8_out_m2, i8_buffer, 32 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m2, i8_buffer, 2 * 32, " MADD.MM  INT8   M2");
  // int16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const int16_t i16_src1_m2[] = {
      -1772, 9311,   1221,  -8086,  5199,  379,    6987,  -3838, 11694, 4508,
      9973,  -5019,  -1049, -5176,  -4034, -10042, 6381,  -3555, -7814, 7288,
      -5481, -6306,  7598,  -7867,  11472, -7800,  -4407, -4136, 799,   -12548,
      5790,  8541,   -7410, 10764,  8537,  -3724,  11888, -104,  1193,  -7906,
      11838, -10581, 11935, -11282, -2306, -388,   -8440, -10530};
  const int16_t i16_src2_m2[] = {
      -11840, -1391, -5981, 1506,  10626,  -3901, -11042, 5432,  3824,  6110,
      -4366,  6677,  6199,  -6334, -3207,  -2578, -4927,  11442, 8842,  -7538,
      -1332,  4256,  -1773, -304,  4296,   7428,  3459,   9062,  -5277, -6224,
      -1425,  12572, -666,  1808,  5876,   -6891, 5019,   -3255, -7641, -5159,
      -2468,  4021,  -5173, -7742, -12377, -3195, 3515,   -6186};
  const int16_t i16_ans_m2[] = {
      -13612, 7920,  -4760, -6580,  15825,  -3522,  -4055, 1594,  15518, 10618,
      5607,   1658,  5150,  -11510, -7241,  -12620, 1454,  7887,  1028,  -250,
      -6813,  -2050, 5825,  -8171,  15768,  -372,   -948,  4926,  -4478, -18772,
      4365,   21113, -8076, 12572,  14413,  -10615, 16907, -3359, -6448, -13065,
      9370,   -6560, 6762,  -19024, -14683, -3583,  -4925, -16716};
  mint16m2_t i16_ts1_m2 = mlce16_m2(i16_src1_m2, 16 * sizeof(int16_t));
  mint16m2_t i16_ts2_m2 = mlce16_m2(i16_src2_m2, 16 * sizeof(int16_t));
  mint16m2_t i16_out_m2 = madd_mm(i16_ts1_m2, i16_ts2_m2);
  msce16_m(i16_out_m2, i16_buffer, 16 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m2, i16_buffer, 3 * 16, " MADD.MM  INT16  M2");
  // int32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const int32_t i32_src1_m2[] = {
      1529611,  458185,   -1057900, 810452,   1833518, -1143569, 2524632,
      1640788,  -2635870, 2146446,  -1304385, 2568667, -2559263, -943711,
      -2868554, -2802502, -1458186, 2396797,  -132079, -332678,  1917525,
      725591,   2839119,  1519087,  -632445,  269076,  -165328,  1077245,
      -2783484, -3053669, -831221,  1400004};
  const int32_t i32_src2_m2[] = {
      -1475374, -3195766, -3197477, 1279861,  2568356,  -2127299, -2887952,
      1785806,  -32684,   -2504078, 832649,   1135658,  751836,   -32222,
      -1865743, 715847,   -1010549, 979390,   3083195,  2053053,  3079226,
      3231027,  2486653,  3132259,  -2893851, -2054845, 2946527,  3272998,
      2684439,  -1643560, 109227,   -2423195};
  const int32_t i32_ans_m2[] = {
      54237,    -2737581, -4255377, 2090313,  4401874,  -3270868, -363320,
      3426594,  -2668554, -357632,  -471736,  3704325,  -1807427, -975933,
      -4734297, -2086655, -2468735, 3376187,  2951116,  1720375,  4996751,
      3956618,  5325772,  4651346,  -3526296, -1785769, 2781199,  4350243,
      -99045,   -4697229, -721994,  -1023191};
  mint32m2_t i32_ts1_m2 = mlce32_m2(i32_src1_m2, 8 * sizeof(int32_t));
  mint32m2_t i32_ts2_m2 = mlce32_m2(i32_src2_m2, 8 * sizeof(int32_t));
  mint32m2_t i32_out_m2 = madd_mm(i32_ts1_m2, i32_ts2_m2);
  msce32_m(i32_out_m2, i32_buffer, 8 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m2, i32_buffer, 4 * 8, " MADD.MM  INT32  M2");
  // int64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const int64_t i64_src1_m2[] = {
      190492800115, 170409604108,  -62498994736,  183816937211,  4154744227,
      205987560917, -138190021223, -213617105152, -105106437030, -107014101067,
      -55253970692, 122783212564,  -76639791577,  -95221180846,  -212342774788,
      14102252237,  -107934127196, -24694924583,  -26344157966,  145963131519};
  const int64_t i64_src2_m2[] = {
      -187570122115, -125546322699, 81875978809,  19387184553,   166425461208,
      130526416255,  198220950671,  -2986101693,  -166966119723, -94825097644,
      -71451673485,  188678997244,  28289280088,  -13726857216,  -146392269750,
      -182620107337, -205150434822, -11362236752, 157879723295,  -193199021942};
  const int64_t i64_ans_m2[] = {
      2922678000,    44863281409,   19376984073,   203204121764,  170580205435,
      336513977172,  60030929448,   -216603206845, -272072556753, -201839198711,
      -126705644177, 311462209808,  -48350511489,  -108948038062, -358735044538,
      -168517855100, -313084562018, -36057161335,  131535565329,  -47235890423};
  mint64m2_t i64_ts1_m2 = mlce64_m2(i64_src1_m2, 4 * sizeof(int64_t));
  mint64m2_t i64_ts2_m2 = mlce64_m2(i64_src2_m2, 4 * sizeof(int64_t));
  mint64m2_t i64_out_m2 = madd_mm(i64_ts1_m2, i64_ts2_m2);
  msce64_m(i64_out_m2, i64_buffer, 4 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m2, i64_buffer, 5 * 4, " MADD.MM  INT64  M2");
  // M4
  // int8
  msettype(E8, M4, BA);
  msettilemi(2);
  msettileni(64);
  const int8_t i8_src1_m4[] = {
      0,  -11, -9, -8,  -4,  5,   -3,  -4,  7,   7,   -8,  6,   1,  3,   -7,
      -7, -3,  -3, -10, 10,  -1,  5,   2,   11,  8,   6,   -11, 10, 5,   -3,
      1,  10,  11, 7,   11,  -7,  -11, 8,   -10, 6,   11,  -3,  -1, -6,  -12,
      -7, -3,  5,  -10, -1,  -4,  7,   1,   -4,  -10, -10, -8,  -2, -6,  6,
      7,  2,   2,  10,  -4,  -1,  -10, 9,   11,  -5,  11,  -6,  7,  -11, -12,
      2,  10,  -4, 10,  -6,  2,   -1,  4,   -6,  -8,  -7,  -10, -2, 0,   -7,
      2,  -4,  11, 7,   -10, -10, 2,   -9,  -11, -2,  -7,  -3,  3,  -4,  -1,
      11, -5,  -9, -5,  -11, -1,  8,   -12, -3,  10,  -12, -3,  -8, -4,  2,
      9,  -10, -7, -3,  -5,  1,   1,   7};
  const int8_t i8_src2_m4[] = {
      -10, 6,  5,   2,   7,   -7,  6,   4,   6,  -12, -8,  7,   0,   10,  0,
      -11, -8, 0,   6,   -8,  -9,  5,   1,   0,  -9,  -10, 2,   -10, -11, -7,
      0,   8,  -8,  -12, 7,   10,  -12, 2,   0,  6,   0,   -2,  -4,  -5,  1,
      1,   6,  11,  9,   9,   7,   -4,  -10, -7, -5,  -3,  -12, 10,  -10, -7,
      5,   6,  5,   -6,  -8,  -8,  9,   4,   -5, 4,   -10, -7,  -9,  3,   6,
      -11, -6, -5,  0,   -12, -2,  -3,  7,   -1, -5,  8,   0,   0,   -2,  4,
      -7,  3,  -12, 4,   11,  -10, 5,   -7,  10, 3,   -2,  -8,  3,   0,   5,
      7,   -6, 3,   -12, 8,   6,   -9,  4,   5,  9,   4,   8,   8,   10,  -12,
      -9,  -9, 6,   1,   9,   10,  -12, 9};
  const int8_t i8_ans_m4[] = {
      -10, -5,  -4, -6,  3,   -2,  3,   0,   13,  -5,  -16, 13,  1,  13,  -7,
      -18, -11, -3, -4,  2,   -10, 10,  3,   11,  -1,  -4,  -9,  0,  -6,  -10,
      1,   18,  3,  -5,  18,  3,   -23, 10,  -10, 12,  11,  -5,  -5, -11, -11,
      -6,  3,   16, -1,  8,   3,   3,   -9,  -11, -15, -13, -20, 8,  -16, -1,
      12,  8,   7,  4,   -12, -9,  -1,  13,  6,   -1,  1,   -13, -2, -8,  -6,
      -9,  4,   -9, 10,  -18, 0,   -4,  11,  -7,  -13, 1,   -10, -2, -2,  -3,
      -5,  -1,  -1, 11,  1,   -20, 7,   -16, -1,  1,   -9,  -11, 6,  -4,  4,
      18,  -11, -6, -17, -3,  5,   -1,  -8,  2,   19,  -8,  5,   0,  6,   -10,
      0,   -19, -1, -2,  4,   11,  -11, 16};
  mint8m4_t i8_ts1_m4 = mlce8_m4(i8_src1_m4, 64 * sizeof(int8_t));
  mint8m4_t i8_ts2_m4 = mlce8_m4(i8_src2_m4, 64 * sizeof(int8_t));
  mint8m4_t i8_out_m4 = madd_mm(i8_ts1_m4, i8_ts2_m4);
  msce8_m(i8_out_m4, i8_buffer, 64 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m4, i8_buffer, 2 * 64, " MADD.MM  INT8   M4");
  // int16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(32);
  const int16_t i16_src1_m4[] = {
      -1104, -370, 780,   -545, 956,   -194,  29,   -209, 1110,  -846, -218,
      -1107, -868, -1126, 1025, 33,    -73,   -290, -965, 643,   190,  639,
      -620,  326,  1164,  -53,  -304,  483,   -408, 737,  33,    -40,  -941,
      -377,  -262, 247,   -116, 8,     -1096, -567, -164, -99,   511,  790,
      893,   923,  69,    7,    -1251, 1075,  294,  560,  -1188, 169,  140,
      -781,  58,   268,   -810, -1111, -92,   -16,  -305, -724,  -704, -1074,
      -1032, 1228, -175,  511,  -272,  -934,  8,    617,  416,   -464, -663,
      40,    18,   703,   -169, 738,   1079,  -166, -457, -182,  855,  -1280,
      -1050, -37,  798,   191,  -719,  108,   -29,  -840};
  const int16_t i16_src2_m4[] = {
      -76,   480,   1096, 704,   -45,   -1128, -1279, 1261, -205,  1104, -81,
      1173,  1258,  851,  687,   884,   956,   369,   689,  -160,  -954, 808,
      782,   -1187, -388, -83,   -1036, -23,   62,    -838, -703,  -79,  -580,
      -1163, -622,  1035, -718,  1174,  565,   955,   953,  -683,  -158, 597,
      -1273, -1241, 812,  229,   -704,  944,   458,   1234, -740,  111,  -421,
      -471,  -149,  952,  -591,  -1015, -1022, 281,   842,  -213,  156,  -584,
      829,   -12,   -166, -527,  -341,  851,   1164,  -209, 568,   526,  944,
      -1239, -375,  -775, 1258,  -857,  -96,   571,   101,  -1174, -138, 713,
      1016,  705,   -526, -1081, 1178,  -198,  129,   -692};
  const int16_t i16_ans_m4[] = {
      -1180, 110,  1876, 159,   911,   -1322, -1250, 1052, 905,   258,  -299,
      66,    390,  -275, 1712,  917,   883,   79,    -276, 483,   -764, 1447,
      162,   -861, 776,  -136,  -1340, 460,   -346,  -101, -670,  -119, -1521,
      -1540, -884, 1282, -834,  1182,  -531,  388,   789,  -782,  353,  1387,
      -380,  -318, 881,  236,   -1955, 2019,  752,   1794, -1928, 280,  -281,
      -1252, -91,  1220, -1401, -2126, -1114, 265,   537,  -937,  -548, -1658,
      -203,  1216, -341, -16,   -613,  -83,   1172,  408,  984,   62,   281,
      -1199, -357, -72,  1089,  -119,  983,   405,   -356, -1356, 717,  -567,
      -34,   668,  272,  -890,  459,   -90,   100,   -1532};
  mint16m4_t i16_ts1_m4 = mlce16_m4(i16_src1_m4, 32 * sizeof(int16_t));
  mint16m4_t i16_ts2_m4 = mlce16_m4(i16_src2_m4, 32 * sizeof(int16_t));
  mint16m4_t i16_out_m4 = madd_mm(i16_ts1_m4, i16_ts2_m4);
  msce16_m(i16_out_m4, i16_buffer, 32 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m4, i16_buffer, 3 * 32, " MADD.MM  INT16  M4");
  // int32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(16);
  const int32_t i32_src1_m4[] = {
      -10259,  314090,  -277602, 142941,  -131584, 155138,  -307590, -13779,
      270403,  -172178, 198113,  -146608, 144437,  287027,  -9713,   -225640,
      -145303, 36009,   -321987, -110781, 81913,   210912,  -42154,  -63778,
      106457,  -107408, 196671,  319976,  13636,   -235250, -68334,  150827,
      -223411, 194071,  256956,  46174,   11618,   296646,  -66647,  325081,
      163561,  247478,  -149497, 208757,  88222,   277095,  34445,   -21510,
      287986,  144208,  190984,  -230885, 303382,  174535,  -184450, -280716,
      -20720,  -141568, 220936,  244913,  -158538, -285907, -76515,  -268796};
  const int32_t i32_src2_m4[] = {
      24075,   266801,  33380,   -103833, -108433, 67979,   -322159, 15625,
      -290114, -256219, -303882, 108893,  201093,  -218558, 133536,  -180638,
      -301982, 11033,   -6149,   -175604, -48557,  -159666, -106838, 251371,
      -100789, -41623,  140726,  100437,  268908,  -80014,  -276170, -32247,
      -42435,  126,     212568,  125349,  -224401, 303786,  -197565, 155100,
      230159,  -181483, -320082, -154070, 111248,  -17576,  -6677,   288351,
      152461,  -32995,  -66192,  -43277,  266029,  270868,  -203691, -72104,
      147251,  185418,  -295720, 278496,  245633,  -55294,  -71333,  224091};
  const int32_t i32_ans_m4[] = {
      13816,   580891,  -244222, 39108,   -240017, 223117,  -629749, 1846,
      -19711,  -428397, -105769, -37715,  345530,  68469,   123823,  -406278,
      -447285, 47042,   -328136, -286385, 33356,   51246,   -148992, 187593,
      5668,    -149031, 337397,  420413,  282544,  -315264, -344504, 118580,
      -265846, 194197,  469524,  171523,  -212783, 600432,  -264212, 480181,
      393720,  65995,   -469579, 54687,   199470,  259519,  27768,   266841,
      440447,  111213,  124792,  -274162, 569411,  445403,  -388141, -352820,
      126531,  43850,   -74784,  523409,  87095,   -341201, -147848, -44705};
  mint32m4_t i32_ts1_m4 = mlce32_m4(i32_src1_m4, 16 * sizeof(int32_t));
  mint32m4_t i32_ts2_m4 = mlce32_m4(i32_src2_m4, 16 * sizeof(int32_t));
  mint32m4_t i32_out_m4 = madd_mm(i32_ts1_m4, i32_ts2_m4);
  msce32_m(i32_out_m4, i32_buffer, 16 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m4, i32_buffer, 4 * 16, " MADD.MM  INT32  M4");
  // int64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(8);
  const int64_t i64_src1_m4[] = {
      4691049140,   -7352728300,  1747364810,   -14541433875, -6019967876,
      10193907193,  5219270617,   -17465474468, -3250816187,  7355396000,
      -16207781132, 16588681464,  17754023351,  1339926713,   -1045471897,
      -6155184849,  -16923802529, -11790899086, 14396672454,  17669442061,
      -18465579549, -8095650888,  -4484913569,  -7329454220,  3506064689,
      -20332116294, -13578510358, -6923562659,  8821040569,   -20911418763,
      8011319945,   6662355030,   7110957712,   1369340300,   17640270295,
      18452398187,  8572396074,   -18589536382, 323972456,    2384947639};
  const int64_t i64_src2_m4[] = {
      6812714969,   12021321281,  -7319986292,  10776751302,  6904609026,
      2982985835,   3259071282,   17071946061,  13396052199,  8691247900,
      -17753547033, -2311928882,  20386949405,  17111104670,  4387489716,
      12325419958,  9322199869,   140720063,    14531646967,  13173202558,
      4601929705,   15892018710,  -5706878246,  7857629496,   12508335554,
      -11496897548, 5165921580,   -20137390615, -129358043,   5960257871,
      11709215313,  12877573031,  4282940672,   -13636429751, 9289665491,
      -10286015434, -13223811122, -11714903657, 13705494151,  -17454720704};
  const int64_t i64_ans_m4[] = {
      11503764109,  4668592981,  -5572621482,  -3764682573,  884641150,
      13176893028,  8478341899,  -393528407,   10145236012,  16046643900,
      -33961328165, 14276752582, 38140972756,  18451031383,  3342017819,
      6170235109,   -7601602660, -11650179023, 28928319421,  30842644619,
      -13863649844, 7796367822,  -10191791815, 528175276,    16014400243,
      -31829013842, -8412588778, -27060953274, 8691682526,   -14951160892,
      19720535258,  19539928061, 11393898384,  -12267089451, 26929935786,
      8166382753,   -4651415048, -30304440039, 14029466607,  -15069773065};
  mint64m4_t i64_ts1_m4 = mlce64_m4(i64_src1_m4, 8 * sizeof(int64_t));
  mint64m4_t i64_ts2_m4 = mlce64_m4(i64_src2_m4, 8 * sizeof(int64_t));
  mint64m4_t i64_out_m4 = madd_mm(i64_ts1_m4, i64_ts2_m4);
  msce64_m(i64_out_m4, i64_buffer, 8 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m4, i64_buffer, 5 * 8, " MADD.MM  INT64  M4");
}

static void test_msadd_mm() {
  // M1
  // int8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(5);
  const int8_t i8_src1[] = {-128, -128, -128, 127,  127,
                            127,  127,  127,  -128, -128};
  const int8_t i8_src2[] = {-128, -128, -128, 127,  127,
                            127,  127,  127,  -128, -128};
  const int8_t i8_ans[] = {-128, -128, -128, 127,  127,
                           127,  127,  127,  -128, -128};
  mint8m1_t i8_ts1 = mlce8_m1(i8_src1, 5 * sizeof(int8_t));
  mint8m1_t i8_ts2 = mlce8_m1(i8_src2, 5 * sizeof(int8_t));
  mint8m1_t i8_out = msadd_mm(i8_ts1, i8_ts2);
  msce8_m(i8_out, i8_buffer, 5 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans, i8_buffer, 10, " MSADD.MM INT8   M1");
  // int16
  msettype(E16, M1, BA);
  msettilemi(6);
  msettileni(3);
  const int16_t i16_src1[] = {32767,  32767,  32767,  32767,  32767,  32767,
                              -32768, -32768, -32768, -32768, -32768, -32768,
                              32767,  32767,  32767,  32767,  32767,  32767};
  const int16_t i16_src2[] = {32767,  32767,  32767,  32767,  32767,  32767,
                              -32768, -32768, -32768, -32768, -32768, -32768,
                              32767,  32767,  32767,  32767,  32767,  32767};
  const int16_t i16_ans[] = {32767,  32767,  32767,  32767,  32767,  32767,
                             -32768, -32768, -32768, -32768, -32768, -32768,
                             32767,  32767,  32767,  32767,  32767,  32767};
  mint16m1_t i16_ts1 = mlce16_m1(i16_src1, 3 * sizeof(int16_t));
  mint16m1_t i16_ts2 = mlce16_m1(i16_src2, 3 * sizeof(int16_t));
  mint16m1_t i16_out = msadd_mm(i16_ts1, i16_ts2);
  msce16_m(i16_out, i16_buffer, 3 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans, i16_buffer, 18, " MSADD.MM INT16  M1");
  // int32
  msettype(E32, M1, BA);
  msettilemi(3);
  msettileni(3);
  const int32_t i32_src1[] = {-2147483648, -2147483648, -2147483648,
                              2147483647,  2147483647,  2147483647,
                              -2147483648, -2147483648, -2147483648};
  const int32_t i32_src2[] = {-2147483648, -2147483648, -2147483648,
                              2147483647,  2147483647,  2147483647,
                              -2147483648, -2147483648, -2147483648};
  const int32_t i32_ans[] = {-2147483648, -2147483648, -2147483648,
                             2147483647,  2147483647,  2147483647,
                             -2147483648, -2147483648, -2147483648};
  mint32m1_t i32_ts1 = mlce32_m1(i32_src1, 3 * sizeof(int32_t));
  mint32m1_t i32_ts2 = mlce32_m1(i32_src2, 3 * sizeof(int32_t));
  mint32m1_t i32_out = msadd_mm(i32_ts1, i32_ts2);
  msce32_m(i32_out, i32_buffer, 3 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans, i32_buffer, 9, " MSADD.MM INT32  M1");
  // int64
  msettype(E64, M1, BA);
  msettilemi(2);
  msettileni(2);
  const int64_t i64_src1[] = {-9223372036854775808, -9223372036854775808,
                              9223372036854775807, 9223372036854775807};
  const int64_t i64_src2[] = {-9223372036854775808, -9223372036854775808,
                              9223372036854775807, 9223372036854775807};
  const int64_t i64_ans[] = {-9223372036854775808, -9223372036854775808,
                             9223372036854775807, 9223372036854775807};
  mint64m1_t i64_ts1 = mlce64_m1(i64_src1, 2 * sizeof(int64_t));
  mint64m1_t i64_ts2 = mlce64_m1(i64_src2, 2 * sizeof(int64_t));
  mint64m1_t i64_out = msadd_mm(i64_ts1, i64_ts2);
  msce64_m(i64_out, i64_buffer, 2 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans, i64_buffer, 4, " MSADD.MM INT64  M1");
  // M2
  // int8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const int8_t i8_src1_m2[] = {
      120, 82,  51,   34,  -43, 58,  32,   -1,  -114, -99, -4,   -97, -66,
      -50, 110, 39,   -62, 121, 41,  -119, -36, -104, 100, 40,   86,  96,
      106, 79,  22,   66,  -63, -82, 123,  89,  -2,   62,  120,  123, -119,
      13,  -88, 65,   -34, 104, 66,  -118, 65,  -93,  -72, -17,  86,  79,
      46,  96,  -113, -69, -31, -20, 64,   -86, -8,   55,  -127, -16};
  const int8_t i8_src2_m2[] = {
      -25,  33,   35,  -14, 106,  124,  -23,  -20, -33, -25, -19, 107,  49,
      -100, -117, 1,   126, 52,   -66,  102,  87,  0,   74,  75,  -103, -55,
      -6,   -97,  -38, -67, -101, -74,  108,  -46, 102, -35, -69, 9,    -46,
      64,   -81,  120, 12,  -116, -117, -121, -89, 56,  -26, -74, 99,   -47,
      80,   116,  -3,  32,  122,  -99,  40,   -70, -83, -58, -83, 63};
  const int8_t i8_ans_m2[] = {
      95,  115,  86,   20,  63,   127,  9,   -21,  -128, -124, -23,
      10,  -17,  -128, -7,  40,   64,   127, -25,  -17,  51,   -104,
      127, 115,  -17,  41,  100,  -18,  -16, -1,   -128, -128, 127,
      43,  100,  27,   51,  127,  -128, 77,  -128, 127,  -22,  -12,
      -51, -128, -24,  -37, -98,  -91,  127, 32,   126,  127,  -116,
      -37, 91,   -119, 104, -128, -91,  -3,  -128, 47};
  mint8m2_t i8_ts1_m2 = mlce8_m2(i8_src1_m2, 32 * sizeof(int8_t));
  mint8m2_t i8_ts2_m2 = mlce8_m2(i8_src2_m2, 32 * sizeof(int8_t));
  mint8m2_t i8_out_m2 = msadd_mm(i8_ts1_m2, i8_ts2_m2);
  msce8_m(i8_out_m2, i8_buffer, 32 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m2, i8_buffer, 2 * 32, " MSADD.MM INT8   M2");
  // int16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const int16_t i16_src1_m2[] = {
      12729,  21826,  29182, -9001,  14648,  6466,   28694,  16846,
      -30855, -8517,  17801, -12063, -11153, 26612,  25104,  5058,
      6029,   -25255, 2939,  27362,  -26803, 11499,  -10409, 7343,
      -17787, 14532,  7707,  -31828, -23073, 7737,   -16894, -10344,
      -6032,  -22598, 105,   -20215, -16817, -12155, 15934,  -24634,
      -2607,  32192,  6185,  16679,  6991,   30451,  18206,  -1569};
  const int16_t i16_src2_m2[] = {
      -2944,  16148,  5902,   -29484, -12002, -1895,  -10411, -24552,
      16494,  15015,  18860,  -25131, -30592, -21905, -12703, -17045,
      20045,  -4201,  14534,  30723,  2716,   138,    5470,   -12701,
      -10162, -24296, -15803, -19719, 10985,  -28760, 5194,   2399,
      16225,  12313,  -31147, -25979, 2629,   16407,  5494,   -10046,
      13683,  9260,   -15797, -12124, 20832,  3444,   -32243, -21162};
  const int16_t i16_ans_m2[] = {
      9785,   32767,  32767,  -32768, 2646,   4571,   18283,  -7706,
      -14361, 6498,   32767,  -32768, -32768, 4707,   12401,  -11987,
      26074,  -29456, 17473,  32767,  -24087, 11637,  -4939,  -5358,
      -27949, -9764,  -8096,  -32768, -12088, -21023, -11700, -7945,
      10193,  -10285, -31042, -32768, -14188, 4252,   21428,  -32768,
      11076,  32767,  -9612,  4555,   27823,  32767,  -14037, -22731};
  mint16m2_t i16_ts1_m2 = mlce16_m2(i16_src1_m2, 16 * sizeof(int16_t));
  mint16m2_t i16_ts2_m2 = mlce16_m2(i16_src2_m2, 16 * sizeof(int16_t));
  mint16m2_t i16_out_m2 = msadd_mm(i16_ts1_m2, i16_ts2_m2);
  msce16_m(i16_out_m2, i16_buffer, 16 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m2, i16_buffer, 3 * 16, " MSADD.MM INT16  M2");
  // int32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const int32_t i32_src1_m2[] = {
      91849032,   1544360132,  1531949136,  18402433,    265761002,
      -523109663, 1863052413,  -1328536649, -2044956059, -868191705,
      1092372167, -444274674,  -1218379485, 1827533397,  667597068,
      1256435210, 1237367804,  -887370831,  -7808686,    -1859560198,
      -474411814, 1222682255,  -340134066,  -1695491074, 518220884,
      -953306827, -1790338916, -745787483,  -42020683,   -969536204,
      21780322,   -1036983681};
  const int32_t i32_src2_m2[] = {
      -1058583859, 66140103,    -351796931,  915821280,   -793449946,
      958645192,   -397335686,  -1486282175, -1527757737, -245330377,
      -1209454667, -1602830295, -5472421,    1769543217,  220616787,
      1848078369,  1547831560,  -947615172,  -1588522951, 1530830206,
      -1424214457, 1727568224,  623076849,   -423051222,  1512255240,
      530118493,   -1232001230, 1419047265,  -98049227,   1190785690,
      1660888784,  -1449638308};
  const int32_t i32_ans_m2[] = {
      -966734827,  1610500235,  1180152205,  934223713,   -527688944,
      435535529,   1465716727,  -2147483648, -2147483648, -1113522082,
      -117082500,  -2047104969, -1223851906, 2147483647,  888213855,
      2147483647,  2147483647,  -1834986003, -1596331637, -328729992,
      -1898626271, 2147483647,  282942783,   -2118542296, 2030476124,
      -423188334,  -2147483648, 673259782,   -140069910,  221249486,
      1682669106,  -2147483648};
  mint32m2_t i32_ts1_m2 = mlce32_m2(i32_src1_m2, 8 * sizeof(int32_t));
  mint32m2_t i32_ts2_m2 = mlce32_m2(i32_src2_m2, 8 * sizeof(int32_t));
  mint32m2_t i32_out_m2 = msadd_mm(i32_ts1_m2, i32_ts2_m2);
  msce32_m(i32_out_m2, i32_buffer, 8 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m2, i32_buffer, 4 * 8, " MSADD.MM INT32  M2");
  // int64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const int64_t i64_src1_m2[] = {
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807,  -9223372036854775808,
      -9223372036854775808, 9223372036854775807,  9223372036854775807,
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807};
  const int64_t i64_src2_m2[] = {
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807,  -9223372036854775808,
      -9223372036854775808, 9223372036854775807,  9223372036854775807,
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807};
  const int64_t i64_ans_m2[] = {
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807,  -9223372036854775808,
      -9223372036854775808, 9223372036854775807,  9223372036854775807,
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807};
  mint64m2_t i64_ts1_m2 = mlce64_m2(i64_src1_m2, 4 * sizeof(int64_t));
  mint64m2_t i64_ts2_m2 = mlce64_m2(i64_src2_m2, 4 * sizeof(int64_t));
  mint64m2_t i64_out_m2 = msadd_mm(i64_ts1_m2, i64_ts2_m2);
  msce64_m(i64_out_m2, i64_buffer, 4 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m2, i64_buffer, 5 * 4, " MSADD.MM INT64  M2");
  // M4
  // int8
  msettype(E8, M4, BA);
  msettilemi(2);
  msettileni(33);
  const int8_t i8_src1_m4[] = {
      115, 89,  34,  -79,  -125, -74,  -55, -34, -23,  -80,  -73,
      -7,  -55, 9,   -104, 75,   -16,  -7,  124, 23,   15,   -3,
      86,  -48, 23,  18,   69,   -108, 106, 14,  45,   97,   -88,
      82,  89,  -89, -51,  -55,  86,   -94, -84, -30,  -57,  3,
      -14, -68, 17,  111,  56,   115,  103, 111, -100, -118, 42,
      96,  -34, -98, -30,  -114, 66,   116, -8,  116,  95,   113};
  const int8_t i8_src2_m4[] = {
      105,  15,   73,  -74, 85,   99,  -56, -105, -103, 19,   -85,
      -74,  125,  107, -86, 14,   -37, 68,  -35,  108,  -14,  -29,
      -57,  122,  42,  -62, -112, -12, -78, 77,   -85,  -94,  66,
      -119, -108, -2,  -25, 119,  -81, 105, 102,  4,    7,    -51,
      -25,  -18,  9,   -91, -122, -41, -65, -123, 37,   54,   99,
      50,   48,   -7,  -85, 85,   23,  27,  -85,  116,  -126, 53};
  const int8_t i8_ans_m4[] = {
      127, 104, 107,  -128, -40, 25,   -111, -128, -126, -61, -128,
      -81, 70,  116,  -128, 89,  -53,  61,   89,   127,  1,   -32,
      29,  74,  65,   -44,  -43, -120, 28,   91,   -40,  3,   -22,
      -37, -19, -91,  -76,  64,  5,    11,   18,   -26,  -50, -48,
      -39, -86, 26,   20,   -66, 74,   38,   -12,  -63,  -64, 127,
      127, 14,  -105, -115, -29, 89,   127,  -93,  127,  -31, 127};
  mint8m4_t i8_ts1_m4 = mlce8_m4(i8_src1_m4, 33 * sizeof(int8_t));
  mint8m4_t i8_ts2_m4 = mlce8_m4(i8_src2_m4, 33 * sizeof(int8_t));
  mint8m4_t i8_out_m4 = msadd_mm(i8_ts1_m4, i8_ts2_m4);
  msce8_m(i8_out_m4, i8_buffer, 33 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m4, i8_buffer, 2 * 33, " MSADD.MM INT8   M4");
  // int16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(17);
  const int16_t i16_src1_m4[] = {
      17416,  8422,  25731,  -26531, 32559,  18723,  -25529, 17164,  -26995,
      -22827, 9443,  6310,   9437,   22552,  -23101, 15984,  -20066, -17620,
      -28536, 30941, -24777, 17874,  17740,  10281,  -25507, 25355,  -27252,
      10744,  3119,  29682,  -6250,  29926,  16599,  -14315, -23534, -26950,
      13703,  23787, 25723,  7314,   -17635, -28211, 22381,  -15452, 25535,
      -21537, 812,   -28153, 4805,   16220,  12971};
  const int16_t i16_src2_m4[] = {
      -14508, 10183,  -25546, 5947,   18909,  5394,  -9530,  14506,  5503,
      -22091, -28105, -28824, -7819,  29858,  1270,  -7825,  -25800, 29739,
      17800,  -24888, 21163,  -29330, -10153, 13687, 23842,  -5754,  -11081,
      -16014, 681,    -14113, -14581, 14177,  -2513, -4781,  13185,  11498,
      13420,  15326,  13026,  625,    17614,  -7322, -13088, 23687,  17713,
      -27586, 27916,  -6436,  7963,   14344,  -12143};
  const int16_t i16_ans_m4[] = {
      2908,   18605,  185,    -20584, 32767, 24117,  -32768, 31670,  -21492,
      -32768, -18662, -22514, 1618,   32767, -21831, 8159,   -32768, 12119,
      -10736, 6053,   -3614,  -11456, 7587,  23968,  -1665,  19601,  -32768,
      -5270,  3800,   15569,  -20831, 32767, 14086,  -19096, -10349, -15452,
      27123,  32767,  32767,  7939,   -21,   -32768, 9293,   8235,   32767,
      -32768, 28728,  -32768, 12768,  30564, 828};
  mint16m4_t i16_ts1_m4 = mlce16_m4(i16_src1_m4, 17 * sizeof(int16_t));
  mint16m4_t i16_ts2_m4 = mlce16_m4(i16_src2_m4, 17 * sizeof(int16_t));
  mint16m4_t i16_out_m4 = msadd_mm(i16_ts1_m4, i16_ts2_m4);
  msce16_m(i16_out_m4, i16_buffer, 17 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m4, i16_buffer, 3 * 17, " MSADD.MM INT16  M4");
  // int32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(9);
  const int32_t i32_src1_m4[] = {
      1800646476,  -1569242319, -242939134,  367478274,   457373821,
      -1758281552, -1318025118, 1070985655,  691789575,   -1141892469,
      1216238564,  -359866813,  -12619612,   -1592126996, 187990213,
      698312776,   642989946,   -2079718442, 552564459,   190139537,
      1892744554,  -548585096,  -506153795,  -2015509641, 677812178,
      421989229,   -135766768,  -1893211603, 730355520,   -1936042039,
      -1038940911, 2126694772,  -1927647939, 1386483582,  -1052382059,
      766009548};
  const int32_t i32_src2_m4[] = {
      5651140,     2095617888,  -1930630187, 1777703873, 287486028,
      1239363837,  36941383,    -1220206544, 1104416445, 1077462408,
      -1271937500, -1779285626, -1637221596, 422185957,  -2099336037,
      -2004971503, 2022480476,  -203649336,  804891037,  1947802619,
      -545740431,  249056761,   -1792436009, -33446786,  -880654339,
      -687410195,  -1170909307, 1164253259,  1595383601, 1649064157,
      1442412637,  -1006364981, -1146457813, -759141552, 890581789,
      1848626895};
  const int32_t i32_ans_m4[] = {
      1806297616,  526375569,   -2147483648, 2145182147,  744859849,
      -518917715,  -1281083735, -149220889,  1796206020,  -64430061,
      -55698936,   -2139152439, -1649841208, -1169941039, -1911345824,
      -1306658727, 2147483647,  -2147483648, 1357455496,  2137942156,
      1347004123,  -299528335,  -2147483648, -2048956427, -202842161,
      -265420966,  -1306676075, -728958344,  2147483647,  -286977882,
      403471726,   1120329791,  -2147483648, 627342030,   -161800270,
      2147483647};
  mint32m4_t i32_ts1_m4 = mlce32_m4(i32_src1_m4, 9 * sizeof(int32_t));
  mint32m4_t i32_ts2_m4 = mlce32_m4(i32_src2_m4, 9 * sizeof(int32_t));
  mint32m4_t i32_out_m4 = msadd_mm(i32_ts1_m4, i32_ts2_m4);
  msce32_m(i32_out_m4, i32_buffer, 9 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m4, i32_buffer, 4 * 9, " MSADD.MM INT32  M4");
  // int64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(5);
  const int64_t i64_src1_m4[] = {
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807,  -9223372036854775808,
      -9223372036854775808, 9223372036854775807,  9223372036854775807,
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807};
  const int64_t i64_src2_m4[] = {
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807,  -9223372036854775808,
      -9223372036854775808, 9223372036854775807,  9223372036854775807,
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807};
  const int64_t i64_ans_m4[] = {
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807,  -9223372036854775808,
      -9223372036854775808, 9223372036854775807,  9223372036854775807,
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      -9223372036854775808, -9223372036854775808, 9223372036854775807,
      9223372036854775807};
  mint64m4_t i64_ts1_m4 = mlce64_m4(i64_src1_m4, 5 * sizeof(int64_t));
  mint64m4_t i64_ts2_m4 = mlce64_m4(i64_src2_m4, 5 * sizeof(int64_t));
  mint64m4_t i64_out_m4 = msadd_mm(i64_ts1_m4, i64_ts2_m4);
  msce64_m(i64_out_m4, i64_buffer, 5 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m4, i64_buffer, 5 * 5, " MSADD.MM INT64  M4");
}

static void test_msaddu_mm() {
  // M1
  // uint8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(5);
  const uint8_t u8_src1[] = {0, 0, 0, 0, 0, 255, 255, 255, 255, 255};
  const uint8_t u8_src2[] = {0, 0, 0, 0, 0, 255, 255, 255, 255, 255};
  const uint8_t u8_ans[] = {0, 0, 0, 0, 0, 255, 255, 255, 255, 255};
  muint8m1_t u8_ts1 = mlce8_m1(u8_src1, 5 * sizeof(uint8_t));
  muint8m1_t u8_ts2 = mlce8_m1(u8_src2, 5 * sizeof(uint8_t));
  muint8m1_t u8_out = msaddu_mm(u8_ts1, u8_ts2);
  msce8_m(u8_out, u8_buffer, 5 * sizeof(uint8_t));
  EXCEPT_U8_ARRAY_EQ(u8_ans, u8_buffer, 10, " MSADDU.MM UINT8  M1");
  // uint16
  msettype(E16, M1, BA);
  msettilemi(6);
  msettileni(3);
  const uint16_t u16_src1[] = {65535, 65535, 65535, 65535, 65535, 65535,
                               0,     0,     0,     0,     0,     0,
                               65535, 65535, 65535, 65535, 65535, 65535};
  const uint16_t u16_src2[] = {65535, 65535, 65535, 65535, 65535, 65535,
                               123,   0,     4321,  0,     0,     0,
                               65535, 65535, 65535, 65535, 65535, 65535};
  const uint16_t u16_ans[] = {65535, 65535, 65535, 65535, 65535, 65535,
                              123,   0,     4321,  0,     0,     0,
                              65535, 65535, 65535, 65535, 65535, 65535};
  muint16m1_t u16_ts1 = mlce16_m1(u16_src1, 3 * sizeof(uint16_t));
  muint16m1_t u16_ts2 = mlce16_m1(u16_src2, 3 * sizeof(uint16_t));
  muint16m1_t u16_out = msaddu_mm(u16_ts1, u16_ts2);
  msce16_m(u16_out, u16_buffer, 3 * sizeof(uint16_t));
  EXCEPT_U16_ARRAY_EQ(u16_ans, u16_buffer, 18, " MSADDU.MM UINT16 M1");
  // uint32
  msettype(E32, M1, BA);
  msettilemi(3);
  msettileni(3);
  const uint32_t u32_src1[] = {0,          0, 0, 4294967295, 4294967295,
                               4294967295, 0, 0, 0};
  const uint32_t u32_src2[] = {0,          0, 0, 4294967295, 4294967295,
                               4294967295, 0, 0, 0};
  const uint32_t u32_ans[] = {0,          0, 0, 4294967295, 4294967295,
                              4294967295, 0, 0, 0};
  muint32m1_t u32_ts1 = mlce32_m1(u32_src1, 3 * sizeof(uint32_t));
  muint32m1_t u32_ts2 = mlce32_m1(u32_src2, 3 * sizeof(uint32_t));
  muint32m1_t u32_out = msaddu_mm(u32_ts1, u32_ts2);
  msce32_m(u32_out, u32_buffer, 3 * sizeof(uint32_t));
  EXCEPT_U32_ARRAY_EQ(u32_ans, u32_buffer, 9, " MSADDU.MM UINT32 M1");
  // uint64
  msettype(E64, M1, BA);
  msettilemi(2);
  msettileni(2);
  const uint64_t u64_src1[] = {18446744073709551615, 0, 0,
                               18446744073709551615};
  const uint64_t u64_src2[] = {18446744073709551615, 0, 0,
                               18446744073709551615};
  const uint64_t u64_ans[] = {18446744073709551615, 0, 0, 18446744073709551615};
  muint64m1_t u64_ts1 = mlce64_m1(u64_src1, 2 * sizeof(uint64_t));
  muint64m1_t u64_ts2 = mlce64_m1(u64_src2, 2 * sizeof(uint64_t));
  muint64m1_t u64_out = msaddu_mm(u64_ts1, u64_ts2);
  msce64_m(u64_out, u64_buffer, 2 * sizeof(uint64_t));
  EXCEPT_U64_ARRAY_EQ(u64_ans, u64_buffer, 4, " MSADDU.MM UINT64 M1");
  // M2
  // uint8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const uint8_t u8_src1_m2[] = {
      0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,
      0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0,   0,   255,
      255, 255, 255, 255, 0,   0,   0,   0,   0,   255, 255, 255, 255,
      255, 0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,
      0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0};
  const uint8_t u8_src2_m2[] = {
      0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,
      0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0,   0,   255,
      255, 255, 255, 255, 0,   0,   0,   0,   0,   255, 255, 255, 255,
      255, 0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,
      0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0};
  const uint8_t u8_ans_m2[] = {
      0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,
      0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0,   0,   255,
      255, 255, 255, 255, 0,   0,   0,   0,   0,   255, 255, 255, 255,
      255, 0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,
      0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0};
  muint8m2_t u8_ts1_m2 = mlce8_m2(u8_src1_m2, 32 * sizeof(uint8_t));
  muint8m2_t u8_ts2_m2 = mlce8_m2(u8_src2_m2, 32 * sizeof(uint8_t));
  muint8m2_t u8_out_m2 = msaddu_mm(u8_ts1_m2, u8_ts2_m2);
  msce8_m(u8_out_m2, u8_buffer, 32 * sizeof(uint8_t));
  EXCEPT_U8_ARRAY_EQ(u8_ans_m2, u8_buffer, 2 * 32, "MSADDU.MM UINT8  M2");
  // uint16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const uint16_t u16_src1_m2[] = {
      65535, 65535, 65535, 65535, 65535, 65535, 0, 0, 0, 0, 0, 0,
      65535, 65535, 65535, 65535, 65535, 65535, 0, 0, 0, 0, 0, 0,
      65535, 65535, 65535, 65535, 65535, 65535, 0, 0, 0, 0, 0, 0,
      65535, 65535, 65535, 65535, 65535, 65535, 0, 0, 0, 0, 0, 0};
  const uint16_t u16_src2_m2[] = {
      65535, 65535, 65535, 65535, 65535, 65535, 123, 0, 4321, 0, 0, 0,
      65535, 65535, 65535, 65535, 65535, 65535, 123, 0, 4321, 0, 0, 0,
      65535, 65535, 65535, 65535, 65535, 65535, 123, 0, 4321, 0, 0, 0,
      65535, 65535, 65535, 65535, 65535, 65535, 123, 0, 4321, 0, 0, 0};
  const uint16_t u16_ans_m2[] = {
      65535, 65535, 65535, 65535, 65535, 65535, 123, 0, 4321, 0, 0, 0,
      65535, 65535, 65535, 65535, 65535, 65535, 123, 0, 4321, 0, 0, 0,
      65535, 65535, 65535, 65535, 65535, 65535, 123, 0, 4321, 0, 0, 0,
      65535, 65535, 65535, 65535, 65535, 65535, 123, 0, 4321, 0, 0, 0};
  muint16m2_t u16_ts1_m2 = mlce16_m2(u16_src1_m2, 16 * sizeof(uint16_t));
  muint16m2_t u16_ts2_m2 = mlce16_m2(u16_src2_m2, 16 * sizeof(uint16_t));
  muint16m2_t u16_out_m2 = msaddu_mm(u16_ts1_m2, u16_ts2_m2);
  msce16_m(u16_out_m2, u16_buffer, 16 * sizeof(uint16_t));
  EXCEPT_U16_ARRAY_EQ(u16_ans_m2, u16_buffer, 3 * 16, "MSADDU.MM UINT16 M2");
  // uint32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const uint32_t u32_src1_m2[] = {
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295};
  const uint32_t u32_src2_m2[] = {
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
  };
  const uint32_t u32_ans_m2[] = {
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0, 4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295};
  muint32m2_t u32_ts1_m2 = mlce32_m2(u32_src1_m2, 8 * sizeof(uint32_t));
  muint32m2_t u32_ts2_m2 = mlce32_m2(u32_src2_m2, 8 * sizeof(uint32_t));
  muint32m2_t u32_out_m2 = msaddu_mm(u32_ts1_m2, u32_ts2_m2);
  msce32_m(u32_out_m2, u32_buffer, 8 * sizeof(uint32_t));
  EXCEPT_U32_ARRAY_EQ(u32_ans_m2, u32_buffer, 4 * 8, "MSADDU.MM UINT32 M2");
  // uint64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const uint64_t u64_src1_m2[] = {
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615};
  const uint64_t u64_src2_m2[] = {
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615};
  const uint64_t u64_ans_m2[] = {
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615,
      18446744073709551615, 0, 0, 18446744073709551615};
  muint64m2_t u64_ts1_m2 = mlce64_m2(u64_src1_m2, 4 * sizeof(uint64_t));
  muint64m2_t u64_ts2_m2 = mlce64_m2(u64_src2_m2, 4 * sizeof(uint64_t));
  muint64m2_t u64_out_m2 = msaddu_mm(u64_ts1_m2, u64_ts2_m2);
  msce64_m(u64_out_m2, u64_buffer, 4 * sizeof(uint64_t));
  EXCEPT_U64_ARRAY_EQ(u64_ans_m2, u64_buffer, 5 * 4, "MSADDU.MM UINT64 M2");
  // M4
  // uint8
  msettype(E8, M4, BA);
  msettilemi(2);
  msettileni(33);
  const uint8_t u8_src1_m4[] = {
      0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0,
      0,   255, 255, 255, 255, 255, 0,   0,   0,   0,   0,   255, 255, 255,
      255, 255, 0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,
      0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0,   0,   255,
      255, 255, 255, 255, 0,   0,   0,   0,   0,   0};
  const uint8_t u8_src2_m4[] = {
      0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0,
      0,   255, 255, 255, 255, 255, 0,   0,   0,   0,   0,   255, 255, 255,
      255, 255, 0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,
      0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0,   0,   255,
      255, 255, 255, 255, 0,   0,   0,   0,   0,   0};
  const uint8_t u8_ans_m4[] = {
      0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0,
      0,   255, 255, 255, 255, 255, 0,   0,   0,   0,   0,   255, 255, 255,
      255, 255, 0,   0,   0,   0,   0,   255, 255, 255, 255, 255, 0,   0,
      0,   0,   0,   255, 255, 255, 255, 255, 0,   0,   0,   0,   0,   255,
      255, 255, 255, 255, 0,   0,   0,   0,   0,   0};
  muint8m4_t u8_ts1_m4 = mlce8_m4(u8_src1_m4, 33 * sizeof(uint8_t));
  muint8m4_t u8_ts2_m4 = mlce8_m4(u8_src2_m4, 33 * sizeof(uint8_t));
  muint8m4_t u8_out_m4 = msaddu_mm(u8_ts1_m4, u8_ts2_m4);
  msce8_m(u8_out_m4, u8_buffer, 33 * sizeof(uint8_t));
  EXCEPT_U8_ARRAY_EQ(u8_ans_m4, u8_buffer, 2 * 33, "MSADDU.MM UINT8  M4");
  // uint16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(17);
  const uint16_t u16_src1_m4[] = {
      65535, 65535, 65535, 65535, 65535, 65535, 0,     0,     0,     0, 0,
      0,     65535, 65535, 65535, 65535, 65535, 65535, 0,     0,     0, 0,
      0,     0,     65535, 65535, 65535, 65535, 65535, 65535, 0,     0, 0,
      0,     0,     0,     65535, 65535, 65535, 65535, 65535, 65535, 0, 0,
      0,     0,     0,     0,     65535, 0,     0};
  const uint16_t u16_src2_m4[] = {
      65535, 65535, 65535, 65535, 65535, 65535, 123,   0,     4321,  0,    0,
      0,     65535, 65535, 65535, 65535, 65535, 65535, 123,   0,     4321, 0,
      0,     0,     65535, 65535, 65535, 65535, 65535, 65535, 123,   0,    4321,
      0,     0,     0,     65535, 65535, 65535, 65535, 65535, 65535, 123,  0,
      4321,  0,     0,     0,     65535, 123,   0};
  const uint16_t u16_ans_m4[] = {
      65535, 65535, 65535, 65535, 65535, 65535, 123,   0,     4321,  0,    0,
      0,     65535, 65535, 65535, 65535, 65535, 65535, 123,   0,     4321, 0,
      0,     0,     65535, 65535, 65535, 65535, 65535, 65535, 123,   0,    4321,
      0,     0,     0,     65535, 65535, 65535, 65535, 65535, 65535, 123,  0,
      4321,  0,     0,     0,     65535, 123,   0};
  muint16m4_t u16_ts1_m4 = mlce16_m4(u16_src1_m4, 17 * sizeof(uint16_t));
  muint16m4_t u16_ts2_m4 = mlce16_m4(u16_src2_m4, 17 * sizeof(uint16_t));
  muint16m4_t u16_out_m4 = msaddu_mm(u16_ts1_m4, u16_ts2_m4);
  msce16_m(u16_out_m4, u16_buffer, 17 * sizeof(uint16_t));
  EXCEPT_U16_ARRAY_EQ(u16_ans_m4, u16_buffer, 3 * 17, "MSADDU.MM UINT16 M4");
  // uint32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(9);
  const uint32_t u32_src1_m4[] = {
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 4294967295, 4294967295};
  const uint32_t u32_src2_m4[] = {
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 4294967295, 4294967295};
  const uint32_t u32_ans_m4[] = {
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 0,          4294967295, 4294967295, 0, 0, 0, 4294967295, 4294967295,
      0, 0, 4294967295, 4294967295};
  muint32m4_t u32_ts1_m4 = mlce32_m4(u32_src1_m4, 9 * sizeof(uint32_t));
  muint32m4_t u32_ts2_m4 = mlce32_m4(u32_src2_m4, 9 * sizeof(uint32_t));
  muint32m4_t u32_out_m4 = msaddu_mm(u32_ts1_m4, u32_ts2_m4);
  msce32_m(u32_out_m4, u32_buffer, 9 * sizeof(uint32_t));
  EXCEPT_U32_ARRAY_EQ(u32_ans_m4, u32_buffer, 4 * 9, "MSADDU.MM UINT32 M4");
  // uint64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(5);
  const uint64_t u64_src1_m4[] = {18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615,
                                  18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615,
                                  18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615,
                                  18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615,
                                  18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615,
                                  18446744073709551615,
                                  18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615};
  const uint64_t u64_src2_m4[] = {18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615,
                                  18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615,
                                  18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615,
                                  18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615,
                                  18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615,
                                  18446744073709551615,
                                  18446744073709551615,
                                  0,
                                  0,
                                  18446744073709551615};
  const uint64_t u64_ans_m4[] = {18446744073709551615,
                                 0,
                                 0,
                                 18446744073709551615,
                                 18446744073709551615,
                                 0,
                                 0,
                                 18446744073709551615,
                                 18446744073709551615,
                                 0,
                                 0,
                                 18446744073709551615,
                                 18446744073709551615,
                                 0,
                                 0,
                                 18446744073709551615,
                                 18446744073709551615,
                                 0,
                                 0,
                                 18446744073709551615,
                                 18446744073709551615,
                                 18446744073709551615,
                                 0,
                                 0,
                                 18446744073709551615};
  muint64m4_t u64_ts1_m4 = mlce64_m4(u64_src1_m4, 5 * sizeof(uint64_t));
  muint64m4_t u64_ts2_m4 = mlce64_m4(u64_src2_m4, 5 * sizeof(uint64_t));
  muint64m4_t u64_out_m4 = msaddu_mm(u64_ts1_m4, u64_ts2_m4);
  msce64_m(u64_out_m4, u64_buffer, 5 * sizeof(uint64_t));
  EXCEPT_U64_ARRAY_EQ(u64_ans_m4, u64_buffer, 5 * 4, "MSADDU.MM UINT64 M4");
}

static void test_mfadd_mm() {
  // M1
  // fp16
  msettype(E16, M1, BA);
  msettilemi(5);
  msettileni(5);
  const fp16_t fp16_src1[] = {1.019,  1.987,   0.1902,  -0.75,   0.8774,
                              -1.611, -0.5605, -1.137,  -0.1353, 0.75,
                              0.377,  0.2708,  -0.637,  -2.654,  0.978,
                              -0.255, 2.057,   -0.9307, -0.6304, 0.2708,
                              0.706,  -2.465,  -0.1676, 0.647,   0.406};
  const fp16_t fp16_src2[] = {-1.735,  0.1388,  -1.135,   2.43,    -0.758,
                              -0.107,  0.3955,  -0.745,   1.51,    0.613,
                              -0.497,  1.164,   -0.02454, -0.421,  -0.279,
                              -0.413,  0.02847, 0.2988,   1.629,   -0.8696,
                              0.09015, 0.05908, -2.016,   -0.3044, 0.928};
  const fp16_t fp16_ans[] = {
      -0.717, 2.127,   -0.9443, 1.68,    0.1196, -1.719, -0.165, -1.882, 1.375,
      1.363,  -0.1201, 1.435,   -0.6616, -3.074, 0.699,  -0.668, 2.086,  -0.632,
      0.9985, -0.5986, 0.7964,  -2.406,  -2.184, 0.3425, 1.334};
  mfloat16m1_t fp16_ts1 = mlce16_m1(fp16_src1, 5 * sizeof(fp16_t));
  mfloat16m1_t fp16_ts2 = mlce16_m1(fp16_src2, 5 * sizeof(fp16_t));
  mfloat16m1_t fp16_out = mfadd_mm(fp16_ts1, fp16_ts2);
  msce16_m(fp16_out, fp16_buffer, 5 * sizeof(fp16_t));
  EXCEPT_FP16_ARRAY_LAX_EQ(fp16_ans, fp16_buffer, 25, "MFADD.MM FP16 M1");
  // fp32
  msettype(E32, M1, BA);
  msettilemi(1);
  msettileni(4);
  const fp32_t fp32_src1[] = {0.15733461, 0.1379579, -0.74867827, 0.19663455};
  const fp32_t fp32_src2[] = {0.21039504, 0.0174556, 0.9466979, 0.43706286};
  const fp32_t fp32_ans[] = {0.36772966, 0.15541351, 0.19801962, 0.6336974};
  mfloat32m1_t fp32_ts1 = mlce32_m1(fp32_src1, 4 * sizeof(fp32_t));
  mfloat32m1_t fp32_ts2 = mlce32_m1(fp32_src2, 4 * sizeof(fp32_t));
  mfloat32m1_t fp32_out = mfadd_mm(fp32_ts1, fp32_ts2);
  msce32_m(fp32_out, fp32_buffer, 4 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_LAX_EQ(fp32_ans, fp32_buffer, 4, "MFADD.MM FP32 M1");
  // fp64
  msettype(E64, M1, BA);
  msettilemi(4);
  msettileni(2);
  const fp64_t fp64_src1[] = {-0.23718395, 1.02168045, -0.42744556,
                              -1.36404197, 0.18804299, 0.62549579,
                              -0.4737774,  -0.37355439};
  const fp64_t fp64_src2[] = {0.89784754,  -0.69096792, 2.12384198, -0.83649716,
                              -0.67908636, -1.36134792, -0.0083961, 1.53133758};
  const fp64_t fp64_ans[] = {0.66066358,  0.33071253,  1.69639642,  -2.20053913,
                             -0.49104337, -0.73585213, -0.48217351, 1.15778319};
  mfloat64m1_t fp64_ts1 = mlce64_m1(fp64_src1, 2 * sizeof(fp64_t));
  mfloat64m1_t fp64_ts2 = mlce64_m1(fp64_src2, 2 * sizeof(fp64_t));
  mfloat64m1_t fp64_out = mfadd_mm(fp64_ts1, fp64_ts2);
  msce64_m(fp64_out, fp64_buffer, 2 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_LAX_EQ(fp64_ans, fp64_buffer, 4, "MFADD.MM FP64 M1");
  // M2
  // fp16
  msettype(E16, M2, BA);
  msettilemi(2);
  msettileni(16);
  const fp16_t fp16_src1_m2[] = {
      61.84,  60.88,  73.94,  -56.9,  32.53,  -67.1,  48.44,  -62.16,
      59.88,  -6.273, 45.97,  87.2,   -16.19, -52.38, -7.39,  -23.56,
      -42.38, -72.,   -70.7,  8.836,  -91.5,  -18.44, 66.9,   71.75,
      -89.25, -45.5,  -38.22, -58.22, 12.055, 74.94,  -58.06, 49.34};
  const fp16_t fp16_src2_m2[] = {
      -77.3,  -21.25, 49.3,   88.44,  90.75,  18.5,  21.22, -94.94,
      10.586, 11.77,  -42.06, -59.12, -19.33, -68.2, 82.75, 5.094,
      84.56,  -64.44, -94.2,  -52.78, 32.6,   63.22, 17.05, -8.79,
      -1.467, 29.8,   24.47,  18.55,  24.25,  46.22, 70.25, -8.33};
  const fp16_t fp16_ans_m2[] = {
      -15.47, 39.62,  123.25, 31.53,  123.25, -48.62,  69.6,  -157.1,
      70.44,  5.5,    3.906,  28.06,  -35.5,  -120.56, 75.4,  -18.47,
      42.2,   -136.5, -164.9, -43.94, -58.9,  44.78,   83.94, 62.97,
      -90.7,  -15.7,  -13.75, -39.7,  36.3,   121.1,   12.19, 41.};
  mfloat16m2_t fp16_ts1_m2 = mlce16_m2(fp16_src1_m2, 16 * sizeof(fp16_t));
  mfloat16m2_t fp16_ts2_m2 = mlce16_m2(fp16_src2_m2, 16 * sizeof(fp16_t));
  mfloat16m2_t fp16_out_m2 = mfadd_mm(fp16_ts1_m2, fp16_ts2_m2);
  msce16_m(fp16_out_m2, fp16_buffer, 16 * sizeof(fp16_t));
  EXCEPT_FP16_ARRAY_LAX_EQ(fp16_ans_m2, fp16_buffer, 2 * 16,
                           "MFADD.MM FP16 M2");
  // fp32
  msettype(E32, M2, BA);
  msettilemi(3);
  msettileni(8);
  const fp32_t fp32_src1_m2[] = {
      0.15733461,  0.1379579,   -0.74867827, 0.19663455,  0.15733461,
      0.1379579,   -0.74867827, 0.19663455,  0.15733461,  0.1379579,
      -0.74867827, 0.19663455,  0.15733461,  0.1379579,   -0.74867827,
      0.19663455,  0.15733461,  0.1379579,   -0.74867827, 0.19663455,
      0.15733461,  0.1379579,   -0.74867827, 0.19663455};
  const fp32_t fp32_src2_m2[] = {
      0.21039504, 0.0174556,  0.9466979,  0.43706286, 0.21039504, 0.0174556,
      0.9466979,  0.43706286, 0.21039504, 0.0174556,  0.9466979,  0.43706286,
      0.21039504, 0.0174556,  0.9466979,  0.43706286, 0.21039504, 0.0174556,
      0.9466979,  0.43706286, 0.21039504, 0.0174556,  0.9466979,  0.43706286};
  const fp32_t fp32_ans_m2[] = {
      0.36772966, 0.15541351, 0.19801962, 0.6336974,  0.36772966, 0.15541351,
      0.19801962, 0.6336974,  0.36772966, 0.15541351, 0.19801962, 0.6336974,
      0.36772966, 0.15541351, 0.19801962, 0.6336974,  0.36772966, 0.15541351,
      0.19801962, 0.6336974,  0.36772966, 0.15541351, 0.19801962, 0.6336974};
  mfloat32m2_t fp32_ts1_m2 = mlce32_m2(fp32_src1_m2, 8 * sizeof(fp32_t));
  mfloat32m2_t fp32_ts2_m2 = mlce32_m2(fp32_src2_m2, 8 * sizeof(fp32_t));
  mfloat32m2_t fp32_out_m2 = mfadd_mm(fp32_ts1_m2, fp32_ts2_m2);
  msce32_m(fp32_out_m2, fp32_buffer, 8 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_LAX_EQ(fp32_ans_m2, fp32_buffer, 3 * 8, "MFADD.MM FP32 M2");
  // fp64
  msettype(E64, M2, BA);
  msettilemi(4);
  msettileni(4);
  const fp64_t fp64_src1_m2[] = {
      -0.23718395, 1.02168045, -0.42744556, -1.36404197,
      0.18804299,  0.62549579, -0.4737774,  -0.37355439,
      -0.23718395, 1.02168045, -0.42744556, -1.36404197,
      0.18804299,  0.62549579, -0.4737774,  -0.37355439};
  const fp64_t fp64_src2_m2[] = {
      0.89784754,  -0.69096792, 2.12384198, -0.83649716,
      -0.67908636, -1.36134792, -0.0083961, 1.53133758,
      0.89784754,  -0.69096792, 2.12384198, -0.83649716,
      -0.67908636, -1.36134792, -0.0083961, 1.53133758};
  const fp64_t fp64_ans_m2[] = {
      0.66066358,  0.33071253,  1.69639642,  -2.20053913,
      -0.49104337, -0.73585213, -0.48217351, 1.15778319,
      0.66066358,  0.33071253,  1.69639642,  -2.20053913,
      -0.49104337, -0.73585213, -0.48217351, 1.15778319};
  mfloat64m2_t fp64_ts1_m2 = mlce64_m2(fp64_src1_m2, 4 * sizeof(fp64_t));
  mfloat64m2_t fp64_ts2_m2 = mlce64_m2(fp64_src2_m2, 4 * sizeof(fp64_t));
  mfloat64m2_t fp64_out_m2 = mfadd_mm(fp64_ts1_m2, fp64_ts2_m2);
  msce64_m(fp64_out_m2, fp64_buffer, 4 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_LAX_EQ(fp64_ans_m2, fp64_buffer, 4 * 4, "MFADD.MM FP64 M2");
  // M4
  // fp16
  msettype(E16, M4, BA);
  msettilemi(2);
  msettileni(17);
  const fp16_t fp16_src1_m4[] = {
      -7.62, -2.062, -8.56,  9.836,  5.027,  -8.33, -6.72,  -4.05, -8.43,
      8.125, -6.61,  -5.45,  8.945,  -5.465, -6.58, -5.062, -7.91, 4.28,
      2.318, 6.12,   0.858,  -1.691, 3.371,  5.156, -8.28,  8.37,  -2.887,
      9.266, 5.74,   -0.293, -8.14,  -9.72,  7.695, -7.438};
  const fp16_t fp16_src2_m4[] = {
      -5.92, 5.78,   -8.234, 2.63,   -8.42, -7.26,  9.15,   4.703,   0.29,
      2.992, -7.598, 5.977,  -2.348, -3.82, -5.35,  -5.477, -0.8276, -0.11926,
      5.97,  5.508,  8.016,  7.45,   8.586, 9.95,   2.805,  -1.386,  9.52,
      9.586, -5.93,  1.008,  1.638,  0.829, 0.3958, -8.26};
  const fp16_t fp16_ans_m4[] = {
      -13.55, 3.719,   -16.8,  12.47,  -3.395, -15.59, 2.43,   0.6523, -8.14,
      11.12,  -14.2,   0.5273, 6.598,  -9.28,  -11.93, -10.54, -8.734, 4.16,
      8.29,   11.625,  8.875,  5.758,  11.95,  15.11,  -5.477, 6.98,   6.637,
      18.84,  -0.1914, 0.715,  -6.504, -8.89,  8.09,   -15.695};
  mfloat16m4_t fp16_ts1_m4 = mlce16_m4(fp16_src1_m4, 17 * sizeof(fp16_t));
  mfloat16m4_t fp16_ts2_m4 = mlce16_m4(fp16_src2_m4, 17 * sizeof(fp16_t));
  mfloat16m4_t fp16_out_m4 = mfadd_mm(fp16_ts1_m4, fp16_ts2_m4);
  msce16_m(fp16_out_m4, fp16_buffer, 17 * sizeof(fp16_t));
  EXCEPT_FP16_ARRAY_LAX_EQ(fp16_ans_m4, fp16_buffer, 2 * 16,
                           "MFADD.MM FP16 M4");
  // fp32
  msettype(E32, M4, BA);
  msettilemi(3);
  msettileni(9);
  const fp32_t fp32_src1_m4[] = {
      8.702967,   6.375828,   -6.5789156, -5.534493,  -4.5609255, 3.679043,
      -5.954037,  -4.6451607, 3.1937814,  -3.9635785, -3.0341794, 6.7092004,
      9.1362,     8.714259,   -6.053594,  -8.70354,   8.227408,   -6.2076025,
      2.5609982,  -6.4026494, 8.19552,    1.0588771,  1.3159499,  -1.3739833,
      -5.4039006, 8.193567,   5.4755855};
  const fp32_t fp32_src2_m4[] = {
      2.3649218,   -4.486279,  9.659454,   -8.8502245, -6.562072,  2.5379608,
      -0.39068437, 3.833477,   5.3364563,  -3.5447614, -7.7294397, 0.4454201,
      -7.293723,   -3.2902737, -4.977208,  3.6633883,  -6.5015206, 8.141777,
      -6.9610653,  6.595147,   0.69691557, -2.5779767, -7.508238,  3.6451206,
      0.76561934,  -6.6177773, -0.8623245};
  const fp32_t fp32_ans_m4[] = {
      11.067888,  1.8895488,   3.0805387,  -14.384718, -11.122997, 6.217004,
      -6.344722,  -0.81168365, 8.530237,   -7.50834,   -10.763619, 7.1546206,
      1.8424768,  5.4239855,   -11.030802, -5.0401516, 1.7258878,  1.9341745,
      -4.4000673, 0.19249773,  8.892436,   -1.5190996, -6.192288,  2.2711372,
      -4.6382813, 1.5757899,   4.613261};
  mfloat32m4_t fp32_ts1_m4 = mlce32_m4(fp32_src1_m4, 9 * sizeof(fp32_t));
  mfloat32m4_t fp32_ts2_m4 = mlce32_m4(fp32_src2_m4, 9 * sizeof(fp32_t));
  mfloat32m4_t fp32_out_m4 = mfadd_mm(fp32_ts1_m4, fp32_ts2_m4);
  msce32_m(fp32_out_m4, fp32_buffer, 9 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_LAX_EQ(fp32_ans_m4, fp32_buffer, 3 * 9, "MFADD.MM FP32 M4");
  // fp64
  msettype(E64, M4, BA);
  msettilemi(4);
  msettileni(5);
  const fp64_t fp64_src1_m4[] = {
      8.99927434,  6.76948951, 0.71641369, 4.69259627,  8.62655379,
      -7.92601376, 4.94831271, 7.41937033, -9.7341922,  0.25093654,
      6.02739574,  0.06768333, 1.72172223, -8.27242995, 2.41068476,
      7.79929428,  -2.2759216, 7.17901385, -3.63517963, 3.88104851};
  const fp64_t fp64_src2_m4[] = {
      -0.01835119, 0.97694588,  -2.1549596,  8.88126574,  -9.47305245,
      4.2219443,   -9.50480396, 0.7688622,   -1.228726,   0.82584017,
      -1.43803185, 0.85418459,  -1.87172625, 4.85948468,  -8.84363105,
      1.46597008,  -9.05681647, 8.01463646,  -5.41100702, -3.53123548};
  const fp64_t fp64_ans_m4[] = {
      8.98092315,  7.74643539,   -1.43854591, 13.57386201, -0.84649865,
      -3.70406946, -4.55649125,  8.18823253,  -10.9629182, 1.0767767,
      4.58936389,  0.92186792,   -0.15000402, -3.41294527, -6.43294629,
      9.26526436,  -11.33273807, 15.1936503,  -9.04618666, 0.34981303};
  mfloat64m4_t fp64_ts1_m4 = mlce64_m4(fp64_src1_m4, 5 * sizeof(fp64_t));
  mfloat64m4_t fp64_ts2_m4 = mlce64_m4(fp64_src2_m4, 5 * sizeof(fp64_t));
  mfloat64m4_t fp64_out_m4 = mfadd_mm(fp64_ts1_m4, fp64_ts2_m4);
  msce64_m(fp64_out_m4, fp64_buffer, 5 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_LAX_EQ(fp64_ans_m4, fp64_buffer, 4 * 5, "MFADD.MM FP64 M4");
}

static void test_mfwadd_mm() {
  // M1
  // fp16
  const fp16_t fp16_src1[] = {6.547,  0.456,  3.43,   3.959, 9.88,   -6.582,
                              -1.431, 0.4214, 0.6772, 9.73,  -1.742, -1.885,
                              9.586,  1.269,  -4.105, 5.67};
  const fp16_t fp16_src2[] = {6.,     4.02,     1.779, 4.293, 5.406,  -2.867,
                              3.334,  -0.03857, 5.863, 9.68,  -1.825, -9.07,
                              -7.316, -1.873,   5.23,  -3.812};
  const fp32_t fp32_ans[] = {12.55, 4.477,   5.21,  8.25, 15.29,  -9.45,
                             1.903, 0.3828,  6.54,  19.4, -3.566, -10.95,
                             2.27,  -0.6045, 1.125, 1.859};
  msettype(E16, M1, BA);
  msettilemi(4);
  msettileni(4);
  mfloat16m1_t fp16_ts1 = mlce16_m1(fp16_src1, 4 * sizeof(fp16_t));
  mfloat16m1_t fp16_ts2 = mlce16_m1(fp16_src2, 4 * sizeof(fp16_t));
  mfloat32m2_t fp32_out = mfwadd_mm(fp16_ts1, fp16_ts2);
  msettype(E32, M2, BA);
  msce32_m(fp32_out, fp32_buffer, 4 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_LAX_EQ(fp32_ans, fp32_buffer, 16, "MFWADD.MM FP16 M1");
  // fp32
  const fp32_t fp32_src1[] = {-79.6586, -29.814556, 40.22779,  0.410815,
                              60.4861,  83.77085,   -73.68017, -52.588833,
                              43.82635, -5.0418406};
  const fp32_t fp32_src2[] = {-62.382393, 47.23894,  -9.82741,  -25.163738,
                              9.658742,   19.681377, -37.69954, 54.915672,
                              90.92441,   -26.489246};
  const fp64_t fp64_ans[] = {-142.04099, 17.424385,  30.400381,  -24.752924,
                             70.144844,  103.452225, -111.37971, 2.3268394,
                             134.75076,  -31.531086};
  msettype(E32, M2, BA);
  msettilemi(5);
  msettileni(2);
  mfloat32m1_t fp32_ts1 = mlce32_m1(fp32_src1, 2 * sizeof(fp32_t));
  mfloat32m1_t fp32_ts2 = mlce32_m1(fp32_src2, 2 * sizeof(fp32_t));
  mfloat64m2_t fp64_out = mfwadd_mm(fp32_ts1, fp32_ts2);
  msettype(E64, M1, BA);
  msce64_m(fp64_out, fp64_buffer, 2 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_LAX_EQ(fp64_ans, fp64_buffer, 10, "MFWADD.MM FP32 M1");
  // M2
  // fp16
  const fp16_t fp16_src1_m2[] = {
      -1.245,   -5.76,   8.1,   -5.8,   -6.375, 2.168,  8.37,  -8.89,
      -0.728,   9.28,    -9.01, 6.516,  0.4639, 3.361,  2.578, -5.9,
      -0.09467, 9.44,    -8.26, 8.44,   4.133,  -6.348, 7.5,   7.008,
      -9.055,   -0.5444, -4.88, -8.58,  -3.633, 1.207,  -9.46, -5.625,
      -3.248,   -4.344,  5.25,  1.055,  2.61,   -2.186, 4.207, -4.836,
      -1.036,   8.45,    -4.06, -2.182, 2.422,  7.96,   -4.99, -4.5};
  const fp16_t fp16_src2_m2[] = {
      5.195,  -9.04,  3.701,  3.322,  4.32,   -1.392, 6.312,  -7.45,
      -7.37,  5.863,  -6.055, -4.812, -2.016, 3.926,  4.86,   3.,
      5.344,  2.695,  5.27,   -9.76,  -5.895, -2.232, -6.613, -9.26,
      -9.586, 4.855,  -7.715, 9.99,   -1.079, 6.,     4.48,   -8.82,
      -2.666, -1.969, -4.227, 4.52,   -8.016, -9.56,  -9.94,  7.047,
      1.796,  6.45,   4.293,  -1.346, -9.,    -5.82,  1.792,  5.723};
  const fp32_t fp32_ans_m4[] = {
      3.95,   -14.8,  11.805, -2.479, -2.055, 0.7764, 14.68,  -16.34,
      -8.1,   15.14,  -15.06, 1.703,  -1.552, 7.29,   7.438,  -2.898,
      5.25,   12.13,  -2.988, -1.32,  -1.762, -8.58,  0.8867, -2.25,
      -18.64, 4.312,  -12.59, 1.414,  -4.71,  7.207,  -4.98,  -14.445,
      -5.914, -6.312, 1.023,  5.574,  -5.406, -11.75, -5.73,  2.21,
      0.76,   14.91,  0.2344, -3.527, -6.58,  2.14,   -3.195, 1.223};
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  mfloat16m2_t fp16_ts1_m2 = mlce16_m2(fp16_src1_m2, 16 * sizeof(fp16_t));
  mfloat16m2_t fp16_ts2_m2 = mlce16_m2(fp16_src2_m2, 16 * sizeof(fp16_t));
  mfloat32m4_t fp32_out_m4 = mfwadd_mm(fp16_ts1_m2, fp16_ts2_m2);
  msettype(E32, M4, BA);
  msettileni(16);
  msce32_m(fp32_out_m4, fp32_buffer, 16 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_LAX_EQ(fp32_ans_m4, fp32_buffer, 3 * 16,
                           "MFWADD.MM FP16 M2");
  // fp32
  const fp32_t fp32_src1_m2[] = {
      9.73783,    -6.4170012, 3.2990944, -3.3336253,  -3.0679364, -9.405585,
      -5.3117604, -4.438535,  9.814699,  -0.45656422, 9.229729,   -4.9931655,
      3.3126588,  -6.244134,  7.9996204, -6.0210934,  -5.962163,  2.1691494,
      0.7939618,  -8.282859,  7.7443914, 5.8134036,   -7.8149676, 9.000701,
      1.5532422,  4.347625,   5.829992,  1.799007,    4.370979,   0.6121329,
      1.8237116,  3.6646912};
  const fp32_t fp32_src2_m2[] = {
      -1.7142366, -2.949841,  -6.8009615, -4.695962,   5.146265,   1.5591384,
      -3.2957304, 4.99618,    -6.521252,  -6.871183,   -4.263448,  1.5726615,
      -3.4186907, 3.5528822,  -9.133059,  -0.43998373, -1.8860906, -0.11052708,
      -3.2229528, -7.5102954, 6.4594526,  -6.5107436,  -5.2399077, -5.015543,
      0.5674761,  -6.5198584, 2.740202,   2.9251773,   3.3326516,  7.9011216,
      -8.673792,  9.637591};
  const fp64_t fp64_ans_m4[] = {
      8.023594,    -9.366842,  -3.501867,  -8.029587,  2.0783286,  -7.846447,
      -8.607491,   0.55764484, 3.293447,   -7.3277473, 4.9662805,  -3.420504,
      -0.10603189, -2.6912518, -1.1334381, -6.461077,  -7.8482537, 2.0586224,
      -2.428991,   -15.793154, 14.203844,  -0.69734,   -13.054875, 3.985158,
      2.1207182,   -2.1722336, 8.570194,   4.7241845,  7.7036304,  8.513254,
      -6.8500805,  13.302282};
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  mfloat32m2_t fp32_ts1_m2 = mlce32_m2(fp32_src1_m2, 8 * sizeof(fp32_t));
  mfloat32m2_t fp32_ts2_m2 = mlce32_m2(fp32_src2_m2, 8 * sizeof(fp32_t));
  mfloat64m4_t fp64_out_m4 = mfwadd_mm(fp32_ts1_m2, fp32_ts2_m2);
  msettype(E64, M4, BA);
  msettileni(8);
  msce64_m(fp64_out_m4, fp64_buffer, 8 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_LAX_EQ(fp64_ans_m4, fp64_buffer, 4 * 8,
                           "MFWADD.MM FP32 M2");
}

static void test_mwaddu_mm() {
  // M1
  // uint8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(8);
  const uint8_t u8_src1[] = {239, 128, 199, 34, 69,  203, 58,  80,
                             254, 158, 190, 75, 216, 71,  132, 44};
  const uint8_t u8_src2[] = {185, 225, 55,  52,  36,  67,  190, 148,
                             163, 81,  209, 100, 206, 183, 11,  116};
  const uint16_t u16_ans[] = {424, 353, 254, 86,  105, 270, 248, 228,
                              417, 239, 399, 175, 422, 254, 143, 160};
  muint8m1_t u8_ts1 = mlce8_m1(u8_src1, 8 * sizeof(uint8_t));
  muint8m1_t u8_ts2 = mlce8_m1(u8_src2, 8 * sizeof(uint8_t));
  muint16m2_t u16_out = mwaddu_mm(u8_ts1, u8_ts2);
  msettype(E16, M2, BA);
  msce16_m(u16_out, u16_buffer, 8 * sizeof(uint16_t));
  EXCEPT_U16_ARRAY_EQ(u16_ans, u16_buffer, 2 * 8, "MWADDU.MM UINT8  M1");
  // uint16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(4);
  const uint16_t u16_src1[] = {24407, 59211, 15892, 45130, 53185, 35078,
                               57726, 45781, 24821, 26548, 13523, 17992};
  const uint16_t u16_src2[] = {39582, 39184, 5297,  25066, 2460,  11546,
                               62430, 17784, 48386, 57945, 50026, 3065};
  const uint32_t u32_ans[] = {63989,  98395, 21189, 70196, 55645, 46624,
                              120156, 63565, 73207, 84493, 63549, 21057};
  muint16m1_t u16_ts1 = mlce16_m1(u16_src1, 4 * sizeof(uint16_t));
  muint16m1_t u16_ts2 = mlce16_m1(u16_src2, 4 * sizeof(uint16_t));
  muint32m2_t u32_out = mwaddu_mm(u16_ts1, u16_ts2);
  msettype(E32, M2, BA);
  msce32_m(u32_out, u32_buffer, 4 * sizeof(uint32_t));
  EXCEPT_U32_ARRAY_EQ(u32_ans, u32_buffer, 3 * 4, "MWADDU.MM UINT16 M1");
  // uint32
  msettype(E32, M1, BA);
  msettilemi(4);
  msettileni(2);
  const uint32_t u32_src1[] = {3885445816, 1440759654, 2966218902, 1901870805,
                               3290514622, 458198363,  664565993,  1570532811};
  const uint32_t u32_src2[] = {3866622718, 2619658228, 705687676,  378343800,
                               4169356996, 3267529240, 2442529660, 102164269};
  const uint64_t u64_ans[] = {7752068534, 4060417882, 3671906578, 2280214605,
                              7459871618, 3725727603, 3107095653, 1672697080};
  muint32m1_t u32_ts1 = mlce32_m1(u32_src1, 2 * sizeof(uint32_t));
  muint32m1_t u32_ts2 = mlce32_m1(u32_src2, 2 * sizeof(uint32_t));
  muint64m2_t u64_out = mwaddu_mm(u32_ts1, u32_ts2);
  msettype(E64, M2, BA);
  msce64_m(u64_out, u64_buffer, 2 * sizeof(uint64_t));
  EXCEPT_U64_ARRAY_EQ(u64_ans, u64_buffer, 4 * 2, "MWADDU.MM UINT32 M1");
  // M2
  // uint8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const uint8_t u8_src1_m2[] = {
      134, 39,  155, 146, 197, 122, 146, 80,  205, 206, 34,  236, 7,
      54,  38,  186, 159, 204, 9,   175, 180, 147, 193, 245, 179, 234,
      96,  205, 178, 171, 128, 79,  209, 53,  42,  80,  240, 118, 174,
      126, 157, 69,  37,  24,  189, 210, 143, 217, 82,  74,  34,  78,
      101, 185, 248, 13,  94,  121, 95,  110, 137, 162, 56,  165};
  const uint8_t u8_src2_m2[] = {
      171, 236, 27,  71,  65,  28,  242, 107, 102, 53,  79,  117, 57,
      254, 0,   193, 17,  118, 126, 164, 221, 61,  241, 39,  149, 145,
      192, 44,  137, 30,  214, 62,  178, 42,  224, 160, 196, 186, 52,
      55,  70,  178, 127, 237, 82,  202, 15,  83,  188, 98,  140, 196,
      40,  134, 32,  200, 24,  67,  234, 186, 180, 179, 223, 101};
  const uint16_t u16_ans_m4[] = {
      305, 275, 182, 217, 262, 150, 388, 187, 307, 259, 113, 353, 64,
      308, 38,  379, 176, 322, 135, 339, 401, 208, 434, 284, 328, 379,
      288, 249, 315, 201, 342, 141, 387, 95,  266, 240, 436, 304, 226,
      181, 227, 247, 164, 261, 271, 412, 158, 300, 270, 172, 174, 274,
      141, 319, 280, 213, 118, 188, 329, 296, 317, 341, 279, 266};
  muint8m2_t u8_ts1_m2 = mlce8_m2(u8_src1_m2, 32 * sizeof(uint8_t));
  muint8m2_t u8_ts2_m2 = mlce8_m2(u8_src2_m2, 32 * sizeof(uint8_t));
  muint16m4_t u16_out_m4 = mwaddu_mm(u8_ts1_m2, u8_ts2_m2);
  msettype(E16, M4, BA);
  msettileni(32);
  msce16_m(u16_out_m4, u16_buffer, 32 * sizeof(uint16_t));
  EXCEPT_U16_ARRAY_EQ(u16_ans_m4, u16_buffer, 2 * 32, "MWADDU.MM UINT8  M2");
  // uint16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const uint16_t u16_src1_m2[] = {
      30124, 32334, 52695, 6228,  52758, 62332, 10380, 35280, 52221, 58175,
      54394, 28430, 64110, 16343, 27734, 62209, 14192, 24686, 24474, 35350,
      18087, 46277, 43588, 38042, 58009, 18918, 22132, 40010, 33101, 44943,
      26711, 58486, 58890, 13718, 41495, 9823,  55762, 56420, 63135, 62685,
      32250, 11620, 59237, 2562,  56026, 24313, 61087, 57583};
  const uint16_t u16_src2_m2[] = {
      36255, 12826, 4404,  50498, 24176, 46806, 23396, 52061, 50368, 56852,
      65308, 3809,  11652, 16307, 64198, 23915, 29644, 42492, 43419, 39867,
      63547, 65032, 60667, 10661, 42424, 26368, 12929, 58755, 4804,  41120,
      20600, 38718, 1575,  49054, 61968, 14143, 14460, 28447, 55928, 9041,
      25255, 6673,  14011, 22426, 58443, 11388, 52198, 34322};
  const uint32_t u32_ans_m4[] = {
      66379,  45160,  57099,  56726, 76934,  109138, 33776,  87341,
      102589, 115027, 119702, 32239, 75762,  32650,  91932,  86124,
      43836,  67178,  67893,  75217, 81634,  111309, 104255, 48703,
      100433, 45286,  35061,  98765, 37905,  86063,  47311,  97204,
      60465,  62772,  103463, 23966, 70222,  84867,  119063, 71726,
      57505,  18293,  73248,  24988, 114469, 35701,  113285, 91905};
  muint16m2_t u16_ts1_m2 = mlce16_m2(u16_src1_m2, 16 * sizeof(uint16_t));
  muint16m2_t u16_ts2_m2 = mlce16_m2(u16_src2_m2, 16 * sizeof(uint16_t));
  muint32m4_t u32_out_m4 = mwaddu_mm(u16_ts1_m2, u16_ts2_m2);
  msettype(E32, M4, BA);
  msettileni(16);
  msce32_m(u32_out_m4, u32_buffer, 16 * sizeof(uint32_t));
  EXCEPT_U32_ARRAY_EQ(u32_ans_m4, u32_buffer, 3 * 16, "MWADDU.MM UINT16 M2");
  // uint32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const uint32_t u32_src1_m2[] = {
      23869, 40985, 42387, 23312, 33013, 30097, 32000, 35332,
      46040, 22395, 3336,  12433, 18506, 54803, 58054, 31007,
      45465, 8954,  15607, 16075, 21096, 30164, 25779, 47501,
      13002, 63362, 48722, 47555, 4703,  32601, 31473, 47573};
  const uint32_t u32_src2_m2[] = {
      21101, 49770, 54068, 24393, 63264, 63216, 28560, 11828,
      16333, 48569, 64745, 36203, 14883, 44937, 6916,  35464,
      25092, 62503, 49581, 8478,  57583, 49397, 36021, 6089,
      25978, 35462, 33782, 1727,  37217, 33389, 55978, 32053};
  const uint64_t u64_ans_m4[] = {
      44970, 90755, 96455, 47705, 96277, 93313, 60560, 47160,
      62373, 70964, 68081, 48636, 33389, 99740, 64970, 66471,
      70557, 71457, 65188, 24553, 78679, 79561, 61800, 53590,
      38980, 98824, 82504, 49282, 41920, 65990, 87451, 79626};
  muint32m2_t u32_ts1_m2 = mlce32_m2(u32_src1_m2, 8 * sizeof(uint32_t));
  muint32m2_t u32_ts2_m2 = mlce32_m2(u32_src2_m2, 8 * sizeof(uint32_t));
  muint64m4_t u64_out_m4 = mwaddu_mm(u32_ts1_m2, u32_ts2_m2);
  msettype(E64, M4, BA);
  msettileni(8);
  msce64_m(u64_out_m4, u64_buffer, 8 * sizeof(uint64_t));
  EXCEPT_U64_ARRAY_EQ(u64_ans_m4, u64_buffer, 4 * 8, "MWADDU.MM UINT32 M2");
}

static void test_mwadd_mm() {
  // M1
  // int8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(8);
  const int8_t i8_src1[] = {-65, -38, 24,  -118, -86, 44,   27,  59,
                            11,  -30, -59, -31,  -18, -120, -69, -121};
  const int8_t i8_src2[] = {-113, 29,  79,  66,  -15, -105, -115, -20,
                            47,   -16, 117, 123, -5,  -62,  50,   -74};
  const int16_t i16_ans[] = {-178, -9,  103, -52, -101, -61,  -88, 39,
                             58,   -46, 58,  92,  -23,  -182, -19, -195};
  mint8m1_t i8_ts1 = mlce8_m1(i8_src1, 8 * sizeof(int8_t));
  mint8m1_t i8_ts2 = mlce8_m1(i8_src2, 8 * sizeof(int8_t));
  mint16m2_t i16_out = mwadd_mm(i8_ts1, i8_ts2);
  msettype(E16, M2, BA);
  msce16_m(i16_out, i16_buffer, 8 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans, i16_buffer, 2 * 8, "MWADD.MM INT8  M1");
  // int16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(4);
  const int16_t i16_src1[] = {28995,  1867,  18882,  3451,  14087,  -8139,
                              -10324, 19664, -32626, 27347, -26921, 4729};
  const int16_t i16_src2[] = {25781, -8888,  -2316, -24681, 26123,  6179,
                              2848,  -17963, -1839, 6695,   -14042, -3285};
  const int32_t i32_ans[] = {54776, -7021, 16566,  -21230, 40210,  -1960,
                             -7476, 1701,  -34465, 34042,  -40963, 1444};
  mint16m1_t i16_ts1 = mlce16_m1(i16_src1, 4 * sizeof(int16_t));
  mint16m1_t i16_ts2 = mlce16_m1(i16_src2, 4 * sizeof(int16_t));
  mint32m2_t i32_out = mwadd_mm(i16_ts1, i16_ts2);
  msettype(E32, M2, BA);
  msce32_m(i32_out, i32_buffer, 4 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans, i32_buffer, 3 * 4, "MWADD.MM INT16 M1");
  // int32
  msettype(E32, M1, BA);
  msettilemi(4);
  msettileni(2);
  const int32_t i32_src1[] = {1090650086, -1990265565, -858621895, -1160940975,
                              259684512,  1885624264,  1924533168, 2121025758};
  const int32_t i32_src2[] = {783660534,  1517195617,  -1231743937, 1679695962,
                              1650229994, -1798305443, -1515116491, -699920394};
  const int64_t i64_ans[] = {1874310620, -473069948, -2090365832, 518754987,
                             1909914506, 87318821,   409416677,   1421105364};
  mint32m1_t i32_ts1 = mlce32_m1(i32_src1, 2 * sizeof(int32_t));
  mint32m1_t i32_ts2 = mlce32_m1(i32_src2, 2 * sizeof(int32_t));
  mint64m2_t i64_out = mwadd_mm(i32_ts1, i32_ts2);
  msettype(E64, M2, BA);
  msce64_m(i64_out, i64_buffer, 2 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans, i64_buffer, 4 * 2, "MWADD.MM INT32 M1");
  // M2
  // int8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(16);
  const int8_t i8_src1_m2[] = {57,   93,  -66, 60,  107, -103, -105, 30,
                               -52,  77,  7,   -48, -95, -13,  -79,  -58,
                               -104, -48, 20,  74,  81,  -92,  -126, -17,
                               -4,   86,  52,  51,  -1,  -9,   124,  47};
  const int8_t i8_src2_m2[] = {-97,  19,   43,  -126, 5,    -71, 52,  -102,
                               108,  -57,  101, 57,   -101, -41, -11, 93,
                               -5,   -41,  23,  -83,  62,   -57, 0,   87,
                               -119, -115, 121, 124,  -92,  -19, -17, -65};
  const int16_t i16_ans_m4[] = {-40,  112, -23, -66, 112,  -174, -53,  -72,
                                56,   20,  108, 9,   -196, -54,  -90,  35,
                                -109, -89, 43,  -9,  143,  -149, -126, 70,
                                -123, -29, 173, 175, -93,  -28,  107,  -18};
  mint8m2_t i8_ts1_m2 = mlce8_m2(i8_src1_m2, 16 * sizeof(int8_t));
  mint8m2_t i8_ts2_m2 = mlce8_m2(i8_src2_m2, 16 * sizeof(int8_t));
  mint16m4_t i16_out_m4 = mwadd_mm(i8_ts1_m2, i8_ts2_m2);
  msettype(E16, M4, BA);
  msettileni(16);
  msce16_m(i16_out_m4, i16_buffer, 16 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m4, i16_buffer, 2 * 16, "MWADD.MM INT8  M2");
  // int16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(8);
  const int16_t i16_src1_m2[] = {3766,  -12019, -9680,  13188,  9625,   -12523,
                                 16820, -12527, -21256, 25787,  21413,  24657,
                                 12553, 879,    28187,  -22650, -13585, -10735,
                                 2454,  6344,   10201,  29436,  -26390, -21677};
  const int16_t i16_src2_m2[] = {-9935,  -19974, -6497,  -13771, 17678, 6014,
                                 -25330, 4668,   31305,  -3529,  27689, 360,
                                 3130,   9598,   -30633, -22915, 26576, -3548,
                                 21456,  -26651, -26722, 10163,  9211,  8227};
  const int32_t i32_ans_m4[] = {-6169, -31993, -16177, -583,   27303,  -6509,
                                -8510, -7859,  10049,  22258,  49102,  25017,
                                15683, 10477,  -2446,  -45565, 12991,  -14283,
                                23910, -20307, -16521, 39599,  -17179, -13450};
  mint16m2_t i16_ts1_m2 = mlce16_m2(i16_src1_m2, 8 * sizeof(int16_t));
  mint16m2_t i16_ts2_m2 = mlce16_m2(i16_src2_m2, 8 * sizeof(int16_t));
  mint32m4_t i32_out_m4 = mwadd_mm(i16_ts1_m2, i16_ts2_m2);
  msettype(E32, M4, BA);
  msettileni(8);
  msce32_m(i32_out_m4, i32_buffer, 8 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m4, i32_buffer, 3 * 8, "MWADD.MM INT16 M2");
  // int32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(4);
  const int32_t i32_src1_m2[] = {
      -1818016853, -933457735,  1540367800, 2111325480, 960350050, -948943686,
      594634040,   -224470036,  1521912710, 349694792,  -85932701, -893556227,
      -1693170801, -1740398221, 435544067,  -1183639198};
  const int32_t i32_src2_m2[] = {
      -729497092,  1374022118,  1024052805, -927521427, 596859875, -1383823266,
      625832679,   -1930276653, 118957588,  -305045948, -22932010, -1859365076,
      -1025102697, -570878231,  -810186364, -1504552183};
  const int64_t i64_ans_m4[] = {
      -2547513945, 440564383,   2564420605, 1183804053, 1557209925, -2332766952,
      1220466719,  -2154746689, 1640870298, 44648844,   -108864711, -2752921303,
      -2718273498, -2311276452, -374642297, -2688191381};
  mint32m2_t i32_ts1_m2 = mlce32_m2(i32_src1_m2, 4 * sizeof(int32_t));
  mint32m2_t i32_ts2_m2 = mlce32_m2(i32_src2_m2, 4 * sizeof(int32_t));
  mint64m4_t i64_out_m4 = mwadd_mm(i32_ts1_m2, i32_ts2_m2);
  msettype(E64, M4, BA);
  msettileni(4);
  msce64_m(i64_out_m4, i64_buffer, 4 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m4, i64_buffer, 4 * 4, "MWADD.MM INT32 M2");
}

int main() {
  test_maddu_mm();
  test_madd_mm();
  test_msadd_mm();
  test_msaddu_mm();
  test_mfadd_mm();
  test_mfwadd_mm();
  test_mwaddu_mm();
  test_mwadd_mm();
  return 0;
}
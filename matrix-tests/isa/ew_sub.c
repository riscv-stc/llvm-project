#include "utils.h"
#include <riscv_matrix.h>

static void test_msub_mm() {
  // M1
  // int8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(16);
  const int8_t i8_src1[] = {-19, 33,  47,  -42, -18, -7,  33, -1,
                            -41, -12, 47,  17,  32,  -32, 38, 43,
                            -47, -34, -33, -42, -10, 45,  3,  -44,
                            4,   8,   -14, 19,  19,  34,  4,  -10};
  const int8_t i8_src2[] = {29, -3, -18, 24, -47, -44, 44,  -30, 27,  9,  5,
                            14, 5,  -49, 3,  -47, -15, -19, -4,  37,  38, -5,
                            3,  39, -15, 31, -36, 23,  -27, -31, -18, -46};
  const int8_t i8_ans[] = {-48, 36,  65, -66, 29, 37,  -11, 29,  -68, -21, 42,
                           3,   27,  17, 35,  90, -32, -15, -29, -79, -48, 50,
                           0,   -83, 19, -23, 22, -4,  46,  65,  22,  36};
  mint8m1_t i8_ts1 = mlce8_m1(i8_src1, 16 * sizeof(int8_t));
  mint8m1_t i8_ts2 = mlce8_m1(i8_src2, 16 * sizeof(int8_t));
  mint8m1_t i8_out = msub_mm(i8_ts1, i8_ts2);
  msce8_m(i8_out, i8_buffer, 16 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans, i8_buffer, 32, "  MSUB.MM   INT8   M1");
  // int16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(8);
  const int16_t i16_src1[] = {344,   -151,  2471, 826,   2738,  2656,
                              1659,  891,   -333, -2638, 2742,  -2443,
                              -1692, -2205, 1646, -2014, -1620, 1820,
                              1379,  1655,  -894, -2043, -1467, -1095};
  const int16_t i16_src2[] = {-896, -2345, 1499,  -1572, 2129,  -601,
                              2574, -1020, -1718, -644,  -1438, 687,
                              421,  -24,   -1462, -121,  1644,  561,
                              381,  566,   191,   -772,  -2233, 2332};
  const int16_t i16_ans[] = {1240,  2194,  972,   2398,  609,   3257,
                             -915,  1911,  1385,  -1994, 4180,  -3130,
                             -2113, -2181, 3108,  -1893, -3264, 1259,
                             998,   1089,  -1085, -1271, 766,   -3427};
  mint16m1_t i16_ts1 = mlce16_m1(i16_src1, 8 * sizeof(int16_t));
  mint16m1_t i16_ts2 = mlce16_m1(i16_src2, 8 * sizeof(int16_t));
  mint16m1_t i16_out = msub_mm(i16_ts1, i16_ts2);
  msce16_m(i16_out, i16_buffer, 8 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans, i16_buffer, 24, "  MSUB.MM   INT16  M1");
  // int32
  msettype(E32, M1, BA);
  msettilemi(2);
  msettileni(4);
  const int32_t i32_src1[] = {52338693, -108093270, 79881692,  120283666,
                              1161047,  -115316564, 136804339, 32185597};
  const int32_t i32_src2[] = {64372529, -53058713, 130344642, 122792574,
                              57231738, -52741573, 128387348, 15929685};
  const int32_t i32_ans[] = {-12033836, -55034557, -50462950, -2508908,
                             -56070691, -62574991, 8416991,   16255912};
  mint32m1_t i32_ts1 = mlce32_m1(i32_src1, 4 * sizeof(int32_t));
  mint32m1_t i32_ts2 = mlce32_m1(i32_src2, 4 * sizeof(int32_t));
  mint32m1_t i32_out = msub_mm(i32_ts1, i32_ts2);
  msce32_m(i32_out, i32_buffer, 4 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans, i32_buffer, 8, "  MSUB.MM   INT32  M1");
  // int64
  msettype(E64, M1, BA);
  msettilemi(2);
  msettileni(2);
  const int64_t i64_src1[] = {-148971193621062913, -58239145215775087,
                              -84356269946099806, 152190707032328961};
  const int64_t i64_src2[] = {79891203103570693, -212294042348498276,
                              -199722845344692284, 65389913666633081};
  const int64_t i64_ans[] = {-228862396724633606, 154054897132723189,
                             115366575398592478, 86800793365695880};
  mint64m1_t i64_ts1 = mlce64_m1(i64_src1, 2 * sizeof(int64_t));
  mint64m1_t i64_ts2 = mlce64_m1(i64_src2, 2 * sizeof(int64_t));
  mint64m1_t i64_out = msub_mm(i64_ts1, i64_ts2);
  msce64_m(i64_out, i64_buffer, 2 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans, i64_buffer, 4, "  MSUB.MM   INT64  M1");
  // M2
  // int8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const int8_t i8_src1_m2[] = {
      26,   88,  -59,  6,   -116, 38,   -120, 94,   -122, -118, -33, 121,  126,
      -115, -57, -105, 5,   -126, 79,   -94,  22,   40,   2,    64,  105,  5,
      93,   44,  107,  91,  80,   -98,  109,  -92,  22,   -109, -41, 79,   -9,
      -61,  -6,  -46,  109, 125,  -112, -88,  -123, 71,   -104, 37,  -100, 85,
      0,    124, 105,  -85, 46,   36,   -24,  -57,  -75,  64,   45,  85};
  const int8_t i8_src2_m2[] = {
      35,   -36, 113,  39,  -68,  80,  -122, -123, -106, -82,  -123, -33,  62,
      -119, -88, -100, 12,  -68,  -36, 57,   56,   -116, 54,   49,   -123, 74,
      34,   41,  78,   90,  -57,  100, 35,   23,   102,  41,   -96,  90,   -33,
      -114, 58,  -42,  -82, -105, -91, -17,  -104, -69,  -41,  14,   92,   -119,
      -25,  -48, -110, 124, 108,  -81, -6,   -27,  67,   -112, 83,   -34};
  const int8_t i8_ans_m2[] = {
      -9, 124, -172, -33,  -48, -42,  2,    217,  -16,  -36,  90,  154,  64,
      4,  31,  -5,   -7,   -58, 115,  -151, -34,  156,  -52,  15,  228,  -69,
      59, 3,   29,   1,    137, -198, 74,   -115, -80,  -150, 55,  -11,  24,
      53, -64, -4,   191,  230, -21,  -71,  -19,  140,  -63,  23,  -192, 204,
      25, 172, 215,  -209, -62, 117,  -18,  -30,  -142, 176,  -38, 119};
  mint8m2_t i8_ts1_m2 = mlce8_m2(i8_src1_m2, 32 * sizeof(int8_t));
  mint8m2_t i8_ts2_m2 = mlce8_m2(i8_src2_m2, 32 * sizeof(int8_t));
  mint8m2_t i8_out_m2 = msub_mm(i8_ts1_m2, i8_ts2_m2);
  msce8_m(i8_out_m2, i8_buffer, 32 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m2, i8_buffer, 2 * 32, " MSUB.MM   INT8   M2");
  // int16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const int16_t i16_src1_m2[] = {
      -3064, 2580,  2001, 1333, -1138, -3116, -1079, -138,  2686, 1634,
      -1538, -1019, 575,  1501, -1537, -676,  422,   -2485, 86,   672,
      -2645, -1495, 1564, 690,  -2948, 1416,  1809,  288,   1485, 662,
      2285,  3135,  2538, 573,  -511,  -1229, -1253, -953,  2537, 2699,
      1330,  560,   2916, 1344, -2089, -2464, 244,   -1938};
  const int16_t i16_src2_m2[] = {
      403,   3098,  -303, -2827, 2911,  2145,  -2101, -1216, 3238, -55,
      882,   -48,   1219, -690,  -1091, 2357,  -3170, 1466,  741,  -312,
      744,   -1969, 845,  1347,  -1799, 1720,  2158,  -1875, -318, -1173,
      -1946, -1927, 975,  133,   1339,  -1395, 924,   -492,  644,  -1380,
      1804,  65,    3149, 1610,  859,   3225,  2145,  -1986};
  const int16_t i16_ans_m2[] = {
      -3467, -518, 2304, 4160, -4049, -5261, 1022,  1078,  -552, 1689,
      -2420, -971, -644, 2191, -446,  -3033, 3592,  -3951, -655, 984,
      -3389, 474,  719,  -657, -1149, -304,  -349,  2163,  1803, 1835,
      4231,  5062, 1563, 440,  -1850, 166,   -2177, -461,  1893, 4079,
      -474,  495,  -233, -266, -2948, -5689, -1901, 48};
  mint16m2_t i16_ts1_m2 = mlce16_m2(i16_src1_m2, 16 * sizeof(int16_t));
  mint16m2_t i16_ts2_m2 = mlce16_m2(i16_src2_m2, 16 * sizeof(int16_t));
  mint16m2_t i16_out_m2 = msub_mm(i16_ts1_m2, i16_ts2_m2);
  msce16_m(i16_out_m2, i16_buffer, 16 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m2, i16_buffer, 3 * 16, " MSUB.MM   INT16  M2");
  // int32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const int32_t i32_src1_m2[] = {
      -79261921,  -106480238, 17096794,  200093382,  19697999,   -57748931,
      180580480,  22947261,   163516831, -184418973, -174682451, 134325173,
      -144736942, 80324802,   177139388, 190676320,  97371925,   -146822113,
      -83731847,  24637429,   117447065, -98751227,  211089114,  202968223,
      -134961968, 173677771,  12266751,  -24363442,  45697385,   -55599774,
      84123700,   -59758538};
  const int32_t i32_src2_m2[] = {
      173632182,  29669463,   -53701566, -212357061, -63199005,  167510909,
      -11585862,  -191745330, -64865585, 175652508,  -88655773,  43574531,
      85138474,   118364417,  197811108, -119807647, -121720380, 48040696,
      -77698950,  -64428764,  161300645, 118589191,  125804897,  112088208,
      165196547,  -128412344, 51635848,  -138355838, -115216882, 10142558,
      -190182785, 136247106};
  const int32_t i32_ans_m2[] = {
      -252894103, -136149701, 70798360,  412450443,  82897004,  -225259840,
      192166342,  214692591,  228382416, -360071481, -86026678, 90750642,
      -229875416, -38039615,  -20671720, 310483967,  219092305, -194862809,
      -6032897,   89066193,   -43853580, -217340418, 85284217,  90880015,
      -300158515, 302090115,  -39369097, 113992396,  160914267, -65742332,
      274306485,  -196005644};
  mint32m2_t i32_ts1_m2 = mlce32_m2(i32_src1_m2, 8 * sizeof(int32_t));
  mint32m2_t i32_ts2_m2 = mlce32_m2(i32_src2_m2, 8 * sizeof(int32_t));
  mint32m2_t i32_out_m2 = msub_mm(i32_ts1_m2, i32_ts2_m2);
  msce32_m(i32_out_m2, i32_buffer, 8 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m2, i32_buffer, 4 * 8, " MSUB.MM   INT32  M2");
  // int64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const int64_t i64_src1_m2[] = {
      -417820369236064549, -41364186115692056, -256446641457214909,
      -608599455958587520, 281828851203760391, -545267693684266352,
      -511798496020154582, 7029699004772486,   122933883656206958,
      156280174354019263,  77969980880879405,  -225696837966013035,
      -86988676039494776,  92833346101520006,  596389529849451804,
      -72501027510714800,  210938765229992504, 744655725612551039,
      -265249839125950588, -797083593967511709};
  const int64_t i64_src2_m2[] = {
      -830671543845920806, 263949192827774438, 882821362373275905,
      -208598823395851715, 740517595885508338, 684784678916491886,
      914709949966405384,  471719959058559501, -48475880438509903,
      -680136627725108025, 73908683171894520,  -677913832244093675,
      -738740220180502935, -42782460730075392, -174296949280159456,
      -77066195426933144,  489078992325692444, 579207295975580241,
      -502022749832725746, -52813426818321145};
  const int64_t i64_ans_m2[] = {
      412851174609856257,   -305313378943466494, -1139268003830490814,
      -400000632562735805,  -458688744681747947, -1230052372600758238,
      -1426508445986559966, -464690260053787015, 171409764094716861,
      836416802079127288,   4061297708984885,    452216994278080640,
      651751544141008159,   135615806831595398,  770686479129611260,
      4565167916218344,     -278140227095699940, 165448429636970798,
      236772910706775158,   -744270167149190564};
  mint64m2_t i64_ts1_m2 = mlce64_m2(i64_src1_m2, 4 * sizeof(int64_t));
  mint64m2_t i64_ts2_m2 = mlce64_m2(i64_src2_m2, 4 * sizeof(int64_t));
  mint64m2_t i64_out_m2 = msub_mm(i64_ts1_m2, i64_ts2_m2);
  msce64_m(i64_out_m2, i64_buffer, 4 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m2, i64_buffer, 5 * 4, " MSUB.MM   INT64  M2");
  // M4
  // int8
  msettype(E8, M4, BA);
  msettilemi(2);
  msettileni(33);
  const int8_t i8_src1_m4[] = {
      5,   -10, 1,   3,  -10, -11, -6, 9,   -8,  -1,  -7, 1,  -8, 0,
      -12, 8,   -7,  -2, 9,   -2,  11, 3,   7,   1,   1,  -9, 4,  10,
      6,   -12, 9,   -3, 1,   10,  -4, -1,  -12, -12, -5, -1, -7, -7,
      9,   4,   6,   -3, -10, 1,   -8, -12, 0,   -2,  6,  -5, -6, -11,
      5,   -1,  -11, 1,  6,   -4,  -2, -3,  -1,  -5};
  const int8_t i8_src2_m4[] = {
      5,  -5,  0,  -1, -8, -10, 0,  -9, 7,   -7,  -12, 5,  6,  5,  4,   11, -8,
      0,  -11, 6,  -2, 6,  -6,  -4, 4,  8,   -4,  -8,  -3, 5,  5,  -1,  -2, 8,
      5,  -6,  8,  -5, 4,  -12, -3, 10, 3,   -5,  0,   7,  7,  -5, -11, 3,  1,
      -3, 4,   -8, 8,  -3, -1,  -8, -5, -10, -10, 0,   8,  -5, 4,  -6};
  const int8_t i8_ans_m4[] = {0,  -5,  1,   4,   -2, -1,  -6, 18,  -15, 6,  5,
                              -4, -14, -5,  -16, -3, 1,   -2, 20,  -8,  13, -3,
                              13, 5,   -3,  -17, 8,  18,  9,  -17, 4,   -2, 3,
                              2,  -9,  5,   -20, -7, -9,  11, -4,  -17, 6,  9,
                              6,  -10, -17, 6,   3,  -15, -1, 1,   2,   3,  -14,
                              -8, 6,   7,   -6,  11, 16,  -4, -10, 2,   -5, 1};
  mint8m4_t i8_ts1_m4 = mlce8_m4(i8_src1_m4, 33 * sizeof(int8_t));
  mint8m4_t i8_ts2_m4 = mlce8_m4(i8_src2_m4, 33 * sizeof(int8_t));
  mint8m4_t i8_out_m4 = msub_mm(i8_ts1_m4, i8_ts2_m4);
  msce8_m(i8_out_m4, i8_buffer, 33 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m4, i8_buffer, 2 * 33, " MSUB.MM   INT8   M4");
  // int16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(17);
  const int16_t i16_src1_m4[] = {
      -1658, -2699, -3111, -1313, -2038, 712,  1180,  -2938, -344,  -449, -1399,
      2055,  1798,  2418,  -1670, 1794,  2763, -3157, 731,   2277,  811,  -2007,
      1561,  -1530, 2875,  -2734, 892,   2443, 144,   3047,  -3004, 2509, -2289,
      -3181, 1625,  1061,  -2647, 1409,  2250, -2178, -1144, -1271, 3129, -313,
      212,   1846,  -2624, -850,  927,   -601, 884};
  const int16_t i16_src2_m4[] = {
      -2319, -2836, 2396, -2560, -1622, -3011, -2940, -1052, 1082,
      -2246, 1852,  -894, 406,   2352,  -433,  1638,  1941,  -516,
      202,   -3170, 1460, -633,  -1124, -1518, 1640,  -2852, 416,
      3223,  2869,  -932, -3248, -113,  -2776, -2591, -2889, -3271,
      -1080, -2514, 2981, 1497,  2346,  -2181, 1479,  172,   2665,
      1171,  -440,  1550, 1149,  -94,   -1799};
  const int16_t i16_ans_m4[] = {
      661,   137,  -5507, 1247,  -416, 3723, 4120,  -1886, -1426, 1797, -3251,
      2949,  1392, 66,    -1237, 156,  822,  -2641, 529,   5447,  -649, -1374,
      2685,  -12,  1235,  118,   476,  -780, -2725, 3979,  244,   2622, 487,
      -590,  4514, 4332,  -1567, 3923, -731, -3675, -3490, 910,   1650, -485,
      -2453, 675,  -2184, -2400, -222, -507, 2683};
  mint16m4_t i16_ts1_m4 = mlce16_m4(i16_src1_m4, 16 * sizeof(int16_t));
  mint16m4_t i16_ts2_m4 = mlce16_m4(i16_src2_m4, 16 * sizeof(int16_t));
  mint16m4_t i16_out_m4 = msub_mm(i16_ts1_m4, i16_ts2_m4);
  msce16_m(i16_out_m4, i16_buffer, 16 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m4, i16_buffer, 3 * 17, " MSUB.MM   INT16  M4");
  // int32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(9);
  const int32_t i32_src1_m4[] = {
      -35463059,  -149196154, -86006296,  22633129,   140017686,  86335879,
      168792526,  -22337031,  96224198,   42307916,   213612923,  -93330743,
      -169183727, 93771567,   121442691,  104346906,  -198444597, -165573634,
      48705353,   161165154,  -149635134, -129430102, -189063372, -4279540,
      195513678,  -58052034,  -128684417, -74150899,  -80087640,  110501317,
      115635167,  166793159,  -173125975, -151046365, -39178476,  172190399};
  const int32_t i32_src2_m4[] = {
      -14776201,  110417103, -192760566, -212898305, -187823069, -75226708,
      -87015593,  117156581, -53849725,  174859926,  -191122786, 116668835,
      -61493969,  197293042, 67952976,   -119796090, 109375226,  182376395,
      193179989,  80395019,  78856813,   114338057,  -152410526, -36258505,
      -214666369, -92045198, -139513001, -171337682, -84751745,  -71110271,
      82916089,   -62654175, -92396165,  -101117707, 214118277,  -90850360};
  const int32_t i32_ans_m4[] = {
      -20686858,  -259613257, 106754270,  235531434,  327840755,  161562587,
      255808119,  -139493612, 150073923,  -132552010, 404735709,  -209999578,
      -107689758, -103521475, 53489715,   224142996,  -307819823, -347950029,
      -144474636, 80770135,   -228491947, -243768159, -36652846,  31978965,
      410180047,  33993164,   10828584,   97186783,   4664105,    181611588,
      32719078,   229447334,  -80729810,  -49928658,  -253296753, 263040759};
  mint32m4_t i32_ts1_m4 = mlce32_m4(i32_src1_m4, 9 * sizeof(int32_t));
  mint32m4_t i32_ts2_m4 = mlce32_m4(i32_src2_m4, 9 * sizeof(int32_t));
  mint32m4_t i32_out_m4 = msub_mm(i32_ts1_m4, i32_ts2_m4);
  msce32_m(i32_out_m4, i32_buffer, 9 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m4, i32_buffer, 4 * 9, " MSUB.MM   INT32  M4");
  // int64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(5);
  const int64_t i64_src1_m4[] = {
      -493266044764880716, 144672415308125888,  -73335974201379348,
      -669233504615549269, -595688594293118686, -251828185620492670,
      -493244317890489344, 508753597817793766,  -703501086232595867,
      -426220466335838328, 326910771305413087,  842973504652477528,
      298411778137813473,  153545844548261479,  104725697244523170,
      870510671554579651,  117798485251526318,  365004133653665980,
      -867117194880447050, -239990656613330678, 487411097528444700,
      517726755563253699,  739493407386915494,  808832753924199508,
      695109238685980011};
  const int64_t i64_src2_m4[] = {
      838232997395411529,  -645543595211093844, -84515774365821350,
      -872196712758932260, 113271610073568317,  -476668704692626122,
      -840577163376812211, -688433678732342444, -652975027063476609,
      473391948045450078,  -288319986935916071, 61882307181172414,
      -330328469764737726, -123519224176975132, 749913706850806296,
      494431215514895491,  -401146442711298085, 5161352689092443,
      -6868669311682832,   -515045279142918265, -274368535704856628,
      -78996470671583438,  153841397608832269,  489381427122588896,
      752129077677676107};
  const int64_t i64_ans_m4[] = {
      -1331499042160292245, 790216010519219732,  11179800164442002,
      202963208143382991,   -708960204366687003, 224840519072133452,
      347332845486322867,   1197187276550136210, -50526059169119258,
      -899612414381288406,  615230758241329158,  781091197471305114,
      628740247902551199,   277065068725236611,  -645188009606283126,
      376079456039684160,   518944927962824403,  359842780964573537,
      -860248525568764218,  275054622529587587,  761779633233301328,
      596723226234837137,   585652009778083225,  319451326801610612,
      -57019838991696096};
  mint64m4_t i64_ts1_m4 = mlce64_m4(i64_src1_m4, 5 * sizeof(int64_t));
  mint64m4_t i64_ts2_m4 = mlce64_m4(i64_src2_m4, 5 * sizeof(int64_t));
  mint64m4_t i64_out_m4 = msub_mm(i64_ts1_m4, i64_ts2_m4);
  msce64_m(i64_out_m4, i64_buffer, 5 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m4, i64_buffer, 5 * 5, " MSUB.MM   INT64  M4");
}

static void test_mfsub_mm() {
  // M1
  // fp16
  msettype(E16, M1, BA);
  msettilemi(2);
  msettileni(8);
  const fp16_t fp16_src1[] = {
      0.9395, 0.6045,  2.057,  0.5273, -0.07416, -1.025, -1.199, 1.227,
      -1.036, 0.03806, -1.367, 0.9097, -0.2108,  1.69,   -0.847, 0.263};
  const fp16_t fp16_src2[] = {-0.5894, 1.588,  0.1305,  0.5547, 1.489, 0.4292,
                              -0.3936, -1.087, -0.5493, 0.4998, 0.745, -0.9927,
                              0.4783,  -2.176, 1.634,   -0.957};
  const fp16_t fp16_ans[] = {
      1.529,   -0.9834, 1.926,  -0.02734, -1.563, -1.455, -0.8057, 2.312,
      -0.4868, -0.4617, -2.113, 1.902,    -0.689, 3.867,  -2.48,   1.22};
  mfloat16m1_t fp16_ts1 = mlce16_m1(fp16_src1, 8 * sizeof(fp16_t));
  mfloat16m1_t fp16_ts2 = mlce16_m1(fp16_src2, 8 * sizeof(fp16_t));
  mfloat16m1_t fp16_out = mfsub_mm(fp16_ts1, fp16_ts2);
  msce16_m(fp16_out, fp16_buffer, 8 * sizeof(fp16_t));
  EXCEPT_FP16_ARRAY_LAX_EQ(fp16_ans, fp16_buffer, 16, " MFSUB.MM  FP16   M1");
  // fp32
  msettype(E32, M1, BA);
  msettilemi(3);
  msettileni(4);
  const fp32_t fp32_src1[] = {0.6403861,  1.3311914,  0.38499016,  -0.68517655,
                              0.80222446, -0.3317214, -0.68247175, 2.1664765,
                              0.36367753, 0.55353874, 0.10293009,  -0.6820138};
  const fp32_t fp32_src2[] = {0.5378959,   -1.0046346, 0.47052062,  -1.0221447,
                              -0.00323629, 0.08907796, -0.09354929, -1.3511561,
                              -0.99879915, -1.3433665, 1.2864497,   0.75156915};
  const fp32_t fp32_ans[] = {0.10249019, 2.335826,    -0.08553046, 0.33696812,
                             0.80546075, -0.42079937, -0.58892244, 3.5176325,
                             1.3624767,  1.8969052,   -1.1835196,  -1.433583};
  mfloat32m1_t fp32_ts1 = mlce32_m1(fp32_src1, 4 * sizeof(fp32_t));
  mfloat32m1_t fp32_ts2 = mlce32_m1(fp32_src2, 4 * sizeof(fp32_t));
  mfloat32m1_t fp32_out = mfsub_mm(fp32_ts1, fp32_ts2);
  msce32_m(fp32_out, fp32_buffer, 4 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_LAX_EQ(fp32_ans, fp32_buffer, 12, " MFSUB.MM  FP32   M1");
  // fp64
  msettype(E64, M1, BA);
  msettilemi(4);
  msettileni(2);
  const fp64_t fp64_src1[] = {0.81540121,  0.17822343, -0.32718181, -1.91187476,
                              -0.42765431, 0.96722424, -1.27612258, 0.26657557};
  const fp64_t fp64_src2[] = {-0.15138872, -0.5337128, -0.15211178,
                              -0.37436564, 1.12698289, 1.93873658,
                              -0.23029628, -1.47119568};
  const fp64_t fp64_ans[] = {0.96678993, 0.71193623,  -0.17507003, -1.53750912,
                             -1.5546372, -0.97151234, -1.0458263,  1.73777125};
  mfloat64m1_t fp64_ts1 = mlce64_m1(fp64_src1, 2 * sizeof(fp64_t));
  mfloat64m1_t fp64_ts2 = mlce64_m1(fp64_src2, 2 * sizeof(fp64_t));
  mfloat64m1_t fp64_out = mfsub_mm(fp64_ts1, fp64_ts2);
  msce64_m(fp64_out, fp64_buffer, 2 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_LAX_EQ(fp64_ans, fp64_buffer, 8, " MFSUB.MM  FP64   M1");
  // M2
  // fp16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const fp16_t fp16_src1_m2[] = {
      8.76,   9.805,  7.234,  -2.162,  9.5,    4.31,   -3.918,  -0.07355,
      8.16,   6.434,  -6.145, 1.478,   -3.678, 6.402,  -0.7607, -9.375,
      -7.094, -2.482, -4.227, -0.1497, -1.126, 1.401,  -0.4404, 1.252,
      -2.715, 6.547,  4.734,  2.033,   -6.723, -7.383, 3.438,   -4.844,
      3.383,  -4.637, -1.852, -2.15,   8.97,   5.574,  -2.256,  -7.016,
      5.99,   -1.433, 8.58,   6.105,   5.535,  -6.6,   -5.17,   -1.622};
  const fp16_t fp16_src2_m2[] = {
      2.322,  0.687,  -2.879, 4.11,    2.977,  6.406,  4.19,   8.24,
      -2.756, -5.97,  8.11,   -8.18,   1.622,  -8.04,  4.266,  -5.89,
      0.3418, -4.09,  -6.51,  7.215,   -8.23,  -9.81,  1.788,  3.133,
      6.438,  -3.977, 9.03,   0.9087,  -1.372, -4.52,  6.812,  -7.008,
      -7.05,  5.62,   8.234,  9.6,     0.9717, -5.062, -4.508, 5.76,
      -5.324, 4.215,  3.727,  -0.4434, 3.857,  9.87,   -5.234, 2.879};
  const fp16_t fp16_ans_m2[] = {
      6.438,  9.12,   10.11,   -6.273, 6.523, -2.098, -8.11,  -8.31,
      10.914, 12.41,  -14.25,  9.66,   -5.3,  14.44,  -5.027, -3.484,
      -7.438, 1.607,  2.285,   -7.363, 7.1,   11.21,  -2.229, -1.881,
      -9.16,  10.52,  -4.297,  1.125,  -5.35, -2.863, -3.375, 2.164,
      10.44,  -10.26, -10.086, -11.75, 7.996, 10.64,  2.252,  -12.78,
      11.31,  -5.65,  4.85,    6.547,  1.678, -16.47, 0.0625, -4.5};
  mfloat16m2_t fp16_ts1_m2 = mlce16_m2(fp16_src1_m2, 16 * sizeof(fp16_t));
  mfloat16m2_t fp16_ts2_m2 = mlce16_m2(fp16_src2_m2, 16 * sizeof(fp16_t));
  mfloat16m2_t fp16_out_m2 = mfsub_mm(fp16_ts1_m2, fp16_ts2_m2);
  msce16_m(fp16_out_m2, fp16_buffer, 16 * sizeof(fp16_t));
  EXCEPT_FP16_ARRAY_LAX_EQ(fp16_ans_m2, fp16_buffer, 3 * 16,
                           " MFSUB.MM  FP16   M2");
  // fp32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const fp32_t fp32_src1_m2[] = {
      -6.7236047,  -6.4174104,  -2.2853348, 4.4403486,   6.166284,   -8.334726,
      -0.55975837, -0.48656672, -9.324752,  4.16045,     -3.0523925, -1.8432268,
      7.694324,    -2.3218155,  -0.5061643, 0.24564418,  -5.803904,  8.877941,
      6.231344,    3.9169476,   2.1331952,  -0.9421075,  2.5628393,  8.787774,
      0.7498831,   8.571016,    1.2412578,  -0.59428245, -9.524522,  -0.223949,
      -3.021853,   2.2974563};
  const fp32_t fp32_src2_m2[] = {
      2.543541,   3.6960874, -1.0840153, 9.906147,   9.278931,   8.541276,
      4.0251265,  4.614213,  -2.3812068, 6.1404486,  1.8620875,  -9.880444,
      -3.6280355, 4.0688386, -1.2674198, 5.5625587,  3.0966246,  0.8805318,
      -3.374762,  3.508311,  4.76638,    -3.1389337, -5.4546947, 6.8415403,
      -8.274056,  -1.219215, -8.14422,   -5.6623087, -8.305844,  -9.616161,
      6.138127,   2.13075};
  const fp32_t fp32_ans_m2[] = {
      -9.267145,  -10.113498, -1.2013196, -5.4657984, -3.1126466, -16.876003,
      -4.5848846, -5.1007795, -6.9435453, -1.9799986, -4.91448,   8.037217,
      11.322359,  -6.390654,  0.7612555,  -5.3169146, -8.900529,  7.9974093,
      9.606106,   0.40863657, -2.6331847, 2.1968262,  8.017534,   1.9462337,
      9.023939,   9.790232,   9.385478,   5.068026,   -1.2186775, 9.392212,
      -9.15998,   0.16670632};
  mfloat32m2_t fp32_ts1_m2 = mlce32_m2(fp32_src1_m2, 8 * sizeof(fp32_t));
  mfloat32m2_t fp32_ts2_m2 = mlce32_m2(fp32_src2_m2, 8 * sizeof(fp32_t));
  mfloat32m2_t fp32_out_m2 = mfsub_mm(fp32_ts1_m2, fp32_ts2_m2);
  msce32_m(fp32_out_m2, fp32_buffer, 8 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_LAX_EQ(fp32_ans_m2, fp32_buffer, 4 * 8,
                           " MFSUB.MM  FP32   M2");
  // fp64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const fp64_t fp64_src1_m2[] = {
      0.32790082, -9.7129422,  -7.52734228, 9.27319996,  -7.37849531,
      8.27124985, 2.4629552,   7.75736963,  8.52563716,  -6.24018224,
      2.76140369, -3.64923967, 4.90329505,  -6.94211709, 3.1771275,
      6.49850346, 9.32924856,  -8.7987883,  -6.49653218, -2.84917266};
  const fp64_t fp64_src2_m2[] = {
      -2.34517359, 2.77461186, -2.51314548, 5.76362865,  3.78102692,
      -7.38270408, 8.20777765, 1.09659595,  -6.89172192, 3.88035532,
      9.34741418,  2.03988063, -7.76389088, 6.8390987,   4.59847474,
      9.7710888,   6.74653787, 6.51403075,  1.17683364,  -4.11148755};
  const fp64_t fp64_ans_m2[] = {
      2.67307442,  -12.48755406, -5.0141968,   3.50957131,   -11.15952223,
      15.65395394, -5.74482246,  6.66077368,   15.41735908,  -10.12053756,
      -6.58601049, -5.68912029,  12.66718593,  -13.78121578, -1.42134725,
      -3.27258534, 2.58271069,   -15.31281905, -7.67336582,  1.26231489};
  mfloat64m2_t fp64_ts1_m2 = mlce64_m2(fp64_src1_m2, 4 * sizeof(fp64_t));
  mfloat64m2_t fp64_ts2_m2 = mlce64_m2(fp64_src2_m2, 4 * sizeof(fp64_t));
  mfloat64m2_t fp64_out_m2 = mfsub_mm(fp64_ts1_m2, fp64_ts2_m2);
  msce64_m(fp64_out_m2, fp64_buffer, 4 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_LAX_EQ(fp64_ans_m2, fp64_buffer, 5 * 4,
                           " MFSUB.MM  FP64   M2");
  // M4
  // fp16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(17);
  const fp16_t fp16_src1_m4[] = {
      7.754,   9.82,   -2.807, -3.66,  3.318, -0.906, -4.723, -3.623, -2.713,
      -4.586,  -1.475, 3.275,  10.,    -10.,  -4.188, 7.582,  2.65,   0.4656,
      9.06,    -2.912, 4.47,   -4.438, 3.693, -4.688, 9.664,  -4.75,  -7.105,
      -1.9795, -9.23,  -4.055, -9.75,  0.466, 2.188,  9.06,   4.66,   2.479,
      0.588,   -2.922, 7.02,   3.76,   -3.74, -6.56,  7.953,  8.25,   6.785,
      -0.837,  -4.254, -4.195, -5.152, 2.783, 4.33};
  const fp16_t fp16_src2_m4[] = {
      -5.086, -4.13,  -0.8276, 9.49,   1.564,  9.33,   5.09,    7.312, -5.902,
      -5.52,  -6.242, 3.725,   0.1056, 7.32,   -9.516, 6.484,   8.484, 3.611,
      -5.305, -2.03,  -0.561,  -4.586, -1.357, 1.319,  8.24,    2.852, 5.277,
      -7.777, 7.156,  3.115,   1.605,  -8.69,  -9.164, -0.4229, 6.496, 7.445,
      3.42,   -2.809, 0.483,   -1.526, -2.29,  -5.137, 2.693,   6.207, -3.922,
      9.,     4.418,  -5.6,    -1.734, -2.47,  4.9};
  const fp16_t fp16_ans_m4[] = {
      12.84,  13.95,   -1.979,  -13.16, 1.754,  -10.234, -9.81, -10.94, 3.19,
      0.9336, 4.766,   -0.4492, 9.89,   -17.31, 5.33,    1.098, -5.836, -3.146,
      14.37,  -0.883,  5.03,    0.1484, 5.05,   -6.008,  1.422, -7.6,   -12.38,
      5.797,  -16.38,  -7.17,   -11.36, 9.16,   11.35,   9.484, -1.836, -4.97,
      -2.832, -0.1133, 6.535,   5.285,  -1.451, -1.422,  5.258, 2.043,  10.7,
      -9.836, -8.67,   1.406,   -3.418, 5.254,  -0.5703};
  mfloat16m4_t fp16_ts1_m4 = mlce16_m4(fp16_src1_m4, 17 * sizeof(fp16_t));
  mfloat16m4_t fp16_ts2_m4 = mlce16_m4(fp16_src2_m4, 17 * sizeof(fp16_t));
  mfloat16m4_t fp16_out_m4 = mfsub_mm(fp16_ts1_m4, fp16_ts2_m4);
  msce16_m(fp16_out_m4, fp16_buffer, 17 * sizeof(fp16_t));
  EXCEPT_FP16_ARRAY_LAX_EQ(fp16_ans_m4, fp16_buffer, 3 * 17,
                           " MFSUB.MM  FP16   M4");
  // fp32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(9);
  const fp32_t fp32_src1_m4[] = {
      -8.029374,  -7.216205, 3.9687438,  1.6479098,  9.994055,   -1.784521,
      3.2783744,  3.973006,  5.3045173,  0.60495096, 5.4042826,  -1.6738998,
      -8.826947,  1.4051539, 8.814899,   3.2101,     9.979045,   3.6786397,
      3.9288995,  9.314495,  4.031416,   -4.4607387, -5.2760906, -9.05595,
      -5.7210336, -1.958004, -9.033871,  -3.2586882, 2.6088505,  3.9738946,
      1.200179,   7.695151,  -8.7036915, -0.3159678, -2.198974,  -0.9512362};
  const fp32_t fp32_src2_m4[] = {
      3.4206061, -5.0131416, 2.1296537,  -8.0229845, -3.996114,  4.198942,
      -8.618744, 1.87411,    -3.8539088, -5.1075206, 5.2802434,  4.7068696,
      -3.943685, 1.4645401,  -3.0704253, 3.09815,    7.3894625,  3.8126104,
      2.3129303, 9.183984,   3.209465,   -4.194788,  -9.159333,  -7.236177,
      -6.87361,  -8.848609,  9.809956,   8.075806,   -1.5428928, -6.780363,
      -8.914172, 0.4578592,  -7.762413,  4.0084662,  -6.245619,  9.97148};
  const fp32_t fp32_ans_m4[] = {
      -11.44998, -2.2030635,  1.8390901,   9.670895,    13.990169,  -5.9834633,
      11.897119, 2.098896,    9.158426,    5.7124715,   0.12403917, -6.3807693,
      -4.883262, -0.05938625, 11.8853245,  0.11194992,  2.5895824,  -0.13397074,
      1.6159692, 0.13051128,  0.8219509,   -0.26595068, 3.8832426,  -1.8197732,
      1.1525764, 6.890605,    -18.843826,  -11.334494,  4.1517434,  10.754257,
      10.114351, 7.237292,    -0.94127846, -4.3244343,  4.046645,   -10.922716};
  mfloat32m4_t fp32_ts1_m4 = mlce32_m4(fp32_src1_m4, 9 * sizeof(fp32_t));
  mfloat32m4_t fp32_ts2_m4 = mlce32_m4(fp32_src2_m4, 9 * sizeof(fp32_t));
  mfloat32m4_t fp32_out_m4 = mfsub_mm(fp32_ts1_m4, fp32_ts2_m4);
  msce32_m(fp32_out_m4, fp32_buffer, 9 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_LAX_EQ(fp32_ans_m4, fp32_buffer, 4 * 9,
                           " MFSUB.MM  FP32   M4");
  // fp64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(5);
  const fp64_t fp64_src1_m4[] = {
      -0.37382516, 1.89550015,  -1.56327465, -1.66318981, 0.76579056,
      5.40139153,  -2.39658609, -5.37265058, 4.35969213,  -0.99004543,
      -9.5100588,  -0.54947483, -1.0261681,  -3.14512418, -1.00895615,
      -2.19440421, 6.62144489,  -5.50790376, -8.45474193, -9.10378876,
      0.41497646,  3.17770224,  -2.30883828, 7.47568547,  4.37564169};
  const fp64_t fp64_src2_m4[] = {
      4.44877602,  0.63850288,  7.93305736,  -4.97910902, -3.40442806,
      4.8609348,   9.90834844,  7.53071799,  -2.31163137, 6.20905921,
      2.39455405,  -0.48492173, 3.85607951,  9.9754496,   -1.14039993,
      0.3751344,   4.35148661,  -9.63275202, 4.14695582,  -4.24801442,
      -2.30719121, 9.22318274,  -0.60104405, -4.19374935, -3.8904752};
  const fp64_t fp64_ans_m4[] = {
      -4.82260118,  1.25699727,   -9.49633201,  3.31591921,   4.17021862,
      0.54045673,   -12.30493453, -12.90336857, 6.6713235,    -7.19910463,
      -11.90461286, -0.0645531,   -4.88224761,  -13.12057378, 0.13144378,
      -2.56953861,  2.26995828,   4.12484826,   -12.60169775, -4.85577434,
      2.72216767,   -6.0454805,   -1.70779423,  11.66943482,  8.26611689};
  mfloat64m4_t fp64_ts1_m4 = mlce64_m4(fp64_src1_m4, 5 * sizeof(fp64_t));
  mfloat64m4_t fp64_ts2_m4 = mlce64_m4(fp64_src2_m4, 5 * sizeof(fp64_t));
  mfloat64m4_t fp64_out_m4 = mfsub_mm(fp64_ts1_m4, fp64_ts2_m4);
  msce64_m(fp64_out_m4, fp64_buffer, 5 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_LAX_EQ(fp64_ans_m4, fp64_buffer, 5 * 5,
                           " MFSUB.MM  FP64   M4");
}

static void test_mssub_mm() {
  // M1
  // uint8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(16);
  const int8_t i8_src1[] = {-83,  89,   63, 20,  116, 105,  -80, 34,
                            -105, 85,   27, -70, 118, -101, 102, 114,
                            78,   -10,  -8, -22, -77, 70,   -8,  -10,
                            -33,  -118, 45, -54, -33, -116, 71,  28};
  const int8_t i8_src2[] = {-115, 40, -71, 124, 76,   92,  74,  -72,
                            99,   16, 0,   21,  -121, -71, -45, -24,
                            37,   22, -96, -98, -87,  87,  94,  89,
                            46,   2,  -73, 104, 24,   43,  -82, 82};
  const int8_t i8_ans[] = {32,   49,   127, -104, 40,  13,   -128, 106,
                           -128, 69,   27,  -91,  127, -30,  127,  127,
                           41,   -32,  88,  76,   10,  -17,  -102, -99,
                           -79,  -120, 118, -128, -57, -128, 127,  -54};
  mint8m1_t i8_ts1 = mlce8_m1(i8_src1, 16 * sizeof(int8_t));
  mint8m1_t i8_ts2 = mlce8_m1(i8_src2, 16 * sizeof(int8_t));
  mint8m1_t i8_out = mssub_mm(i8_ts1, i8_ts2);
  msce8_m(i8_out, i8_buffer, 16 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans, i8_buffer, 32, " MSSUB.MM  INT8   M1");
  // uint16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(8);
  const int16_t i16_src1[] = {-16700, 14775,  -11416, 23869,  16208,  -20777,
                              17083,  21616,  -27908, 1479,   11007,  10465,
                              25858,  -29874, -3139,  -31321, -26773, -22815,
                              -19378, -4682,  5663,   -25656, -19757, -28938};
  const int16_t i16_src2[] = {-7870,  3416,  -4753,  17950,  11786,  -476,
                              -20572, 14147, -31757, -14721, -25293, 10233,
                              -16845, 19029, 9755,   -22215, -30818, 22473,
                              -18919, 13788, 3524,   9570,   -20569, 14296};
  const int16_t i16_ans[] = {-8830, 11359,  -6663,  5919,   4422,  -20301,
                             32767, 7469,   3849,   16200,  32767, 232,
                             32767, -32768, -12894, -9106,  4045,  -32768,
                             -459,  -18470, 2139,   -32768, 812,   -32768};
  mint16m1_t i16_ts1 = mlce16_m1(i16_src1, 8 * sizeof(int16_t));
  mint16m1_t i16_ts2 = mlce16_m1(i16_src2, 8 * sizeof(int16_t));
  mint16m1_t i16_out = mssub_mm(i16_ts1, i16_ts2);
  msce16_m(i16_out, i16_buffer, 8 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans, i16_buffer, 24, " MSSUB.MM  INT16  M1");
  // uint32
  msettype(E32, M1, BA);
  msettilemi(4);
  msettileni(4);
  const int32_t i32_src1[] = {
      -521062926,  1627319443,  1182095884, -821255282, -70164884,  455309834,
      1825072442,  1794676643,  419207531,  2016034618, -640973215, -2061999439,
      -2042814199, -1995069119, 1372580551, -1731187506};
  const int32_t i32_src2[] = {
      -2103843479, 1775132041, 1094046597,  1914437605,  -227192995, 1415364395,
      -1987352719, 369530095,  -1713029478, -1678948844, 1438580662, 1856717822,
      -390045731,  319118207,  1431756702,  1318265047};
  const int32_t i32_ans[] = {
      1582780553,  -147812598,  88049287,    -2147483648,
      157028111,   -960054561,  2147483647,  1425146548,
      2132237009,  2147483647,  -2079553877, -2147483648,
      -1652768468, -2147483648, -59176151,   -2147483648};
  mint32m1_t i32_ts1 = mlce32_m1(i32_src1, 4 * sizeof(int32_t));
  mint32m1_t i32_ts2 = mlce32_m1(i32_src2, 4 * sizeof(int32_t));
  mint32m1_t i32_out = mssub_mm(i32_ts1, i32_ts2);
  msce32_m(i32_out, i32_buffer, 4 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans, i32_buffer, 16, " MSSUB.MM  INT32  M1");
  // uint64
  msettype(E64, M1, BA);
  msettilemi(5);
  msettileni(2);
  const int64_t i64_src1[] = {-706083740229815738,  8502283602274212955,
                              491745841298458911,   -3483888607691623665,
                              -5257443695606704241, 3691797916410272767,
                              6118682195703635554,  -3133320122886122898,
                              -6188835949894860711, -3051636837024143195};
  const int64_t i64_src2[] = {-4360637825208793627, 8185173484280883173,
                              403075368356167463,   -2019966780657783755,
                              -4029413947266419828, -773145703119079799,
                              -2129663255878924499, -24395449944655539,
                              -9181339389980401554, 5652969987613491685};
  const int64_t i64_ans[] = {3654554084978977889,  317110117993329782,
                             88670472942291448,    -1463921827033839910,
                             -1228029748340284413, 4464943619529352566,
                             8248345451582560053,  -3108924672941467359,
                             2992503440085540843,  -8704606824637634880};
  mint64m1_t i64_ts1 = mlce64_m1(i64_src1, 2 * sizeof(int64_t));
  mint64m1_t i64_ts2 = mlce64_m1(i64_src2, 2 * sizeof(int64_t));
  mint64m1_t i64_out = mssub_mm(i64_ts1, i64_ts2);
  msce64_m(i64_out, i64_buffer, 2 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans, i64_buffer, 10, " MSSUB.MM  INT64  M1");
  // M2
  // uint8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const int8_t i8_src1_m2[] = {
      -17,  -88, 77,  -105, -128, 36,   -94, -114, 36,  -79,  -16, -106, 101,
      -109, 6,   -37, 69,   -12,  -115, 51,  71,   -77, -128, 90,  -120, -112,
      60,   -4,  63,  -47,  112,  -35,  46,  -24,  104, -104, -46, 85,   66,
      111,  67,  -96, 40,   44,   -66,  15,  -106, -22, 106,  -59, 45,   -108,
      104,  38,  18,  -24,  121,  90,   -18, -37,  -15, 110,  112, -108};
  const int8_t i8_src2_m2[] = {
      68,   -110, 44,  -78,  -30,  117,  56,  -126, 73,  44,   79,  91,  112,
      -42,  -79,  -97, 69,   -124, -104, -99, 23,   23,  -105, 64,  68,  -47,
      83,   -101, 122, -99,  75,   67,   15,  -71,  117, -56,  98,  100, -8,
      -108, 123,  98,  -121, 7,    99,   64,  95,   -17, 48,   -24, -32, 85,
      -41,  50,   -33, 36,   22,   27,   -74, -100, -12, 63,   -49, -115};
  const int8_t i8_ans_m2[] = {
      -85, 22,  33,   -27, -98, -81,  -128, 12,   -37,  -123, -95,  -128, -11,
      -67, 85,  60,   0,   112, -11,  127,  48,   -100, -23,  26,   -128, -65,
      -23, 97,  -59,  52,  37,  -102, 31,   47,   -13,  -48,  -128, -15,  74,
      127, -56, -128, 127, 37,  -128, -49,  -128, -5,   58,   -35,  77,   -128,
      127, -12, 51,   -60, 99,  63,   56,   63,   -3,   47,   127,  7};
  mint8m2_t i8_ts1_m2 = mlce8_m2(i8_src1_m2, 32 * sizeof(int8_t));
  mint8m2_t i8_ts2_m2 = mlce8_m2(i8_src2_m2, 32 * sizeof(int8_t));
  mint8m2_t i8_out_m2 = mssub_mm(i8_ts1_m2, i8_ts2_m2);
  msce8_m(i8_out_m2, i8_buffer, 32 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m2, i8_buffer, 2 * 32, " MSSUB.MM  INT8   M2");
  // uint16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const int16_t i16_src1_m2[] = {
      19981,  4985,  29352,  31740,  -11021, -21269, 31416,  15434,
      18490,  13565, 32450,  -4231,  -16031, -30266, 17221,  -8156,
      -15044, 26642, -28861, 3113,   -18153, 15022,  22166,  19096,
      -6064,  22211, 18828,  -30111, 18874,  3453,   -14687, -27463,
      -13851, 6755,  15570,  20812,  -19457, 2352,   26000,  11777,
      11631,  1378,  -2246,  -7291,  -31701, -22455, 8759,   -3592};
  const int16_t i16_src2_m2[] = {
      12074,  -29812, -26029, -22970, 28327,  -2029,  9694,  16292,
      6805,   19442,  -7924,  -20044, 9595,   32662,  26800, 7550,
      27113,  11829,  19659,  10015,  -23218, 9131,   -2927, 26492,
      7671,   30974,  29592,  -6346,  -25977, -14251, 16480, 10841,
      -23588, -5290,  18669,  12202,  23058,  -19009, 15217, 22066,
      -12931, 8113,   6076,   19157,  -32437, -12586, -2983, -29289};
  const int16_t i16_ans_m2[] = {
      7907,   32767, 32767,  32767,  -32768, -19240, 21722,  -858,
      11685,  -5877, 32767,  15813,  -25626, -32768, -9579,  -15706,
      -32768, 14813, -32768, -6902,  5065,   5891,   25093,  -7396,
      -13735, -8763, -10764, -23765, 32767,  17704,  -31167, -32768,
      9737,   12045, -3099,  8610,   -32768, 21361,  10783,  -10289,
      24562,  -6735, -8322,  -26448, 736,    -9869,  11742,  25697};
  mint16m2_t i16_ts1_m2 = mlce16_m2(i16_src1_m2, 16 * sizeof(int16_t));
  mint16m2_t i16_ts2_m2 = mlce16_m2(i16_src2_m2, 16 * sizeof(int16_t));
  mint16m2_t i16_out_m2 = mssub_mm(i16_ts1_m2, i16_ts2_m2);
  msce16_m(i16_out_m2, i16_buffer, 16 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m2, i16_buffer, 3 * 16, " MSSUB.MM  INT16  M2");
  // uint32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const int32_t i32_src1_m2[] = {
      871553213,   -999626071,  614175811,   1366395053,  1000538196,
      467994669,   -2011393889, -313748321,  -958568930,  1958984358,
      545319930,   1868627945,  1958844040,  -1824204611, -1056674088,
      -1509378750, -1385391157, -1979806144, 613958258,   1698985128,
      1893528590,  360209050,   171902289,   -508605918,  -556940756,
      -1837392048, 744825327,   -545361064,  -2008042174, 2058755592,
      -1252964024, -1040622899};
  const int32_t i32_src2_m2[] = {
      205839906,  111744626,   1011847055, 1588820288, -877543322, -337735345,
      1551251929, 1015784916,  765512490,  1405560632, -500431149, 847879861,
      1353854021, 873852961,   735377626,  -528779363, 196344881,  590217945,
      133693647,  1071569820,  1142731485, 999707705,  712234709,  -405271113,
      -562469006, -1427221089, -541929808, 1363556877, -957066809, 1714872670,
      -266495052, 732034343};
  const int32_t i32_ans_m2[] = {
      665713307,  -1111370697, -397671244,  -222425235,  1878081518,
      805730014,  -2147483648, -1329533237, -1724081420, 553423726,
      1045751079, 1020748084,  604990019,   -2147483648, -1792051714,
      -980599387, -1581736038, -2147483648, 480264611,   627415308,
      750797105,  -639498655,  -540332420,  -103334805,  5528250,
      -410170959, 1286755135,  -1908917941, -1050975365, 343882922,
      -986468972, -1772657242};
  mint32m2_t i32_ts1_m2 = mlce32_m2(i32_src1_m2, 8 * sizeof(int32_t));
  mint32m2_t i32_ts2_m2 = mlce32_m2(i32_src2_m2, 8 * sizeof(int32_t));
  mint32m2_t i32_out_m2 = mssub_mm(i32_ts1_m2, i32_ts2_m2);
  msce32_m(i32_out_m2, i32_buffer, 8 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m2, i32_buffer, 4 * 8, " MSSUB.MM  INT32  M2");
  // uint64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const int64_t i64_src1_m2[] = {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
                                 -2, -2, -2, -2, -2, -2, -2, -2, -2, -2};
  const int64_t i64_src2_m2[] = {
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, 9223372036854775807,  9223372036854775807,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807,  9223372036854775807};
  const int64_t i64_ans_m2[] = {
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808};
  mint64m2_t i64_ts1_m2 = mlce64_m2(i64_src1_m2, 4 * sizeof(int64_t));
  mint64m2_t i64_ts2_m2 = mlce64_m2(i64_src2_m2, 4 * sizeof(int64_t));
  mint64m2_t i64_out_m2 = mssub_mm(i64_ts1_m2, i64_ts2_m2);
  msce64_m(i64_out_m2, i64_buffer, 4 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m2, i64_buffer, 5 * 4, " MSSUB.MM  INT64  M2");
  // M4
  // uint8
  msettype(E8, M4, BA);
  msettilemi(2);
  msettileni(33);
  const int8_t i8_src1_m4[] = {
      20, 5,   -1,   6,   59,   -77,  -102, -6,   19,  -63,  -57,
      38, -86, -107, 0,   -85,  50,   108,  29,   100, -108, -101,
      71, 76,  2,    -24, -46,  0,    122,  -124, -1,  -29,  -92,
      79, 101, 85,   54,  -83,  -83,  4,    70,   119, -123, 10,
      -7, 115, -50,  -94, -59,  -52,  -121, -71,  -49, 25,   92,
      19, -78, 62,   -54, -126, -113, -60,  -97,  16,  13,   35};
  const int8_t i8_src2_m4[] = {
      7,    102,  -104, -16,  64,  75,  21,   35,   71,   64,   -44,
      -73,  -14,  25,   9,    -77, -56, 35,   -6,   17,   12,   97,
      -10,  -15,  -6,   49,   48,  -20, 14,   -79,  -95,  115,  34,
      -91,  47,   100,  33,   -83, 16,  11,   -125, -123, -1,   -22,
      -100, -10,  7,    -112, -30, 34,  61,   -14,  -119, 49,   82,
      -101, -121, -17,  86,   105, -42, -100, 64,   -27,  -110, 89};
  const int8_t i8_ans_m4[] = {
      13,  -97, 103,  22,   -5,   -128, -123, -41,  -52, -127, -13,
      111, -72, -128, -9,   -8,   106,  73,   35,   83,  -120, -128,
      81,  91,  8,    -73,  -94,  20,   108,  -45,  94,  -128, -126,
      127, 54,  -15,  21,   0,    -99,  -7,   127,  127, -122, 32,
      93,  125, -57,  18,   -29,  -86,  -128, -57,  70,  -24,  10,
      120, 43,  79,   -128, -128, -71,  40,   -128, 43,  123,  -54};
  mint8m4_t i8_ts1_m4 = mlce8_m4(i8_src1_m4, 33 * sizeof(int8_t));
  mint8m4_t i8_ts2_m4 = mlce8_m4(i8_src2_m4, 33 * sizeof(int8_t));
  mint8m4_t i8_out_m4 = mssub_mm(i8_ts1_m4, i8_ts2_m4);
  msce8_m(i8_out_m4, i8_buffer, 33 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m4, i8_buffer, 2 * 33, " MSSUB.MM  INT8   M4");
  // uint16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(17);
  const int16_t i16_src1_m4[] = {
      9288,   9920,  29686,  24862,  21677,  15296,  -13942, 30898,  15891,
      12011,  24957, 26299,  -3546,  -17229, -17412, 29129,  -2339,  -5307,
      -19099, 6054,  14151,  10145,  27579,  27242,  18150,  -23153, -23604,
      -27869, 5299,  16078,  18706,  30207,  9166,   -7026,  6544,   19676,
      -4162,  7868,  -26196, 12504,  15326,  -18906, -11229, 27640,  -15945,
      -11770, 32503, -8988,  -20203, 525,    -22176};
  const int16_t i16_src2_m4[] = {
      -15310, 10852, 14339,  -31160, 17501,  -9811,  7906,   20831,  -6077,
      3448,   22637, 16447,  -21128, -9918,  27939,  -28775, -30893, 15533,
      21528,  20967, -247,   -6858,  4148,   -24418, -12250, -1071,  -5018,
      6797,   -6953, 14890,  -3880,  -29592, -23145, -5424,  -2646,  -14616,
      -12733, 25437, 28515,  -22070, -31642, 18740,  13203,  14870,  20894,
      -24595, 32096, -23531, -24044, -14442, 3648};
  const int16_t i16_ans_m4[] = {
      24598,  -932,   15347,  32767, 4176,  25107,  -21848, 10067,  21968,
      8563,   2320,   9852,   17582, -7311, -32768, 32767,  28554,  -20840,
      -32768, -14913, 14398,  17003, 23431, 32767,  30400,  -22082, -18586,
      -32768, 12252,  1188,   22586, 32767, 32311,  -1602,  9190,   32767,
      8571,   -17569, -32768, 32767, 32767, -32768, -24432, 12770,  -32768,
      12825,  407,    14543,  3841,  14967, -25824};
  mint16m4_t i16_ts1_m4 = mlce16_m4(i16_src1_m4, 17 * sizeof(int16_t));
  mint16m4_t i16_ts2_m4 = mlce16_m4(i16_src2_m4, 17 * sizeof(int16_t));
  mint16m4_t i16_out_m4 = mssub_mm(i16_ts1_m4, i16_ts2_m4);
  msce16_m(i16_out_m4, i16_buffer, 17 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m4, i16_buffer, 3 * 17, " MSSUB.MM  INT16  M4");
  // uint32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(9);
  const int32_t i32_src1_m4[] = {
      1819658611,  1327924297,  -1511998575, -505865529,  -149228118,
      -1513372778, -1764030515, 922943871,   -235971498,  1825332480,
      205365468,   -1511174437, -1824815633, -1428102257, 301981148,
      -2037367822, -516013604,  832620356,   -278940042,  -1913522892,
      678668302,   49624800,    771000398,   938731712,   -919122788,
      2115034787,  -789868443,  -369646552,  -387539272,  1910520171,
      831071713,   -1698837138, 426048956,   133839772,   753438571,
      -257576175};
  const int32_t i32_src2_m4[] = {
      -1069636519, 413349129,   -1945620651, -1125354041, 1808626353,
      1216683940,  1950931748,  844163236,   -463040060,  -2058956341,
      236445290,   -2019618603, -1841540989, 111446394,   822529403,
      1960164584,  -623621561,  -1014555731, 577049250,   -495848591,
      -1864057377, 1314832985,  1362066153,  1289414139,  1353236208,
      1964083177,  -1636743179, -1355739689, 1138698753,  -1314845542,
      -47814949,   -1356799317, 81675075,    -588236211,  -1861069929,
      14695551};
  const int32_t i32_ans_m4[] = {
      2147483647,  914575168,   433622076,  619488512,   -1957854471,
      -2147483648, -2147483648, 78780635,   227068562,   2147483647,
      -31079822,   508444166,   16725356,   -1539548651, -520548255,
      -2147483648, 107607957,   1847176087, -855989292,  -1417674301,
      2147483647,  -1265208185, -591065755, -350682427,  -2147483648,
      150951610,   846874736,   986093137,  -1526238025, 2147483647,
      878886662,   -342037821,  344373881,  722075983,   2147483647,
      -272271726};
  mint32m4_t i32_ts1_m4 = mlce32_m4(i32_src1_m4, 9 * sizeof(int32_t));
  mint32m4_t i32_ts2_m4 = mlce32_m4(i32_src2_m4, 9 * sizeof(int32_t));
  mint32m4_t i32_out_m4 = mssub_mm(i32_ts1_m4, i32_ts2_m4);
  msce32_m(i32_out_m4, i32_buffer, 9 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m4, i32_buffer, 4 * 9, " MSSUB.MM  INT32  M4");
  // uint64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(5);
  const int64_t i64_src1_m4[] = {0,  0,  0,  0,  0,  0,  0,  0,  0,
                                 0,  -2, -2, -2, -2, -2, -2, -2, -2,
                                 -2, -2, -2, -2, -2, -2, -2};
  const int64_t i64_src2_m4[] = {
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, 9223372036854775807,  9223372036854775807,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807};
  const int64_t i64_ans_m4[] = {
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807,  9223372036854775807,  9223372036854775807,
      9223372036854775807,  -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808};
  mint64m4_t i64_ts1_m4 = mlce64_m4(i64_src1_m4, 5 * sizeof(int64_t));
  mint64m4_t i64_ts2_m4 = mlce64_m4(i64_src2_m4, 5 * sizeof(int64_t));
  mint64m4_t i64_out_m4 = mssub_mm(i64_ts1_m4, i64_ts2_m4);
  msce64_m(i64_out_m4, i64_buffer, 5 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m4, i64_buffer, 5 * 5, " MSSUB.MM  INT64  M4");
}

static void test_mfwsub_mm() {
  // M1
  // fp16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(4);
  const fp16_t fp16_src1[] = {-9.55, -5.746, 4.492, 4.406, -9.31, -3.94,
                              7.09,  7.707,  4.055, 6.664, 9.055, 0.9033};
  const fp16_t fp16_src2[] = {1.43,  -7.75, 6.55,  -8.445, 6.016, -4.35,
                              -9.52, -5.28, -4.04, -6.21,  5.13,  8.734};
  const fp32_t fp32_ans[] = {-10.9765625, 2.0039062,  -2.0585938, 12.8515625,
                             -15.328125,  0.41210938, 16.609375,  12.984375,
                             8.09375,     12.875,     3.9257812,  -7.8320312};
  mfloat16m1_t fp16_ts1 = mlce16_m1(fp16_src1, 4 * sizeof(fp16_t));
  mfloat16m1_t fp16_ts2 = mlce16_m1(fp16_src2, 4 * sizeof(fp16_t));
  mfloat32m2_t fp32_out = mfwsub_mm(fp16_ts1, fp16_ts2);
  msettype(E32, M1, BA);
  msce32_m(fp32_out, fp32_buffer, 4 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_LAX_EQ(fp32_ans, fp32_buffer, 12, " MFWSUB.MM FP16   M1");
  // fp32
  msettype(E32, M1, BA);
  msettilemi(5);
  msettileni(2);
  const fp32_t fp32_src1[] = {-74.81323,  -26.29671,  -72.971504, -19.446907,
                              86.11817,   -14.466996, 93.38461,   39.096222,
                              -63.470207, -78.84037};
  const fp32_t fp32_src2[] = {52.888763,  -60.33338, 1.8139845,  44.0916,
                              65.582886,  61.082886, -42.194046, 54.410526,
                              -6.2041397, 13.50248};
  const fp64_t fp64_ans[] = {
      -127.70199585, 34.0366745,   -74.78549194, -63.53850555, 20.53528595,
      -75.54988098,  135.57865906, -15.31430435, -57.2660675,  -92.34284973};
  mfloat32m1_t fp32_ts1 = mlce32_m1(fp32_src1, 2 * sizeof(fp32_t));
  mfloat32m1_t fp32_ts2 = mlce32_m1(fp32_src2, 2 * sizeof(fp32_t));
  mfloat64m2_t fp64_out = mfwsub_mm(fp32_ts1, fp32_ts2);
  msettype(E64, M1, BA);
  msce64_m(fp64_out, fp64_buffer, 2 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_LAX_EQ(fp64_ans, fp64_buffer, 10, " MFWSUB.MM FP32   M1");
  // M2
  // fp16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const fp16_t fp16_src1_m2[] = {
      -6.36,   1.849,  3.457,   4.99,   -4.406, -1.53,   0.1294, 1.164,
      -2.027,  7.43,   -0.5557, -1.018, -7.957, -0.3613, 4.758,  -2.758,
      3.297,   -3.496, -5.324,  -1.058, -8.21,  -1.722,  -9.5,   -3.11,
      1.726,   0.4915, 1.529,   5.938,  -6.45,  -4.97,   -1.669, 9.01,
      0.10504, -3.074, -1.378,  3.115,  -5.836, -3.44,   4.938,  5.504,
      7.305,   5.57,   -3.059,  0.3186, 8.984,  -6.87,   9.84,   6.402};
  const fp16_t fp16_src2_m2[] = {
      7.754,   -3.969, -8.65,   -2.31,  -8.46,  5.082,  1.72,   9.81,
      5.688,   -1.301, -0.59,   -6.254, -9.38,  -2.62,  6.293,  -9.305,
      -0.8022, 9.5,    -5.387,  1.844,  3.455,  -7.652, 5.484,  8.34,
      0.337,   1.214,  2.643,   -4.094, 3.25,   5.64,   6.35,   9.51,
      -1.073,  -4.2,   -0.8276, -2.793, -2.719, -1.144, -9.164, 2.799,
      3.182,   3.852,  9.01,    -3.814, 4.293,  -0.763, -1.095, 2.469};
  const fp32_t fp32_ans_m4[] = {
      -14.11, 5.816,   12.11,   7.297,  4.055,   -6.613, -1.59,   -8.65,
      -7.715, 8.734,   0.03418, 5.234,  1.426,   2.258,  -1.535,  6.547,
      4.098,  -13.,    0.0625,  -2.902, -11.664, 5.93,   -14.984, -11.45,
      1.389,  -0.7227, -1.113,  10.03,  -9.7,    -10.61, -8.02,   -0.5,
      1.179,  1.125,   -0.5503, 5.906,  -3.117,  -2.297, 14.1,    2.705,
      4.125,  1.719,   -12.06,  4.133,  4.69,    -6.11,  10.94,   3.934};
  mfloat16m2_t fp16_ts1_m2 = mlce16_m2(fp16_src1_m2, 16 * sizeof(fp16_t));
  mfloat16m2_t fp16_ts2_m2 = mlce16_m2(fp16_src2_m2, 16 * sizeof(fp16_t));
  mfloat32m4_t fp32_out_m4 = mfwsub_mm(fp16_ts1_m2, fp16_ts2_m2);
  msettype(E32, M4, BA);
  msettileni(16);
  msce32_m(fp32_out_m4, fp32_buffer, 16 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_LAX_EQ(fp32_ans_m4, fp32_buffer, 3 * 16,
                           " MFWSUB.MM FP16   M2");
  // fp32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const fp32_t fp32_src1_m2[] = {
      -8.15143,   -9.359703, 6.174424,  -0.3891856, 7.734597,  7.2407227,
      0.6072447,  7.514941,  -5.460416, 6.0570536,  4.060991,  2.917139,
      -1.6407692, 7.533192,  2.849721,  4.4944277,  -4.397521, 6.1765537,
      -7.504078,  3.6737754, -4.15626,  -3.4272678, 1.8596725, 1.3176873,
      0.79114586, 1.6277326, 1.529277,  6.5520654,  -6.763323, 6.3624654,
      4.41683,    6.4471087};
  const fp32_t fp32_src2_m2[] = {
      -7.8451834, 5.0297694, -7.8362026, -1.1366735, -3.9939759, 0.8323896,
      9.394729,   8.439808,  2.8822339,  6.7658153,  -9.310023,  9.984063,
      5.8918295,  8.572771,  -4.502866,  -7.9746118, 1.4314723,  4.942976,
      3.883298,   4.25143,   3.2481148,  4.587196,   6.9400954,  0.7543507,
      5.134047,   -4.671417, 1.6734867,  6.0319123,  -7.18396,   -6.4280376,
      -3.1873689, 5.3294487};
  const fp64_t fp64_ans_m4[] = {
      -0.30624676, -14.389473, 14.010627,   0.74748784, 11.728573,  6.408333,
      -8.787484,   -0.9248667, -8.342649,   -0.7087617, 13.371014,  -7.066924,
      -7.5325985,  -1.0395789, 7.3525867,   12.46904,   -5.8289933, 1.2335777,
      -11.387376,  -0.5776546, -7.404375,   -8.014463,  -5.080423,  0.56333655,
      -4.342901,   6.29915,    -0.14420974, 0.52015305, 0.42063713, 12.790503,
      7.604199,    1.11766};
  mfloat32m2_t fp32_ts1_m2 = mlce32_m2(fp32_src1_m2, 8 * sizeof(fp32_t));
  mfloat32m2_t fp32_ts2_m2 = mlce32_m2(fp32_src2_m2, 8 * sizeof(fp32_t));
  mfloat64m4_t fp64_out_m4 = mfwsub_mm(fp32_ts1_m2, fp32_ts2_m2);
  msettype(E64, M4, BA);
  msettileni(8);
  msce64_m(fp64_out_m4, fp64_buffer, 8 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_LAX_EQ(fp64_ans_m4, fp64_buffer, 4 * 8,
                           " MFWSUB.MM FP32   M2");
}

static void test_mssubu_mm() {
  // M1
  // uint8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(8);
  const uint8_t u8_src1[] = {25,  56,  162, 221, 218, 196, 78, 113,
                             177, 113, 96,  72,  233, 2,   66, 37};
  const uint8_t u8_src2[] = {163, 218, 213, 140, 80,  121, 216, 254,
                             165, 112, 215, 33,  152, 39,  201, 133};
  const int8_t i8_ans[] = {-128, -128, -51,  81, 127, 75,  -128, -128,
                           12,   1,    -119, 39, 81,  -37, -128, -96};
  muint8m1_t u8_ts1 = mlce8_m1(u8_src1, 8 * sizeof(uint8_t));
  muint8m1_t u8_ts2 = mlce8_m1(u8_src2, 8 * sizeof(uint8_t));
  mint8m1_t i8_out = mssubu_mm(u8_ts1, u8_ts2);
  msce8_m(i8_out, i8_buffer, 8 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans, i8_buffer, 16, "MSSUBU.MM UINT8  M1");
  // uint16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(5);
  const uint16_t u16_src1[] = {47651, 10637, 26707, 39848, 33558,
                               63981, 49691, 7887,  17094, 41778,
                               47046, 10059, 18268, 17907, 50139};
  const uint16_t u16_src2[] = {11713, 13946, 43825, 30664, 64880,
                               62493, 31048, 8893,  51945, 51827,
                               51070, 28869, 50763, 32474, 23375};
  const int16_t i16_ans[] = {32767, -3309,  -17118, 9184,   -31322,
                             1488,  18643,  -1006,  -32768, -10049,
                             -4024, -18810, -32495, -14567, 26764};
  muint16m1_t u16_ts1 = mlce16_m1(u16_src1, 5 * sizeof(uint16_t));
  muint16m1_t u16_ts2 = mlce16_m1(u16_src2, 5 * sizeof(uint16_t));
  mint16m1_t i16_out = mssubu_mm(u16_ts1, u16_ts2);
  msce16_m(i16_out, i16_buffer, 5 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans, i16_buffer, 15, "MSSUBU.MM UINT16 M1");
  // uint32
  msettype(E32, M1, BA);
  msettilemi(2);
  msettileni(4);
  const uint32_t u32_src1[] = {165737310,  2600924114, 3343323597, 2298135540,
                               3525887907, 3028527640, 334920578,  165341765};
  const uint32_t u32_src2[] = {608078153,  2118376334, 2100866028, 1909719758,
                               2189631781, 1687612311, 3697076597, 791210084};
  const int32_t i32_ans[] = {-442340843, 482547780,  1242457569,  388415782,
                             1336256126, 1340915329, -2147483648, -625868319};
  muint32m1_t u32_ts1 = mlce32_m1(u32_src1, 4 * sizeof(uint32_t));
  muint32m1_t u32_ts2 = mlce32_m1(u32_src2, 4 * sizeof(uint32_t));
  mint32m1_t i32_out = mssubu_mm(u32_ts1, u32_ts2);
  msce32_m(i32_out, i32_buffer, 4 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans, i32_buffer, 8, "MSSUBU.MM UINT32 M1");
  // uint64
  msettype(E64, M1, BA);
  msettilemi(1);
  msettileni(2);
  const uint64_t u64_src1[] = {18446744073709551615u, 0u};
  const uint64_t u64_src2[] = {18446744073709551615u, 18446744073709551615u};
  const int64_t i64_ans[] = {0, -9223372036854775808};
  muint64m1_t u64_ts1 = mlce64_m1(u64_src1, 2 * sizeof(uint64_t));
  muint64m1_t u64_ts2 = mlce64_m1(u64_src2, 2 * sizeof(uint64_t));
  mint64m1_t i64_out = mssubu_mm(u64_ts1, u64_ts2);
  msce64_m(i64_out, i64_buffer, 2 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans, i64_buffer, 2, "MSSUBU.MM UINT64 M1");
  // M2
  // uint8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const uint8_t u8_src1_m2[] = {
      194, 89,  27,  64,  196, 191, 212, 130, 103, 3,   226, 247, 30,
      69,  140, 236, 226, 12,  111, 162, 108, 203, 170, 94,  74,  38,
      237, 141, 78,  192, 192, 133, 8,   164, 57,  218, 51,  84,  251,
      239, 156, 232, 222, 5,   237, 225, 113, 177, 191, 183, 7,   73,
      114, 117, 190, 198, 228, 239, 70,  124, 106, 60,  232, 12};
  const uint8_t u8_src2_m2[] = {
      198, 140, 9,   105, 217, 193, 163, 88,  237, 130, 93,  57,  92,
      161, 7,   16,  79,  139, 154, 56,  236, 104, 94,  250, 100, 215,
      240, 74,  72,  149, 87,  173, 45,  211, 174, 69,  242, 12,  159,
      220, 199, 56,  34,  53,  143, 59,  63,  15,  177, 127, 227, 150,
      228, 16,  115, 96,  130, 49,  2,   110, 204, 157, 247, 127};
  const int8_t i8_ans_m2[] = {
      -4,   -51, 18,  -41, -21,  -2,  49,  42,   -128, -127, 127,  127,  -62,
      -92,  127, 127, 127, -127, -43, 106, -128, 99,   76,   -128, -26,  -128,
      -3,   67,  6,   43,  105,  -40, -37, -47,  -117, 127,  -128, 72,   92,
      19,   -43, 127, 127, -48,  94,  127, 50,   127,  14,   56,   -128, -77,
      -114, 101, 75,  102, 98,   127, 68,  14,   -98,  -97,  -15,  -115};
  muint8m2_t u8_ts1_m2 = mlce8_m2(u8_src1_m2, 32 * sizeof(uint8_t));
  muint8m2_t u8_ts2_m2 = mlce8_m2(u8_src2_m2, 32 * sizeof(uint8_t));
  mint8m2_t i8_out_m2 = mssubu_mm(u8_ts1_m2, u8_ts2_m2);
  msce8_m(i8_out_m2, i8_buffer, 32 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m2, i8_buffer, 2 * 32, "MSSUBU.MM UINT8  M2");
  // uint16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const uint16_t u16_src1_m2[] = {
      55341, 18294, 53802, 64872, 14583, 23359, 10268, 62896, 53976, 6750,
      36038, 21693, 43824, 57027, 39582, 60226, 46487, 14480, 26273, 59291,
      21384, 48783, 52153, 27024, 37454, 52620, 3344,  50330, 54758, 57508,
      56952, 58920, 29463, 10108, 27050, 57481, 56749, 3527,  21386, 16253,
      39947, 37982, 6540,  17027, 2845,  63820, 58050, 51966};
  const uint16_t u16_src2_m2[] = {
      6964,  16186, 8038,  12123, 56667, 10897, 58773, 1394,  7095,  40752,
      19067, 6047,  28338, 59152, 65150, 13017, 30834, 5253,  29811, 707,
      41493, 26374, 1350,  63321, 38369, 51259, 52603, 47448, 33094, 13020,
      19086, 5551,  27688, 1303,  45580, 21830, 12168, 13956, 10044, 18822,
      9122,  41439, 16904, 34588, 29361, 56710, 9483,  39559};
  const int16_t i16_ans_m2[] = {
      32767, 2108,   32767,  32767,  -32768, 12462,  -32768, 32767,
      32767, -32768, 16971,  15646,  15486,  -2125,  -25568, 32767,
      15653, 9227,   -3538,  32767,  -20109, 22409,  32767,  -32768,
      -915,  1361,   -32768, 2882,   21664,  32767,  32767,  32767,
      1775,  8805,   -18530, 32767,  32767,  -10429, 11342,  -2569,
      30825, -3457,  -10364, -17561, -26516, 7110,   32767,  12407};
  muint16m2_t u16_ts1_m2 = mlce16_m2(u16_src1_m2, 16 * sizeof(uint16_t));
  muint16m2_t u16_ts2_m2 = mlce16_m2(u16_src2_m2, 16 * sizeof(uint16_t));
  mint16m2_t i16_out_m2 = mssubu_mm(u16_ts1_m2, u16_ts2_m2);
  msce16_m(i16_out_m2, i16_buffer, 16 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m2, i16_buffer, 3 * 16, "MSSUBU.MM UINT16 M2");
  // uint32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const uint32_t u32_src1_m2[] = {
      2515645599, 3784146151, 2601934442, 1725274080, 1931876092, 1233801843,
      3547870896, 3888060664, 142813201,  634688575,  420956567,  498466689,
      4029728963, 576566791,  1305150935, 2944553973, 873817192,  1459877185,
      3460026503, 3487675413, 2629304827, 3902829481, 829190500,  3442861762,
      2974850070, 2110938126, 2988400567, 667535507,  3493626523, 1644514533,
      1620969327, 1879025902};
  const uint32_t u32_src2_m2[] = {
      2058266371, 808946672,  1695093026, 1363224777, 3461788161, 2420415405,
      3848352642, 2613501274, 3317359316, 3275119339, 2610375114, 4212069896,
      2883969492, 3290353226, 3580869850, 3297150457, 3078316864, 2127182300,
      943698360,  2014716003, 2650953370, 427519789,  4120141393, 1507281276,
      1764870361, 2130307621, 2408224933, 3752264328, 2006242077, 2555715436,
      261036824,  1827865950};
  const int32_t i32_ans_m2[] = {
      457379228,   2147483647,  906841416,   362049303,   -1529912069,
      -1186613562, -300481746,  1274559390,  -2147483648, -2147483648,
      -2147483648, -2147483648, 1145759471,  -2147483648, -2147483648,
      -352596484,  -2147483648, -667305115,  2147483647,  1472959410,
      -21648543,   2147483647,  -2147483648, 1935580486,  1209979709,
      -19369495,   580175634,   -2147483648, 1487384446,  -911200903,
      1359932503,  51159952};
  muint32m2_t u32_ts1_m2 = mlce32_m2(u32_src1_m2, 8 * sizeof(uint32_t));
  muint32m2_t u32_ts2_m2 = mlce32_m2(u32_src2_m2, 8 * sizeof(uint32_t));
  mint32m2_t i32_out_m2 = mssubu_mm(u32_ts1_m2, u32_ts2_m2);
  msce32_m(i32_out_m2, i32_buffer, 8 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m2, i32_buffer, 4 * 8, "MSSUBU.MM UINT32 M2");
  // uint64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const uint64_t u64_src1_m2[] = {
      18446744073709551615u, 0u, 18446744073709551615u, 0u,
      18446744073709551615u, 0u, 18446744073709551615u, 0u,
      18446744073709551615u, 0u, 18446744073709551615u, 0u,
      18446744073709551615u, 0u, 18446744073709551615u, 0u,
      18446744073709551615u, 0u, 18446744073709551615u, 0u};
  const uint64_t u64_src2_m2[] = {
      18446744073709551615u, 18446744073709551615u, 18446744073709551615u,
      18446744073709551615u, 18446744073709551615u, 18446744073709551615u,
      18446744073709551615u, 18446744073709551615u, 18446744073709551615u,
      18446744073709551615u, 18446744073709551615u, 18446744073709551615u,
      18446744073709551615u, 18446744073709551615u, 18446744073709551615u,
      18446744073709551615u, 18446744073709551615u, 18446744073709551615u,
      18446744073709551615u, 18446744073709551615u};
  const int64_t i64_ans_m2[] = {
      0, -9223372036854775808, 0, -9223372036854775808, 0, -9223372036854775808,
      0, -9223372036854775808, 0, -9223372036854775808, 0, -9223372036854775808,
      0, -9223372036854775808, 0, -9223372036854775808, 0, -9223372036854775808,
      0, -9223372036854775808};
  muint64m2_t u64_ts1_m2 = mlce64_m2(u64_src1_m2, 4 * sizeof(uint64_t));
  muint64m2_t u64_ts2_m2 = mlce64_m2(u64_src2_m2, 4 * sizeof(uint64_t));
  mint64m2_t i64_out_m2 = mssubu_mm(u64_ts1_m2, u64_ts2_m2);
  msce64_m(i64_out_m2, i64_buffer, 4 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m2, i64_buffer, 5 * 4, "MSSUBU.MM UINT64 M2");
  // M4
  // uint8
  msettype(E8, M4, BA);
  msettilemi(2);
  msettileni(33);
  const uint8_t u8_src1_m4[] = {
      154, 124, 122, 22,  89,  9,   181, 235, 34,  40,  145, 68,  35,  30,
      173, 107, 78,  118, 166, 51,  154, 253, 57,  41,  133, 167, 90,  129,
      43,  167, 188, 60,  225, 59,  162, 198, 24,  251, 226, 189, 236, 183,
      3,   120, 137, 158, 46,  204, 143, 92,  130, 91,  230, 132, 48,  102,
      196, 46,  94,  93,  138, 216, 151, 172, 183, 84};
  const uint8_t u8_src2_m4[] = {
      112, 68,  133, 73,  157, 226, 180, 111, 96,  47,  163, 112, 232, 199,
      12,  183, 150, 50,  182, 235, 146, 126, 230, 31,  32,  222, 241, 197,
      24,  67,  76,  135, 233, 163, 198, 46,  126, 186, 141, 216, 42,  11,
      99,  25,  205, 159, 140, 57,  105, 192, 120, 37,  45,  58,  36,  196,
      193, 36,  234, 61,  28,  6,   66,  94,  78,  92};
  const int8_t i8_ans_m4[] = {
      42,  56,  -11,  -51, -68, -128, 1,   124,  -62,  -7, -18, -44, -128, -128,
      127, -76, -72,  68,  -16, -128, 8,   127,  -128, 10, 101, -55, -128, -68,
      19,  100, 112,  -75, -8,  -104, -36, 127,  -102, 65, 85,  -27, 127,  127,
      -96, 95,  -68,  -1,  -94, 127,  38,  -100, 10,   54, 127, 74,  12,   -94,
      3,   10,  -128, 32,  110, 127,  85,  78,   105,  -8};
  muint8m4_t u8_ts1_m4 = mlce8_m4(u8_src1_m4, 33 * sizeof(uint8_t));
  muint8m4_t u8_ts2_m4 = mlce8_m4(u8_src2_m4, 33 * sizeof(uint8_t));
  mint8m4_t i8_out_m4 = mssubu_mm(u8_ts1_m4, u8_ts2_m4);
  msce8_m(i8_out_m4, i8_buffer, 33 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m4, i8_buffer, 2 * 33, "MSSUBU.MM UINT8  M4");
  // uint16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(17);
  const uint16_t u16_src1_m4[] = {
      52906, 38060, 11466, 39925, 56685, 45890, 1910,  35428, 4815,
      60799, 30457, 44326, 39572, 4142,  14869, 15279, 63657, 24578,
      51796, 54570, 18161, 50495, 43430, 178,   13249, 3813,  29488,
      58660, 5559,  41527, 12118, 38268, 4070,  52959, 34507, 40937,
      56427, 2637,  30169, 39115, 22098, 49321, 51454, 8739,  59238,
      12938, 18799, 12450, 27469, 10265, 48480};
  const uint16_t u16_src2_m4[] = {
      4926,  7620,  1159,  40110, 7665,  57657, 6385,  53936, 16384,
      34036, 55403, 15881, 34069, 54577, 46986, 16796, 25058, 64520,
      7837,  2862,  32565, 49149, 15124, 57160, 55882, 62776, 52001,
      44678, 9029,  59004, 43441, 53432, 34285, 42397, 11208, 20651,
      9052,  19044, 43175, 52283, 52119, 44868, 18447, 2470,  8851,
      24402, 16928, 6926,  25949, 17967, 4097};
  const int16_t i16_ans_m4[] = {
      32767,  30440,  10307,  -185,   32767,  -11767, -4475,  -18508, -11569,
      26763,  -24946, 28445,  5503,   -32768, -32117, -1517,  32767,  -32768,
      32767,  32767,  -14404, 1346,   28306,  -32768, -32768, -32768, -22513,
      13982,  -3470,  -17477, -31323, -15164, -30215, 10562,  23299,  20286,
      32767,  -16407, -13006, -13168, -30021, 4453,   32767,  6269,   32767,
      -11464, 1871,   5524,   1520,   -7702,  32767};
  muint16m4_t u16_ts1_m4 = mlce16_m4(u16_src1_m4, 17 * sizeof(uint16_t));
  muint16m4_t u16_ts2_m4 = mlce16_m4(u16_src2_m4, 17 * sizeof(uint16_t));
  mint16m4_t i16_out_m4 = mssubu_mm(u16_ts1_m4, u16_ts2_m4);
  msce16_m(i16_out_m4, i16_buffer, 17 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m4, i16_buffer, 3 * 17, "MSSUBU.MM UINT16 M4");
  // uint32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(9);
  const uint32_t u32_src1_m4[] = {
      513683174,  1537124268, 2748700238, 3050742392, 3902444389, 1460339244,
      2348803015, 938450940,  3445693860, 1426991416, 781709801,  2220443988,
      2862679326, 22868381,   1992969430, 4156844103, 3977023897, 1698684449,
      2474082436, 1862517607, 3268476639, 1226986031, 4138231474, 3380454065,
      4025323679, 3694382695, 4134513782, 4131085917, 4121203514, 3389839537,
      2349621427, 2200440172, 59328452,   1253622382, 1432406939, 19606387};
  const uint32_t u32_src2_m4[] = {
      525260216,  2960610203, 807277071,  825117921,  2074174865, 3492586957,
      3611163165, 21858283,   1435519413, 2814990180, 4033532572, 3909308105,
      989625125,  2732713376, 468616875,  3116381219, 1310922232, 1346982088,
      3589881787, 3501324163, 3261653020, 3506086499, 3083354658, 4238739658,
      1024873451, 1136876529, 3445324347, 3690457195, 1405360874, 8451626,
      1126781763, 2012982375, 2681021946, 2215943919, 1724799418, 946766681};
  const int32_t i32_ans_m4[] = {
      -11577042,   -1423485935, 1941423167,  2147483647,  1828269524,
      -2032247713, -1262360150, 916592657,   2010174447,  -1387998764,
      -2147483648, -1688864117, 1873054201,  -2147483648, 1524352555,
      1040462884,  2147483647,  351702361,   -1115799351, -1638806556,
      6823619,     -2147483648, 1054876816,  -858285593,  2147483647,
      2147483647,  689189435,   440628722,   2147483647,  2147483647,
      1222839664,  187457797,   -2147483648, -962321537,  -292392479,
      -927160294};
  muint32m4_t u32_ts1_m4 = mlce32_m4(u32_src1_m4, 9 * sizeof(uint32_t));
  muint32m4_t u32_ts2_m4 = mlce32_m4(u32_src2_m4, 9 * sizeof(uint32_t));
  mint32m4_t i32_out_m4 = mssubu_mm(u32_ts1_m4, u32_ts2_m4);
  msce32_m(i32_out_m4, i32_buffer, 9 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m4, i32_buffer, 4 * 9, "MSSUBU.MM UINT32 M4");
  // uint64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(5);
  const uint64_t u64_src1_m4[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
  const uint64_t u64_src2_m4[] = {
      18446744073709551615, 18446744073709551615, 18446744073709551615,
      18446744073709551615, 18446744073709551615, 18446744073709551615,
      18446744073709551615, 18446744073709551615, 18446744073709551615,
      18446744073709551615, 18446744073709551615, 18446744073709551615,
      18446744073709551615, 18446744073709551615, 18446744073709551615,
      18446744073709551615, 18446744073709551615, 18446744073709551615,
      18446744073709551615, 18446744073709551615, 18446744073709551615,
      18446744073709551615, 18446744073709551615, 18446744073709551615,
      18446744073709551615};
  const int64_t i64_ans_m4[] = {
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808, -9223372036854775808, -9223372036854775808,
      -9223372036854775808};
  muint64m4_t u64_ts1_m4 = mlce64_m4(u64_src1_m4, 5 * sizeof(uint64_t));
  muint64m4_t u64_ts2_m4 = mlce64_m4(u64_src2_m4, 5 * sizeof(uint64_t));
  mint64m4_t i64_out_m4 = mssubu_mm(u64_ts1_m4, u64_ts2_m4);
  msce64_m(i64_out_m4, i64_buffer, 5 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m4, i64_buffer, 5 * 5, "MSSUBU.MM UINT64 M4");
}

static void test_mwsubu_mm() {
  // M1
  // uint8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(8);
  const uint8_t u8_src1[] = {190, 41, 169, 153, 170, 63,  138, 117,
                             197, 55, 119, 169, 81,  213, 231, 232};
  const uint8_t u8_src2[] = {155, 211, 45, 157, 142, 142, 166, 129,
                             38,  122, 96, 254, 160, 244, 225, 2};
  const int16_t i16_ans[] = {35,  -170, 124, -4,  28,  -79, -28, -12,
                             159, -67,  23,  -85, -79, -31, 6,   230};
  muint8m1_t u8_ts1 = mlce8_m1(u8_src1, 8 * sizeof(uint8_t));
  muint8m1_t u8_ts2 = mlce8_m1(u8_src2, 8 * sizeof(uint8_t));
  mint16m2_t i16_out = mwsubu_mm(u8_ts1, u8_ts2);
  msettype(E16, M1, BA);
  msce16_m(i16_out, i16_buffer, 8 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans, i16_buffer, 16, "MWSUBU.MM UINT8  M1");
  // uint16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(4);
  const uint16_t u16_src1[] = {16668, 60957, 51039, 59935, 51421, 14943,
                               22817, 24988, 57360, 45419, 64816, 16557};
  const uint16_t u16_src2[] = {43400, 42598, 48506, 10641, 15300, 19978,
                               26576, 64129, 61318, 24136, 54483, 43181};
  const int32_t i32_ans[] = {-26732, 18359,  2533,  49294, 36121, -5035,
                             -3759,  -39141, -3958, 21283, 10333, -26624};
  muint16m1_t u16_ts1 = mlce16_m1(u16_src1, 4 * sizeof(uint16_t));
  muint16m1_t u16_ts2 = mlce16_m1(u16_src2, 4 * sizeof(uint16_t));
  mint32m2_t i32_out = mwsubu_mm(u16_ts1, u16_ts2);
  msettype(E32, M1, BA);
  msce32_m(i32_out, i32_buffer, 4 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans, i32_buffer, 12, "MWSUBU.MM UINT16 M1");
  // uint32
  msettype(E32, M1, BA);
  msettilemi(2);
  msettileni(2);
  const uint32_t u32_src1[] = {4080608096, 730484938, 3567707411, 3680714114};
  const uint32_t u32_src2[] = {2820807451, 806345998, 1424398476, 574380624};
  const int64_t i64_ans[] = {1259800645, -75861060, 2143308935, 3106333490};
  muint32m1_t u32_ts1 = mlce32_m1(u32_src1, 2 * sizeof(uint32_t));
  muint32m1_t u32_ts2 = mlce32_m1(u32_src2, 2 * sizeof(uint32_t));
  mint64m2_t i64_out = mwsubu_mm(u32_ts1, u32_ts2);
  msettype(E64, M1, BA);
  msce64_m(i64_out, i64_buffer, 2 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans, i64_buffer, 4, "MWSUBU.MM UINT32 M1");
  // M2
  // uint8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const uint8_t u8_src1_m2[] = {
      4,   3,   171, 236, 59, 48,  74,  6,   77,  76,  220, 223, 157,
      237, 5,   64,  219, 55, 229, 175, 175, 170, 233, 199, 110, 254,
      65,  45,  213, 32,  48, 159, 165, 67,  130, 148, 157, 74,  15,
      237, 91,  238, 153, 67, 114, 67,  168, 173, 169, 147, 71,  18,
      241, 170, 24,  53,  0,  63,  147, 52,  15,  15,  152, 161};
  const uint8_t u8_src2_m2[] = {
      197, 228, 129, 237, 159, 94,  143, 11,  231, 0,   23,  78,  149,
      182, 191, 185, 7,   48,  254, 43,  167, 232, 203, 191, 111, 1,
      2,   175, 124, 240, 123, 203, 54,  82,  210, 49,  44,  191, 2,
      44,  7,   84,  239, 186, 223, 60,  213, 194, 215, 242, 28,  129,
      46,  5,   187, 196, 152, 159, 69,  84,  172, 120, 4,   52};
  const int16_t i16_ans_m4[] = {
      -193, -225, 42,   -1,   -100, -46,  -69, -5,  -154, 76,   197, 145,  8,
      55,   -186, -121, 212,  7,    -25,  132, 8,   -62,  30,   8,   -1,   253,
      63,   -130, 89,   -208, -75,  -44,  111, -15, -80,  99,   113, -117, 13,
      193,  84,   154,  -86,  -119, -109, 7,   -45, -21,  -46,  -95, 43,   -111,
      195,  165,  -163, -143, -152, -96,  78,  -32, -157, -105, 148, 109};
  muint8m2_t u8_ts1_m2 = mlce8_m2(u8_src1_m2, 32 * sizeof(uint8_t));
  muint8m2_t u8_ts2_m2 = mlce8_m2(u8_src2_m2, 32 * sizeof(uint8_t));
  mint16m4_t i16_out_m4 = mwsubu_mm(u8_ts1_m2, u8_ts2_m2);
  msettype(E16, M4, BA);
  msettileni(32);
  msce16_m(i16_out_m4, i16_buffer, 32 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m4, i16_buffer, 2 * 32, "MWSUBU.MM UINT8  M2");
  // uint16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const uint16_t u16_src1_m2[] = {
      4736,  42634, 46169, 56523, 57414, 41140, 8113,  441,   34911, 18748,
      42505, 35661, 4690,  12615, 57229, 1678,  3833,  38874, 109,   9044,
      25382, 52074, 29594, 29573, 17506, 35455, 19759, 44697, 59880, 65102,
      38312, 59743, 52263, 14100, 54225, 39649, 58859, 33808, 13671, 55361,
      29673, 25484, 35188, 58630, 47077, 21482, 3871,  29662};
  const uint16_t u16_src2_m2[] = {
      62487, 49252, 40747, 28843, 39107, 35204, 60717, 50780, 45027, 43447,
      15093, 21908, 55882, 56424, 53852, 57646, 41400, 22291, 11501, 62732,
      2520,  62409, 43410, 6965,  47245, 42423, 50755, 50982, 19795, 14615,
      35657, 2619,  41276, 45096, 9069,  61113, 42542, 29272, 30600, 29386,
      1314,  1158,  48844, 1786,  27816, 33881, 51539, 1881};
  const int32_t i32_ans_m4[] = {
      -57751, -6618,  5422,   27680,  18307,  5936,   -52604, -50339,
      -10116, -24699, 27412,  13753,  -51192, -43809, 3377,   -55968,
      -37567, 16583,  -11392, -53688, 22862,  -10335, -13816, 22608,
      -29739, -6968,  -30996, -6285,  40085,  50487,  2655,   57124,
      10987,  -30996, 45156,  -21464, 16317,  4536,   -16929, 25975,
      28359,  24326,  -13656, 56844,  19261,  -12399, -47668, 27781};
  muint16m2_t u16_ts1_m2 = mlce16_m2(u16_src1_m2, 16 * sizeof(uint16_t));
  muint16m2_t u16_ts2_m2 = mlce16_m2(u16_src2_m2, 16 * sizeof(uint16_t));
  mint32m4_t i32_out_m4 = mwsubu_mm(u16_ts1_m2, u16_ts2_m2);
  msettype(E32, M4, BA);
  msettileni(16);
  msce32_m(i32_out_m4, i32_buffer, 16 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m4, i32_buffer, 3 * 16, "MWSUBU.MM UINT16 M2");
  // uint32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const uint32_t u32_src1_m2[] = {
      1594859108, 247376928,  1330626858, 2346514048, 4289452464, 2769094083,
      2316332303, 1398192942, 244076743,  1954859740, 332835921,  2172542501,
      632695500,  934508037,  2342091924, 1773421998, 1212002720, 3106859089,
      1730500645, 4046515432, 1208918006, 1661861720, 2421444102, 2183076937,
      372642643,  11394627,   945250685,  1829589675, 2601409346, 2865344024,
      2038822178, 3302425723};
  const uint32_t u32_src2_m2[] = {
      3564353964, 542320639,  742150371,  3282006874, 3398960633, 4204301285,
      163262668,  134488285,  1497216826, 694744934,  862716101,  1250893802,
      3840369495, 1845931002, 1814498471, 3333226943, 3747528582, 4190758062,
      1625584209, 2111613636, 1179691759, 1397655119, 441368553,  2992731264,
      3283009030, 3154020881, 3721743266, 3817067166, 2001520357, 2783392689,
      2375224029, 2017270491};
  const int64_t i64_ans_m4[] = {
      -1969494856, -294943711,  588476487,   -935492826,  890491831,
      -1435207202, 2153069635,  1263704657,  -1253140083, 1260114806,
      -529880180,  921648699,   -3207673995, -911422965,  527593453,
      -1559804945, -2535525862, -1083898973, 104916436,   1934901796,
      29226247,    264206601,   1980075549,  -809654327,  -2910366387,
      -3142626254, -2776492581, -1987477491, 599888989,   81951335,
      -336401851,  1285155232};
  muint32m2_t u32_ts1_m2 = mlce32_m2(u32_src1_m2, 8 * sizeof(uint32_t));
  muint32m2_t u32_ts2_m2 = mlce32_m2(u32_src2_m2, 8 * sizeof(uint32_t));
  mint64m4_t i64_out_m4 = mwsubu_mm(u32_ts1_m2, u32_ts2_m2);
  msettype(E64, M4, BA);
  msettileni(8);
  msce64_m(i64_out_m4, i64_buffer, 8 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m4, i64_buffer, 4 * 8, "MWSUBU.MM UINT32 M2");
}

static void test_mwsub_mm() {
  // M1
  // int8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(8);
  const int8_t i8_src1[] = {85,   124, -106, 59,   -62, -116, -27, -106,
                            -110, 97,  -62,  -101, 14,  -50,  -13, 43};
  const int8_t i8_src2[] = {-39, -112, -24, -87, -6,  50, 36, 112,
                            50,  54,   -49, 100, 116, 56, 46, 21};
  const int16_t i16_ans[] = {124,  236, -82, 146,  -56,  -166, -63, -218,
                             -160, 43,  -13, -201, -102, -106, -59, 22};
  mint8m1_t i8_ts1 = mlce8_m1(i8_src1, 8 * sizeof(int8_t));
  mint8m1_t i8_ts2 = mlce8_m1(i8_src2, 8 * sizeof(int8_t));
  mint16m2_t i16_out = mwsub_mm(i8_ts1, i8_ts2);
  msettype(E16, M1, BA);
  msce16_m(i16_out, i16_buffer, 8 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans, i16_buffer, 16, "MWSUB.MM  INT8   M1");
  // uint16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(4);
  const int16_t i16_src1[] = {16939,  -12492, -10331, 15801,  -3518, -62,
                              -25683, -14754, -19714, -12872, 9341,  -12756};
  const int16_t i16_src2[] = {-28738, -20066, 1789, 29145, 22831, 5253,
                              9212,   -20600, 2042, -197,  25838, -3697};
  const int32_t i32_ans[] = {45677,  7574, -12120, -13344, -26349, -5315,
                             -34895, 5846, -21756, -12675, -16497, -9059};
  mint16m1_t i16_ts1 = mlce16_m1(i16_src1, 4 * sizeof(int16_t));
  mint16m1_t i16_ts2 = mlce16_m1(i16_src2, 4 * sizeof(int16_t));
  mint32m2_t i32_out = mwsub_mm(i16_ts1, i16_ts2);
  msettype(E32, M1, BA);
  msce32_m(i32_out, i32_buffer, 4 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans, i32_buffer, 12, "MWSUB.MM  INT16  M1");
  // uint32
  msettype(E32, M1, BA);
  msettilemi(2);
  msettileni(2);
  const int32_t i32_src1[] = {84967588, 670332015, -2068826381, 688267869};
  const int32_t i32_src2[] = {-2045015675, -1243382572, 543353639, -852172684};
  const int64_t i64_ans[] = {2129983263, 1913714587, -2612180020, 1540440553};
  mint32m1_t i32_ts1 = mlce32_m1(i32_src1, 2 * sizeof(int32_t));
  mint32m1_t i32_ts2 = mlce32_m1(i32_src2, 2 * sizeof(int32_t));
  mint64m2_t i64_out = mwsub_mm(i32_ts1, i32_ts2);
  msettype(E64, M1, BA);
  msce64_m(i64_out, i64_buffer, 2 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans, i64_buffer, 4, "MWSUB.MM  INT32  M1");
  // M2
  // int8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const int8_t i8_src1_m2[] = {
      -60, 59,  -98, -34,  -83,  120, -113, 9,   -77,  -23,  87,   2,  -80,
      9,   123, 91,  -112, 84,   -33, -23,  10,  -4,   -24,  122,  96, 19,
      0,   -53, -31, 87,   -116, -34, -63,  -1,  56,   -113, -118, 27, 75,
      -21, 59,  13,  -80,  13,   99,  25,   118, -115, -52,  89,   91, -54,
      73,  36,  3,   -38,  -102, -60, 84,   13,  82,   -124, 52,   -85};
  const int8_t i8_src2_m2[] = {
      -22, -78, 57,  16,  -82, 12,  20,  1,   -30, -89,  -110, -22, -14,
      14,  126, 35,  -92, -67, 55,  -4,  5,   85,  44,   -122, 99,  122,
      -66, -70, -5,  90,  -60, 36,  -73, 33,  76,  0,    -20,  -96, -22,
      45,  32,  -85, 117, 63,  -32, -58, 11,  -62, 108,  110,  4,   -61,
      -70, -11, -48, 108, 20,  122, -49, -22, -20, -126, 108,  13};
  const int16_t i16_ans_m4[] = {
      -38, 137, -155, -50,  -1,   108,  -133, 8,   -47, 66,   197, 24,  -66,
      -5,  -3,  56,   -20,  151,  -88,  -19,  5,   -89, -68,  244, -3,  -103,
      66,  17,  -26,  -3,   -56,  -70,  10,   -34, -20, -113, -98, 123, 97,
      -66, 27,  98,   -197, -50,  131,  83,   107, -53, -160, -21, 87,  7,
      143, 47,  51,   -146, -122, -182, 133,  35,  102, 2,    -56, -98};
  mint8m2_t i8_ts1_m2 = mlce8_m2(i8_src1_m2, 32 * sizeof(int8_t));
  mint8m2_t i8_ts2_m2 = mlce8_m2(i8_src2_m2, 32 * sizeof(int8_t));
  mint16m4_t i16_out_m4 = mwsub_mm(i8_ts1_m2, i8_ts2_m2);
  msettype(E16, M4, BA);
  msettileni(32);
  msce16_m(i16_out_m4, i16_buffer, 32 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m4, i16_buffer, 2 * 32, "MWSUB.MM  INT8   M2");
  // uint16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const int16_t i16_src1_m2[] = {
      9908,   -12263, 8107,   -26035, -29000, -22497, 32077,  -10621,
      4271,   23233,  4804,   3383,   -1501,  15541,  27259,  24284,
      -25977, 29438,  -30250, 1224,   -26116, 14990,  -25392, -11036,
      14681,  16506,  20831,  -2152,  12435,  15588,  -24792, 28818,
      -7107,  12965,  -24936, 28279,  13076,  -10162, 12994,  -6831,
      -29193, -7018,  -15982, -22667, -3535,  22487,  -30625, -12636};
  const int16_t i16_src2_m2[] = {
      9420,   9359,   -4881,  -29121, 22729,  22967,  7565,   -29280,
      25538,  15423,  10401,  -21434, -8501,  5053,   -22912, -6383,
      7875,   31776,  -22760, 16804,  9632,   -18762, 23575,  -715,
      -20711, -10689, -15976, -19663, 26314,  12122,  25065,  -25366,
      -10898, -14922, 3389,   29429,  16314,  -25143, 16459,  26885,
      22031,  30483,  -12336, -3678,  -10377, -32265, -11700, 9859};
  const int32_t i32_ans_m4[] = {
      488,    -21622, 12988,  3086,   -51729, -45464, 24512,  18659,
      -21267, 7810,   -5597,  24817,  7000,   10488,  50171,  30667,
      -33852, -2338,  -7490,  -15580, -35748, 33752,  -48967, -10321,
      35392,  27195,  36807,  17511,  -13879, 3466,   -49857, 54184,
      3791,   27887,  -28325, -1150,  -3238,  14981,  -3465,  -33716,
      -51224, -37501, -3646,  -18989, 6842,   54752,  -18925, -22495};
  mint16m2_t i16_ts1_m2 = mlce16_m2(i16_src1_m2, 16 * sizeof(int16_t));
  mint16m2_t i16_ts2_m2 = mlce16_m2(i16_src2_m2, 16 * sizeof(int16_t));
  mint32m4_t i32_out_m4 = mwsub_mm(i16_ts1_m2, i16_ts2_m2);
  msettype(E32, M4, BA);
  msettileni(16);
  msce32_m(i32_out_m4, i32_buffer, 16 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m4, i32_buffer, 3 * 16, "MWSUB.MM  INT16  M2");
  // uint32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const int32_t i32_src1_m2[] = {
      470053104,   -965499670,  1867866927,  -1217145199, 1989891173,
      1569785362,  708716586,   -838109945,  -513224697,  -114474346,
      -829145338,  1092250279,  1417013665,  684143687,   830107730,
      -1099661973, -1567762992, 1808059165,  -1297671276, -40085270,
      1829103078,  -1803151070, -509468734,  473213511,   1528262814,
      266149746,   -2129742338, -1640992119, 945702115,   630000306,
      -1799234950, -1028162085};
  const int32_t i32_src2_m2[] = {
      -2000319217, -606544288,  1324058866,  -2012109201, -1482068056,
      -1483675256, -1456698832, -1861526532, -495137996,  -1318614716,
      412813477,   396494368,   652064767,   -1913814148, -789855360,
      -1666922455, -1198326881, -52009670,   -2009733676, -1445512465,
      679185724,   -623545228,  -297610365,  110223829,   1188026757,
      1604036866,  1909163699,  1696090400,  1471745218,  1446577592,
      -1512339938, -1169847752};
  const int64_t i64_ans_m4[] = {
      2470372321,  -358955382,  543808061,   794964002,  3471959229,
      3053460618,  2165415418,  1023416587,  -18086701,  1204140370,
      -1241958815, 695755911,   764948898,   2597957835, 1619963090,
      567260482,   -369436111,  1860068835,  712062400,  1405427195,
      1149917354,  -1179605842, -211858369,  362989682,  340236057,
      -1337887120, -4038906037, -3337082519, -526043103, -816577286,
      -286895012,  141685667};
  mint32m2_t i32_ts1_m2 = mlce32_m2(i32_src1_m2, 8 * sizeof(int32_t));
  mint32m2_t i32_ts2_m2 = mlce32_m2(i32_src2_m2, 8 * sizeof(int32_t));
  mint64m4_t i64_out_m4 = mwsub_mm(i32_ts1_m2, i32_ts2_m2);
  msettype(E64, M4, BA);
  msettileni(8);
  msce64_m(i64_out_m4, i64_buffer, 8 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m4, i64_buffer, 4 * 8, "MWSUB.MM  INT32  M2");
}

static void test_msubu_mm() {
  // M1
  // uint8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(16);
  const uint8_t u8_src1[] = {239, 177, 88,  60,  149, 60,  199, 245,
                             251, 27,  248, 87,  149, 96,  127, 46,
                             247, 118, 172, 93,  7,   197, 182, 191,
                             100, 241, 250, 231, 46,  115, 23,  73};
  const uint8_t u8_src2[] = {243, 94,  128, 254, 206, 103, 105, 142,
                             123, 44,  224, 70,  144, 70,  2,   73,
                             248, 44,  195, 213, 206, 249, 4,   201,
                             97,  183, 72,  126, 170, 160, 86,  29};
  const int8_t i8_ans[] = {-4,  83,  -40, -194, -57,  -43, 94,  103,
                           128, -17, 24,  17,   5,    26,  125, -27,
                           -1,  74,  -23, -120, -199, -52, 178, -10,
                           3,   58,  178, 105,  -124, -45, -63, 44};
  muint8m1_t u8_ts1 = mlce8_m1(u8_src1, 16 * sizeof(uint8_t));
  muint8m1_t u8_ts2 = mlce8_m1(u8_src2, 16 * sizeof(uint8_t));
  mint8m1_t i8_out = msubu_mm(u8_ts1, u8_ts2);
  msce8_m(i8_out, i8_buffer, 16 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans, i8_buffer, 32, "MSUBU.MM  UINT8  M1");
  // uint16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(8);
  const uint16_t u16_src1[] = {55432, 22341, 18127, 47681, 15877, 35000,
                               53815, 53277, 37412, 25512, 4486,  59642,
                               55099, 59194, 62798, 25573, 14679, 54837,
                               26131, 31957, 41768, 30672, 19176, 4648};
  const uint16_t u16_src2[] = {35013, 27341, 56903, 52104, 22081, 44752,
                               43494, 62707, 34056, 43936, 33396, 5737,
                               23087, 2180,  2949,  47727, 61447, 11146,
                               16857, 61042, 52037, 24875, 498,   7759};
  const int16_t i16_ans[] = {20419, -5000,  -38776, -4423,  -6204,  -9752,
                             10321, -9430,  3356,   -18424, -28910, 53905,
                             32012, 57014,  59849,  -22154, -46768, 43691,
                             9274,  -29085, -10269, 5797,   18678,  -3111};
  muint16m1_t u16_ts1 = mlce16_m1(u16_src1, 8 * sizeof(uint16_t));
  muint16m1_t u16_ts2 = mlce16_m1(u16_src2, 8 * sizeof(uint16_t));
  mint16m1_t i16_out = msubu_mm(u16_ts1, u16_ts2);
  msce16_m(i16_out, i16_buffer, 8 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans, i16_buffer, 24, "MSUBU.MM  UINT16 M1");
  // uint32
  msettype(E32, M1, BA);
  msettilemi(4);
  msettileni(4);
  const uint32_t u32_src1[] = {2120063141, 2649884714, 4288780654, 789376456,
                               1285087721, 3141703645, 3723595324, 3362247062,
                               2602241501, 3563446673, 1567340324, 3064250904,
                               2318173045, 3796616816, 2157048431, 384108899};
  const uint32_t u32_src2[] = {1327941921, 3894232819, 3810972517, 713928835,
                               240751836,  1561011478, 2606772163, 1110275891,
                               299195574,  1315484457, 1219325024, 2889315155,
                               749597476,  2461741229, 3985441444, 3512544723};
  const int32_t i32_ans[] = {792121220,  -1244348105, 477808137,   75447621,
                             1044335885, 1580692167,  1116823161,  2251971171,
                             2303045927, 2247962216,  348015300,   174935749,
                             1568575569, 1334875587,  -1828393013, -3128435824};
  muint32m1_t u32_ts1 = mlce32_m1(u32_src1, 4 * sizeof(uint32_t));
  muint32m1_t u32_ts2 = mlce32_m1(u32_src2, 4 * sizeof(uint32_t));
  mint32m1_t i32_out = msubu_mm(u32_ts1, u32_ts2);
  msce32_m(i32_out, i32_buffer, 4 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans, i32_buffer, 16, "MSUBU.MM  UINT32 M1");
  // uint64
  msettype(E64, M1, BA);
  msettilemi(5);
  msettileni(2);
  const uint64_t u64_src1[] = {2792965568014307809, 1927865061994578335,
                               4145000816336094806, 1857792149437315042,
                               79461356270506320,   4541760714337248619,
                               779565464659664262,  3976542089469652064,
                               2915180281667275196, 2350135038808826770};
  const uint64_t u64_src2[] = {2569118657434012511, 2413978168292448578,
                               1695103358908786247, 3252871103369394597,
                               1003824574903468701, 230630868752949893,
                               3183196435234642894, 203042080495094304,
                               1350774093114420283, 458682242765967759};
  const int64_t i64_ans[] = {223846910580295298,   -486113106297870243,
                             2449897457427308559,  -1395078953932079555,
                             -924363218632962381,  4311129845584298726,
                             -2403630970574978632, 3773500008974557760,
                             1564406188552854913,  1891452796042859011};
  muint64m1_t u64_ts1 = mlce64_m1(u64_src1, 2 * sizeof(uint64_t));
  muint64m1_t u64_ts2 = mlce64_m1(u64_src2, 2 * sizeof(uint64_t));
  mint64m1_t i64_out = msubu_mm(u64_ts1, u64_ts2);
  msce64_m(i64_out, i64_buffer, 2 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans, i64_buffer, 10, "MSUBU.MM  UINT64 M1");
  // M2
  // uint8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const uint8_t u8_src1_m2[] = {
      33,  140, 167, 142, 8,   227, 251, 104, 208, 165, 36,  210, 121,
      226, 110, 197, 218, 87,  91,  169, 221, 138, 11,  200, 143, 73,
      157, 6,   1,   52,  75,  146, 210, 147, 195, 163, 48,  17,  238,
      64,  142, 121, 165, 210, 90,  238, 116, 8,   237, 223, 214, 186,
      169, 230, 110, 134, 239, 129, 126, 2,   242, 143, 143, 40};
  const uint8_t u8_src2_m2[] = {
      12,  169, 188, 193, 106, 108, 72,  145, 225, 170, 42,  157, 74,
      163, 91,  126, 100, 111, 30,  17,  57,  20,  141, 75,  108, 191,
      66,  204, 34,  59,  238, 235, 97,  104, 120, 204, 192, 9,   165,
      201, 97,  86,  144, 186, 87,  178, 99,  10,  110, 209, 0,   158,
      70,  28,  12,  127, 188, 153, 168, 46,  52,  21,  216, 11};
  const int8_t i8_ans_m2[] = {
      21,   -29,  -21, -51, -98,  119, 179, -41, -17, -5,   -6,   53,  47,
      63,   19,   71,  118, -24,  61,  152, 164, 118, -130, 125,  35,  -118,
      91,   -198, -33, -7,  -163, -89, 113, 43,  75,  -41,  -144, 8,   73,
      -137, 45,   35,  21,  24,   3,   60,  17,  -2,  127,  14,   214, 28,
      99,   202,  98,  7,   51,   -24, -42, -44, 190, 122,  -73,  29};
  muint8m2_t u8_ts1_m2 = mlce8_m2(u8_src1_m2, 32 * sizeof(uint8_t));
  muint8m2_t u8_ts2_m2 = mlce8_m2(u8_src2_m2, 32 * sizeof(uint8_t));
  mint8m2_t i8_out_m2 = msubu_mm(u8_ts1_m2, u8_ts2_m2);
  msce8_m(i8_out_m2, i8_buffer, 32 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m2, i8_buffer, 2 * 32, "MSUBU.MM  UINT8  M2");
  // uint16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const uint16_t u16_src1_m2[] = {
      56657, 2015,  63401, 38878, 39669, 43029, 63514, 49173, 61790, 3464,
      50610, 54090, 35090, 21508, 34867, 58539, 37838, 31756, 14159, 57982,
      22072, 12526, 64365, 42583, 61796, 15157, 8953,  37096, 54852, 59255,
      53471, 16072, 46670, 28424, 21681, 23621, 2625,  12657, 44550, 62466,
      34835, 42954, 9895,  17555, 29039, 24604, 55831, 19141};
  const uint16_t u16_src2_m2[] = {
      9697,  15857, 29517, 61038, 62296, 37034, 48948, 61306, 9349,  65074,
      1382,  58095, 58104, 37197, 36013, 27051, 48692, 16753, 21904, 7252,
      60667, 324,   14747, 38597, 18088, 63422, 13997, 41220, 54704, 4594,
      25228, 38341, 45470, 56699, 11596, 64425, 4184,  23462, 15080, 23408,
      5195,  45960, 47666, 23398, 63057, 33242, 1509,  46470};
  const int16_t i16_ans_m2[] = {
      46960,  -13842, 33884,  -22160, -22627, 5995,   14566, -12133,
      52441,  -61610, 49228,  -4005,  -23014, -15689, -1146, 31488,
      -10854, 15003,  -7745,  50730,  -38595, 12202,  49618, 3986,
      43708,  -48265, -5044,  -4124,  148,    54661,  28243, -22269,
      1200,   -28275, 10085,  -40804, -1559,  -10805, 29470, 39058,
      29640,  -3006,  -37771, -5843,  -34018, -8638,  54322, -27329};
  muint16m2_t u16_ts1_m2 = mlce16_m2(u16_src1_m2, 16 * sizeof(uint16_t));
  muint16m2_t u16_ts2_m2 = mlce16_m2(u16_src2_m2, 16 * sizeof(uint16_t));
  mint16m2_t i16_out_m2 = msubu_mm(u16_ts1_m2, u16_ts2_m2);
  msce16_m(i16_out_m2, i16_buffer, 16 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m2, i16_buffer, 3 * 16, "MSUBU.MM  UINT16 M2");
  // uint32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const uint32_t u32_src1_m2[] = {
      2661853844, 2729163246, 2261625133, 4140821428, 3048102029, 2412950573,
      1197446248, 3772708268, 3920695072, 1674670567, 3180760636, 129546312,
      2743447529, 2955378974, 691488479,  646983560,  3723069978, 2407888276,
      2892579248, 322986805,  3189272440, 4000140991, 4126752003, 1051412955,
      4200732922, 3760749067, 2104595363, 3410163839, 2557881615, 1349363151,
      4224207218, 1267036965};
  const uint32_t u32_src2_m2[] = {
      2435735802, 2826965590, 2207431916, 122226563,  696075398,  1295589550,
      4232309452, 3443991304, 227186223,  3148822372, 1393162453, 1610950150,
      1395050541, 3341689677, 3974138259, 2878494198, 3958498912, 1390207121,
      267785031,  1404455570, 1782791973, 1189225437, 2188468490, 1216322117,
      3416832737, 3397268304, 3815264987, 3319708461, 302206335,  734106982,
      2444439813, 1572045854};
  const int32_t i32_ans_m2[] = {
      226118042,   -97802344,   54193217,   4018594865, 2352026631,
      1117361023,  -3034863204, 328716964,  3693508849, -1474151805,
      1787598183,  -1481403838, 1348396988, -386310703, -3282649780,
      -2231510638, -235428934,  1017681155, 2624794217, -1081468765,
      1406480467,  2810915554,  1938283513, -164909162, 783900185,
      363480763,   -1710669624, 90455378,   2255675280, 615256169,
      1779767405,  -305008889};
  muint32m2_t u32_ts1_m2 = mlce32_m2(u32_src1_m2, 8 * sizeof(uint32_t));
  muint32m2_t u32_ts2_m2 = mlce32_m2(u32_src2_m2, 8 * sizeof(uint32_t));
  mint32m2_t i32_out_m2 = msubu_mm(u32_ts1_m2, u32_ts2_m2);
  msce32_m(i32_out_m2, i32_buffer, 8 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m2, i32_buffer, 4 * 8, "MSUBU.MM  UINT32 M2");
  // uint64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const uint64_t u64_src1_m2[] = {
      67701756826164980,  36880733843713941,  37428747991464766,
      70013080184431927,  167582380724406805, 159890662972408017,
      81961110191844196,  47778964325388611,  181828314921478325,
      41848804660112274,  74363142058236955,  103947267694533294,
      78931499591889238,  21335695490268826,  18243100231534094,
      179571359677778701, 123236163494314931, 75910154772964598,
      147702932194229608, 94582909677064767};
  const uint64_t u64_src2_m2[] = {
      84864828056106439,  153700381647973510, 58989147761517867,
      131555141373479602, 111155022575096764, 126395942619624831,
      140000695366760846, 19336999753026997,  129259753298200833,
      69519991328382667,  145278537954276701, 20361601769863020,
      23153350122875189,  59531582289913679,  83670384511594672,
      97735483235434070,  122932187292449124, 25196876457194910,
      86203888293796950,  54391545929944427};
  const int64_t i64_ans_m2[] = {
      -17163071229941459, -116819647804259569, -21560399770053101,
      -61542061189047675, 56427358149310041,   33494720352783186,
      -58039585174916650, 28441964572361614,   52568561623277492,
      -27671186668270393, -70915395896039746,  83585665924670274,
      55778149469014049,  -38195886799644853,  -65427284280060578,
      81835876442344631,  303976201865807,     50713278315769688,
      61499043900432658,  40191363747120340};
  muint64m2_t u64_ts1_m2 = mlce64_m2(u64_src1_m2, 4 * sizeof(uint64_t));
  muint64m2_t u64_ts2_m2 = mlce64_m2(u64_src2_m2, 4 * sizeof(uint64_t));
  mint64m2_t i64_out_m2 = msubu_mm(u64_ts1_m2, u64_ts2_m2);
  msce64_m(i64_out_m2, i64_buffer, 4 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m2, i64_buffer, 5 * 4, "MSUBU.MM  UINT64 M2");
  // M4
  // uint8
  msettype(E8, M4, BA);
  msettilemi(2);
  msettileni(33);
  const uint8_t u8_src1_m4[] = {
      37,  135, 223, 52,  225, 115, 83,  232, 222, 221, 61,  136, 103, 53,
      212, 251, 138, 184, 147, 229, 236, 197, 238, 29,  89,  47,  160, 91,
      87,  223, 157, 26,  10,  152, 217, 141, 111, 122, 253, 159, 78,  198,
      88,  212, 241, 41,  176, 179, 163, 36,  53,  28,  191, 11,  86,  14,
      66,  194, 139, 241, 126, 153, 238, 114, 15,  210};
  const uint8_t u8_src2_m4[] = {
      100, 111, 128, 45,  11,  173, 42,  54,  81,  132, 106, 154, 45,  78,
      244, 158, 157, 222, 124, 216, 14,  133, 139, 219, 233, 249, 78,  180,
      56,  104, 163, 115, 220, 66,  72,  68,  130, 209, 109, 40,  117, 41,
      181, 43,  121, 162, 185, 86,  241, 52,  184, 158, 222, 55,  69,  50,
      211, 4,   28,  112, 50,  135, 216, 120, 184, 104};
  const int8_t i8_ans_m4[] = {
      -63, 24,   95,   7,    214, -58, 41,   178,  141, 89,   -45,
      -18, 58,   -25,  -32,  93,  -19, -38,  23,   13,  222,  64,
      99,  -190, -144, -202, 82,  -89, 31,   119,  -6,  -89,  -210,
      86,  145,  73,   -19,  -87, 144, 119,  -39,  157, -93,  169,
      120, -121, -9,   93,   -78, -16, -131, -130, -31, -44,  17,
      -36, -145, 190,  111,  129, 76,  18,   22,   -6,  -169, 106};
  muint8m4_t u8_ts1_m4 = mlce8_m4(u8_src1_m4, 33 * sizeof(uint8_t));
  muint8m4_t u8_ts2_m4 = mlce8_m4(u8_src2_m4, 33 * sizeof(uint8_t));
  mint8m4_t i8_out_m4 = msubu_mm(u8_ts1_m4, u8_ts2_m4);
  msce8_m(i8_out_m4, i8_buffer, 33 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m4, i8_buffer, 2 * 33, "MSUBU.MM  UINT8  M4");
  // uint16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(17);
  const uint16_t u16_src1_m4[] = {
      8125,  47230, 37207, 25199, 15635, 62090, 47614, 7073,  51388,
      44573, 44825, 62606, 34310, 8927,  25639, 38175, 57448, 37408,
      46692, 26595, 31731, 37737, 22635, 25171, 51222, 25276, 48620,
      24803, 27536, 57066, 12442, 48580, 41171, 60368, 6033,  49089,
      55923, 63713, 61244, 11844, 22217, 53661, 52574, 794,   10178,
      16219, 18873, 12348, 11100, 32624, 56635};
  const uint16_t u16_src2_m4[] = {
      35947, 718,   57136, 26901, 29435, 7256,  9826,  29666, 57862,
      43303, 16252, 54115, 20782, 28863, 15199, 36926, 46640, 14487,
      30016, 38587, 13161, 47593, 2926,  64119, 15998, 30610, 30121,
      28043, 694,   18594, 43876, 41100, 64121, 20894, 41288, 54058,
      30783, 19253, 52290, 47227, 2530,  40564, 26967, 57398, 40943,
      49804, 50541, 5160,  51867, 54294, 51925};
  const int16_t i16_ans_m4[] = {
      -27822, 46512,  -19929, -1702,  -13800, 54834,  37788, -22593, -6474,
      1270,   28573,  8491,   13528,  -19936, 10440,  1249,  10808,  22921,
      16676,  -11992, 18570,  -9856,  19709,  -38948, 35224, -5334,  18499,
      -3240,  26842,  38472,  -31434, 7480,   -22950, 39474, -35255, -4969,
      25140,  44460,  8954,   -35383, 19687,  13097,  25607, -56604, -30765,
      -33585, -31668, 7188,   -40767, -21670, 4710};
  muint16m4_t u16_ts1_m4 = mlce16_m4(u16_src1_m4, 17 * sizeof(uint16_t));
  muint16m4_t u16_ts2_m4 = mlce16_m4(u16_src2_m4, 17 * sizeof(uint16_t));
  mint16m4_t i16_out_m4 = msubu_mm(u16_ts1_m4, u16_ts2_m4);
  msce16_m(i16_out_m4, i16_buffer, 17 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m4, i16_buffer, 3 * 17, "MSUBU.MM  UINT16 M4");
  // uint32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(9);
  const uint32_t u32_src1_m4[] = {
      2706866676, 4068319682, 1069781507, 1055784700, 2559206990, 3440926140,
      921342082,  686799586,  17650058,   3514323046, 2439838772, 1994576840,
      3610192210, 3308976916, 3854514715, 1549401303, 1817448678, 2446821339,
      3468305787, 1797116109, 294235399,  2330893717, 1638397012, 1825918072,
      3987385048, 868037,     2896685389, 173738147,  391215167,  1765508058,
      218838218,  2514589978, 2651487266, 704537675,  1602542337, 3654921745};
  const uint32_t u32_src2_m4[] = {
      1857235573, 1875695644, 2580720212, 4164676934, 4278126919, 2061032769,
      2798004920, 3827173841, 403040163,  1328445524, 3412679568, 1859713107,
      2873027012, 3723206285, 3037148012, 2077390563, 1493930235, 2315076570,
      2213831474, 1623828899, 3516133840, 908966160,  210893397,  3259759977,
      1724926833, 4292471465, 2770599654, 242335816,  1517224895, 3473445746,
      3515146629, 2739060125, 3562042859, 3582640437, 338488885,  4160450270};
  const int32_t i32_ans_m4[] = {
      849631103,   2192624038,  -1510938705, -3108892234, -1718919929,
      1379893371,  -1876662838, -3140374255, -385390105,  2185877522,
      -972840796,  134863733,   737165198,   -414229369,  817366703,
      -527989260,  323518443,   131744769,   1254474313,  173287210,
      -3221898441, 1421927557,  1427503615,  -1433841905, 2262458215,
      -4291603428, 126085735,   -68597669,   -1126009728, -1707937688,
      -3296308411, -224470147,  -910555593,  -2878102762, 1264053452,
      -505528525};
  muint32m4_t u32_ts1_m4 = mlce32_m4(u32_src1_m4, 9 * sizeof(uint32_t));
  muint32m4_t u32_ts2_m4 = mlce32_m4(u32_src2_m4, 9 * sizeof(uint32_t));
  mint32m4_t i32_out_m4 = msubu_mm(u32_ts1_m4, u32_ts2_m4);
  msce32_m(i32_out_m4, i32_buffer, 9 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m4, i32_buffer, 4 * 9, "MSUBU.MM  UINT32 M4");
  // uint64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(5);
  const uint64_t u64_src1_m4[] = {
      120995720853669857, 123972399919359639, 109705882719036850,
      164236985101186233, 58421357051759823,  20628341864986814,
      133975021570312448, 58732396673431198,  87231607587711540,
      39204840199377889,  27006389428200300,  46595974407597160,
      116047635945357375, 57123744391084627,  150050073716891758,
      46159435036791711,  7583180261818918,   179690457605139568,
      44420738471300001,  54519134055552634,  77601387210775502,
      35941327024405300,  116797353794399473, 74715485128002658,
      92811261335143631};
  const uint64_t u64_src2_m4[] = {
      20518012674264887,  117115726592401439, 97099307948648851,
      93574232852988951,  108036322135444060, 21936887087486349,
      88855897695664919,  156503800071909343, 179058973515861166,
      58502166700276496,  162416401108148549, 145127979399895801,
      2855279676079271,   19449270523446262,  45695024111007647,
      51170046567481767,  114783477377166538, 145770951938560053,
      33064489902777813,  87814018268305742,  69055140572736999,
      167862434883396623, 75389093845078176,  153404175574153781,
      103029465332762098};
  const int64_t i64_ans_m4[] = {
      100477708179404970,  6856673326958200,    12606574770387999,
      70662752248197282,   -49614965083684237,  -1308545222499535,
      45119123874647529,   -97771403398478145,  -91827365928149626,
      -19297326500898607,  -135410011679948249, -98532004992298641,
      113192356269278104,  37674473867638365,   104355049605884111,
      -5010611530690056,   -107200297115347620, 33919505666579515,
      11356248568522188,   -33294884212753108,  8546246638038503,
      -131921107858991323, 41408259949321297,   -78688690446151123,
      -10218203997618467};
  muint64m4_t u64_ts1_m4 = mlce64_m4(u64_src1_m4, 5 * sizeof(uint64_t));
  muint64m4_t u64_ts2_m4 = mlce64_m4(u64_src2_m4, 5 * sizeof(uint64_t));
  mint64m4_t i64_out_m4 = msubu_mm(u64_ts1_m4, u64_ts2_m4);
  msce64_m(i64_out_m4, i64_buffer, 5 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m4, i64_buffer, 5 * 5, "MSUBU.MM  UINT64 M4");
}

int main() {
  test_msub_mm();
  test_mfsub_mm();
  test_mssub_mm();
  test_mfwsub_mm();
  test_mssubu_mm();
  test_mwsubu_mm();
  test_mwsub_mm();
  test_msubu_mm();
  return 0;
}

#include "utils.h"
#include <riscv_matrix.h>

static void test_mmaxu_mm() {
  // M1
  // uint8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(16);
  const uint8_t u8_src1[] = {72,  97, 21,  126, 108, 31, 9,  96, 23, 58, 34,
                             120, 82, 120, 18,  43,  49, 1,  86, 71, 44, 57,
                             44,  66, 90,  120, 112, 64, 86, 78, 65, 33};
  const uint8_t u8_src2[] = {105, 39, 64, 39, 20, 19, 72, 22, 26,  46,  20,
                             37,  20, 97, 22, 26, 84, 31, 90, 124, 119, 57,
                             75,  72, 51, 13, 39, 0,  98, 34, 21,  94};
  const uint8_t u8_ans[] = {105, 97, 64,  126, 108, 31, 72, 96, 26,  58,  34,
                            120, 82, 120, 22,  43,  84, 31, 90, 124, 119, 57,
                            75,  72, 90,  120, 112, 64, 98, 78, 65,  94};
  muint8m1_t u8_ts1 = mlce8_m1(u8_src1, 16 * sizeof(uint8_t));
  muint8m1_t u8_ts2 = mlce8_m1(u8_src2, 16 * sizeof(uint8_t));
  muint8m1_t u8_out = mmaxu_mm(u8_ts1, u8_ts2);
  msce8_m(u8_out, u8_buffer, 16 * sizeof(uint8_t));
  EXCEPT_U8_ARRAY_EQ(u8_ans, u8_buffer, 32, " MMAXU.MM UINT8  M1");
  // uint16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(8);
  const uint16_t u16_src1[] = {63328, 10154, 16218, 53049, 9508,  44123,
                               35713, 14324, 41332, 30194, 14573, 59698,
                               20940, 55121, 11235, 8813,  51849, 63803,
                               12366, 4169,  60332, 64127, 38227, 7064};
  const uint16_t u16_src2[] = {47082, 14299, 53213, 25416, 15503, 19080,
                               9381,  55313, 19667, 49799, 25443, 18211,
                               58368, 1816,  700,   58066, 1113,  27763,
                               63133, 1319,  45891, 47060, 64877, 17407};
  const uint16_t u16_ans[] = {63328, 14299, 53213, 53049, 15503, 44123,
                              35713, 55313, 41332, 49799, 25443, 59698,
                              58368, 55121, 11235, 58066, 51849, 63803,
                              63133, 4169,  60332, 64127, 64877, 17407};
  muint16m1_t u16_ts1 = mlce16_m1(u16_src1, 8 * sizeof(uint16_t));
  muint16m1_t u16_ts2 = mlce16_m1(u16_src2, 8 * sizeof(uint16_t));
  muint16m1_t u16_out = mmaxu_mm(u16_ts1, u16_ts2);
  msce16_m(u16_out, u16_buffer, 8 * sizeof(uint16_t));
  EXCEPT_U16_ARRAY_EQ(u16_ans, u16_buffer, 24, " MMAXU.MM UINT16 M1");
  // uint32
  msettype(E32, M1, BA);
  msettilemi(4);
  msettileni(4);
  const uint32_t u32_src1[] = {2170962365, 2642166265, 496464709,  3277757434,
                               2418050902, 1167103389, 2843034263, 110563751,
                               3347320338, 1200712582, 2235619761, 4150828436,
                               1790802612, 2541312761, 2660502058, 2477124844};
  const uint32_t u32_src2[] = {2830823178, 2072533715, 2524225596, 1088660224,
                               460455532,  810453411,  1104655015, 3535261923,
                               4231459240, 2197037824, 4273314649, 1894569331,
                               1004287784, 2810464069, 662100536,  3536382291};
  const uint32_t u32_ans[] = {2830823178, 2642166265, 2524225596, 3277757434,
                              2418050902, 1167103389, 2843034263, 3535261923,
                              4231459240, 2197037824, 4273314649, 4150828436,
                              1790802612, 2810464069, 2660502058, 3536382291};
  muint32m1_t u32_ts1 = mlce32_m1(u32_src1, 4 * sizeof(uint32_t));
  muint32m1_t u32_ts2 = mlce32_m1(u32_src2, 4 * sizeof(uint32_t));
  muint32m1_t u32_out = mmaxu_mm(u32_ts1, u32_ts2);
  msce32_m(u32_out, u32_buffer, 4 * sizeof(uint32_t));
  EXCEPT_U32_ARRAY_EQ(u32_ans, u32_buffer, 16, " MMAXU.MM UINT32 M1");
  // uint64
  msettype(E64, M1, BA);
  msettilemi(5);
  msettileni(2);
  const uint64_t u64_src1[] = {
      352361903713561, 747766802104647, 290772483466625, 743183030443084,
      744526008762870, 602246975010931, 845750713466696, 1125115186276100,
      542790229667807, 202348430279884};
  const uint64_t u64_src2[] = {
      310700304354536, 271893964973620, 185616800254665, 183042575760506,
      343322211952965, 406184926914348, 635950189823464, 64071705309843,
      395279082523079, 403121812836511};
  const uint64_t u64_ans[] = {
      352361903713561, 747766802104647, 290772483466625, 743183030443084,
      744526008762870, 602246975010931, 845750713466696, 1125115186276100,
      542790229667807, 403121812836511};
  muint64m1_t u64_ts1 = mlce64_m1(u64_src1, 2 * sizeof(uint64_t));
  muint64m1_t u64_ts2 = mlce64_m1(u64_src2, 2 * sizeof(uint64_t));
  muint64m1_t u64_out = mmaxu_mm(u64_ts1, u64_ts2);
  msce64_m(u64_out, u64_buffer, 2 * sizeof(uint64_t));
  EXCEPT_U64_ARRAY_EQ(u64_ans, u64_buffer, 10, " MMAXU.MM UINT64 M1");
  // M2
  // uint8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const uint8_t u8_src1_m2[] = {
      126, 145, 134, 39,  245, 5,   141, 36,  67,  157, 190, 82,  181,
      223, 166, 78,  148, 178, 99,  65,  29,  86,  162, 205, 149, 192,
      150, 1,   77,  211, 55,  224, 6,   26,  180, 138, 137, 20,  6,
      37,  50,  143, 105, 152, 93,  247, 73,  195, 69,  175, 157, 176,
      32,  250, 43,  147, 180, 69,  27,  242, 29,  114, 99,  233};
  const uint8_t u8_src2_m2[] = {
      12,  215, 166, 213, 207, 213, 147, 113, 94,  41,  170, 110, 82,
      121, 94,  72,  37,  147, 236, 22,  137, 138, 123, 241, 216, 223,
      197, 124, 137, 86,  224, 152, 157, 48,  65,  166, 191, 3,   150,
      247, 205, 160, 119, 123, 9,   245, 24,  96,  205, 75,  246, 11,
      49,  218, 15,  185, 217, 135, 196, 79,  169, 38,  171, 7};
  const uint8_t u8_ans_m2[] = {
      126, 215, 166, 213, 245, 213, 147, 113, 94,  157, 190, 110, 181,
      223, 166, 78,  148, 178, 236, 65,  137, 138, 162, 241, 216, 223,
      197, 124, 137, 211, 224, 224, 157, 48,  180, 166, 191, 20,  150,
      247, 205, 160, 119, 152, 93,  247, 73,  195, 205, 175, 246, 176,
      49,  250, 43,  185, 217, 135, 196, 242, 169, 114, 171, 233};
  muint8m2_t u8_ts1_m2 = mlce8_m2(u8_src1_m2, 32 * sizeof(uint8_t));
  muint8m2_t u8_ts2_m2 = mlce8_m2(u8_src2_m2, 32 * sizeof(uint8_t));
  muint8m2_t u8_out_m2 = mmaxu_mm(u8_ts1_m2, u8_ts2_m2);
  msce8_m(u8_out_m2, u8_buffer, 32 * sizeof(uint8_t));
  EXCEPT_U8_ARRAY_EQ(u8_ans_m2, u8_buffer, 2 * 32, "MMAXU.MM UINT8  M2");
  // uint16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const uint16_t u16_src1_m2[] = {
      7345,  44311, 29687, 5441,  39675, 63282, 52367, 30248, 48081, 46427,
      6593,  17299, 35407, 36931, 29686, 23929, 57192, 55611, 28204, 39085,
      2211,  46188, 50342, 6345,  44504, 47819, 28834, 3294,  30684, 32338,
      56128, 10368, 46668, 4289,  25216, 32714, 6942,  28915, 230,   13042,
      60431, 23889, 3266,  51986, 40274, 12733, 33801, 295};
  const uint16_t u16_src2_m2[] = {
      27013, 4570,  46609, 356,   33796, 31678, 9906,  9418,  34475, 5841,
      14272, 59044, 12748, 50360, 54482, 26152, 38874, 9819,  10370, 18833,
      25610, 46178, 36416, 45858, 3566,  10723, 22353, 15876, 41076, 45554,
      16877, 64271, 58878, 16835, 51671, 22176, 11025, 59141, 63904, 37931,
      22544, 6194,  60394, 58990, 53451, 9900,  47235, 33881};
  const uint16_t u16_ans_m2[] = {
      27013, 44311, 46609, 5441,  39675, 63282, 52367, 30248, 48081, 46427,
      14272, 59044, 35407, 50360, 54482, 26152, 57192, 55611, 28204, 39085,
      25610, 46188, 50342, 45858, 44504, 47819, 28834, 15876, 41076, 45554,
      56128, 64271, 58878, 16835, 51671, 32714, 11025, 59141, 63904, 37931,
      60431, 23889, 60394, 58990, 53451, 12733, 47235, 33881};
  muint16m2_t u16_ts1_m2 = mlce16_m2(u16_src1_m2, 16 * sizeof(uint16_t));
  muint16m2_t u16_ts2_m2 = mlce16_m2(u16_src2_m2, 16 * sizeof(uint16_t));
  muint16m2_t u16_out_m2 = mmaxu_mm(u16_ts1_m2, u16_ts2_m2);
  msce16_m(u16_out_m2, u16_buffer, 16 * sizeof(uint16_t));
  EXCEPT_U16_ARRAY_EQ(u16_ans_m2, u16_buffer, 3 * 16, "MMAXU.MM UINT16 M2");
  // uint32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const uint32_t u32_src1_m2[] = {
      1992849847, 1759106319, 942062212,  3415810765, 416978521,  3447034138,
      1458079963, 3671085776, 1416625441, 2665681579, 701249558,  2168999423,
      2243151431, 975650181,  4165451013, 2915965877, 1420596559, 3535801626,
      553482768,  3696438796, 986938956,  499957871,  2662897629, 1086106629,
      2552299992, 86779079,   1010308559, 2304455231, 3700786926, 1948170733,
      835115798,  2494431429};
  const uint32_t u32_src2_m2[] = {
      2363557023, 2571974838, 1533627973, 693026587,  83869572,   3927687820,
      3241339455, 994754281,  15176656,   1093532960, 2057559261, 2092696451,
      350324086,  2676980166, 3407361555, 1167554904, 1258997185, 2834748702,
      2660759983, 3794128128, 3254993962, 3764566559, 1136908784, 315432066,
      3116849902, 2206834742, 1252016351, 837062717,  1389350154, 2825829959,
      3604392142, 1521390177};
  const uint32_t u32_ans_m2[] = {
      2363557023, 2571974838, 1533627973, 3415810765, 416978521,  3927687820,
      3241339455, 3671085776, 1416625441, 2665681579, 2057559261, 2168999423,
      2243151431, 2676980166, 4165451013, 2915965877, 1420596559, 3535801626,
      2660759983, 3794128128, 3254993962, 3764566559, 2662897629, 1086106629,
      3116849902, 2206834742, 1252016351, 2304455231, 3700786926, 2825829959,
      3604392142, 2494431429};
  muint32m2_t u32_ts1_m2 = mlce32_m2(u32_src1_m2, 8 * sizeof(uint32_t));
  muint32m2_t u32_ts2_m2 = mlce32_m2(u32_src2_m2, 8 * sizeof(uint32_t));
  muint32m2_t u32_out_m2 = mmaxu_mm(u32_ts1_m2, u32_ts2_m2);
  msce32_m(u32_out_m2, u32_buffer, 8 * sizeof(uint32_t));
  EXCEPT_U32_ARRAY_EQ(u32_ans_m2, u32_buffer, 4 * 8, "MMAXU.MM UINT32 M2");
  // uint64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const uint64_t u64_src1_m2[] = {
      5253050741133735838,  17491510116265346861, 1682330436200457017,
      6903844669340784729,  7213432990082693368,  7117028260733261495,
      17108106044968721561, 5992948639431670934,  2762820485021861255,
      13865821385720568807, 7156489752594475612,  16014500254793108092,
      13788318064388785670, 1441508177195994873,  12627696435502454686,
      9138343612598694398,  2739142817219893749,  16310846895717157354,
      17955891002932136621, 4802849613691380972};
  const uint64_t u64_src2_m2[] = {
      870947990778251604,   7341303583824436066,  13712197753300482085,
      5322721851135212370,  11919085255209877934, 14429746857088399969,
      9619904433226488129,  14913234644940239289, 8960537881922038436,
      11321669407706767515, 11284989852893492289, 2145009606822307606,
      5386109289664741440,  16603959924568608736, 12117763714961403672,
      1782039626284135776,  6892559993212705591,  10025903757134179792,
      5558911504021686200,  8396616630972009768};
  const uint64_t u64_ans_m2[] = {
      5253050741133735838,  17491510116265346861, 13712197753300482085,
      6903844669340784729,  11919085255209877934, 14429746857088399969,
      17108106044968721561, 14913234644940239289, 8960537881922038436,
      13865821385720568807, 11284989852893492289, 16014500254793108092,
      13788318064388785670, 16603959924568608736, 12627696435502454686,
      9138343612598694398,  6892559993212705591,  16310846895717157354,
      17955891002932136621, 8396616630972009768};
  muint64m2_t u64_ts1_m2 = mlce64_m2(u64_src1_m2, 4 * sizeof(uint64_t));
  muint64m2_t u64_ts2_m2 = mlce64_m2(u64_src2_m2, 4 * sizeof(uint64_t));
  muint64m2_t u64_out_m2 = mmaxu_mm(u64_ts1_m2, u64_ts2_m2);
  msce64_m(u64_out_m2, u64_buffer, 4 * sizeof(uint64_t));
  EXCEPT_U64_ARRAY_EQ(u64_ans_m2, u64_buffer, 5 * 4, "MMAXU.MM UINT64 M2");
  // M4
  // uint8
  msettype(E8, M4, BA);
  msettilemi(2);
  msettileni(33);
  const uint8_t u8_src1_m4[] = {
      126, 145, 134, 39,  245, 5,   141, 36,  67,  157, 190, 82,  181, 223,
      166, 78,  148, 178, 99,  65,  29,  86,  162, 205, 149, 192, 150, 1,
      77,  211, 55,  224, 6,   26,  180, 138, 137, 20,  6,   37,  50,  143,
      105, 152, 93,  247, 73,  195, 69,  175, 157, 176, 32,  250, 43,  147,
      180, 69,  27,  242, 29,  114, 99,  233, 99,  233};
  const uint8_t u8_src2_m4[] = {
      12,  215, 166, 213, 207, 213, 147, 113, 94,  41,  170, 110, 82,  121,
      94,  72,  37,  147, 236, 22,  137, 138, 123, 241, 216, 223, 197, 124,
      137, 86,  224, 152, 157, 48,  65,  166, 191, 3,   150, 247, 205, 160,
      119, 123, 9,   245, 24,  96,  205, 75,  246, 11,  49,  218, 15,  185,
      217, 135, 196, 79,  169, 38,  171, 7,   171, 7};
  const uint8_t u8_ans_m4[] = {
      126, 215, 166, 213, 245, 213, 147, 113, 94,  157, 190, 110, 181, 223,
      166, 78,  148, 178, 236, 65,  137, 138, 162, 241, 216, 223, 197, 124,
      137, 211, 224, 224, 157, 48,  180, 166, 191, 20,  150, 247, 205, 160,
      119, 152, 93,  247, 73,  195, 205, 175, 246, 176, 49,  250, 43,  185,
      217, 135, 196, 242, 169, 114, 171, 233, 171, 233};
  muint8m4_t u8_ts1_m4 = mlce8_m4(u8_src1_m4, 33 * sizeof(uint8_t));
  muint8m4_t u8_ts2_m4 = mlce8_m4(u8_src2_m4, 33 * sizeof(uint8_t));
  muint8m4_t u8_out_m4 = mmaxu_mm(u8_ts1_m4, u8_ts2_m4);
  msce8_m(u8_out_m4, u8_buffer, 33 * sizeof(uint8_t));
  EXCEPT_U8_ARRAY_EQ(u8_ans_m4, u8_buffer, 2 * 33, "MMAXU.MM UINT8  M4");
  // uint16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(17);
  const uint16_t u16_src1_m4[] = {
      7345,  44311, 29687, 5441,  39675, 63282, 52367, 30248, 48081,
      46427, 6593,  17299, 35407, 36931, 29686, 23929, 57192, 55611,
      28204, 39085, 2211,  46188, 50342, 6345,  44504, 47819, 28834,
      3294,  30684, 32338, 56128, 10368, 46668, 4289,  25216, 32714,
      6942,  28915, 230,   13042, 60431, 23889, 3266,  51986, 40274,
      12733, 33801, 295,   12733, 33801, 295};
  const uint16_t u16_src2_m4[] = {
      27013, 4570,  46609, 356,   33796, 31678, 9906,  9418,  34475,
      5841,  14272, 59044, 12748, 50360, 54482, 26152, 38874, 9819,
      10370, 18833, 25610, 46178, 36416, 45858, 3566,  10723, 22353,
      15876, 41076, 45554, 16877, 64271, 58878, 16835, 51671, 22176,
      11025, 59141, 63904, 37931, 22544, 6194,  60394, 58990, 53451,
      9900,  47235, 33881, 9900,  47235, 33881};
  const uint16_t u16_ans_m4[] = {
      27013, 44311, 46609, 5441,  39675, 63282, 52367, 30248, 48081,
      46427, 14272, 59044, 35407, 50360, 54482, 26152, 57192, 55611,
      28204, 39085, 25610, 46188, 50342, 45858, 44504, 47819, 28834,
      15876, 41076, 45554, 56128, 64271, 58878, 16835, 51671, 32714,
      11025, 59141, 63904, 37931, 60431, 23889, 60394, 58990, 53451,
      12733, 47235, 33881, 12733, 47235, 33881};
  muint16m4_t u16_ts1_m4 = mlce16_m4(u16_src1_m4, 17 * sizeof(uint16_t));
  muint16m4_t u16_ts2_m4 = mlce16_m4(u16_src2_m4, 17 * sizeof(uint16_t));
  muint16m4_t u16_out_m4 = mmaxu_mm(u16_ts1_m4, u16_ts2_m4);
  msce16_m(u16_out_m4, u16_buffer, 17 * sizeof(uint16_t));
  EXCEPT_U16_ARRAY_EQ(u16_ans_m4, u16_buffer, 3 * 17, "MMAXU.MM UINT16 M4");
  // uint32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(9);
  const uint32_t u32_src1_m4[] = {
      1992849847, 1759106319, 942062212,  3415810765, 416978521,  3447034138,
      1458079963, 3671085776, 1416625441, 2665681579, 701249558,  2168999423,
      2243151431, 975650181,  4165451013, 2915965877, 1420596559, 3535801626,
      553482768,  3696438796, 986938956,  499957871,  2662897629, 1086106629,
      2552299992, 86779079,   1010308559, 2304455231, 3700786926, 1948170733,
      835115798,  2494431429, 3700786926, 1948170733, 835115798,  2494431429};
  const uint32_t u32_src2_m4[] = {
      2363557023, 2571974838, 1533627973, 693026587,  83869572,   3927687820,
      3241339455, 994754281,  15176656,   1093532960, 2057559261, 2092696451,
      350324086,  2676980166, 3407361555, 1167554904, 1258997185, 2834748702,
      2660759983, 3794128128, 3254993962, 3764566559, 1136908784, 315432066,
      3116849902, 2206834742, 1252016351, 837062717,  1389350154, 2825829959,
      3604392142, 1521390177, 1389350154, 2825829959, 3604392142, 1521390177};
  const uint32_t u32_ans_m4[] = {
      2363557023, 2571974838, 1533627973, 3415810765, 416978521,  3927687820,
      3241339455, 3671085776, 1416625441, 2665681579, 2057559261, 2168999423,
      2243151431, 2676980166, 4165451013, 2915965877, 1420596559, 3535801626,
      2660759983, 3794128128, 3254993962, 3764566559, 2662897629, 1086106629,
      3116849902, 2206834742, 1252016351, 2304455231, 3700786926, 2825829959,
      3604392142, 2494431429, 3700786926, 2825829959, 3604392142, 2494431429};
  muint32m4_t u32_ts1_m4 = mlce32_m4(u32_src1_m4, 9 * sizeof(uint32_t));
  muint32m4_t u32_ts2_m4 = mlce32_m4(u32_src2_m4, 9 * sizeof(uint32_t));
  muint32m4_t u32_out_m4 = mmaxu_mm(u32_ts1_m4, u32_ts2_m4);
  msce32_m(u32_out_m4, u32_buffer, 9 * sizeof(uint32_t));
  EXCEPT_U32_ARRAY_EQ(u32_ans_m4, u32_buffer, 4 * 9, "MMAXU.MM UINT32 M4");
  // uint64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(5);
  const uint64_t u64_src1_m4[] = {
      5253050741133735838,  17491510116265346861, 1682330436200457017,
      6903844669340784729,  7213432990082693368,  7117028260733261495,
      17108106044968721561, 5992948639431670934,  2762820485021861255,
      13865821385720568807, 7156489752594475612,  16014500254793108092,
      13788318064388785670, 1441508177195994873,  12627696435502454686,
      9138343612598694398,  2739142817219893749,  16310846895717157354,
      17955891002932136621, 4802849613691380972,  9138343612598694398,
      2739142817219893749,  16310846895717157354, 17955891002932136621,
      4802849613691380972};
  const uint64_t u64_src2_m4[] = {
      870947990778251604,   7341303583824436066,  13712197753300482085,
      5322721851135212370,  11919085255209877934, 14429746857088399969,
      9619904433226488129,  14913234644940239289, 8960537881922038436,
      11321669407706767515, 11284989852893492289, 2145009606822307606,
      5386109289664741440,  16603959924568608736, 12117763714961403672,
      1782039626284135776,  6892559993212705591,  10025903757134179792,
      5558911504021686200,  8396616630972009768,  1782039626284135776,
      6892559993212705591,  10025903757134179792, 5558911504021686200,
      8396616630972009768};
  const uint64_t u64_ans_m4[] = {
      5253050741133735838,  17491510116265346861, 13712197753300482085,
      6903844669340784729,  11919085255209877934, 14429746857088399969,
      17108106044968721561, 14913234644940239289, 8960537881922038436,
      13865821385720568807, 11284989852893492289, 16014500254793108092,
      13788318064388785670, 16603959924568608736, 12627696435502454686,
      9138343612598694398,  6892559993212705591,  16310846895717157354,
      17955891002932136621, 8396616630972009768,  9138343612598694398,
      6892559993212705591,  16310846895717157354, 17955891002932136621,
      8396616630972009768};
  muint64m4_t u64_ts1_m4 = mlce64_m4(u64_src1_m4, 5 * sizeof(uint64_t));
  muint64m4_t u64_ts2_m4 = mlce64_m4(u64_src2_m4, 5 * sizeof(uint64_t));
  muint64m4_t u64_out_m4 = mmaxu_mm(u64_ts1_m4, u64_ts2_m4);
  msce64_m(u64_out_m4, u64_buffer, 5 * sizeof(uint64_t));
  EXCEPT_U64_ARRAY_EQ(u64_ans_m4, u64_buffer, 5 * 5, "MMAXU.MM UINT64 M4");
}

static void test_mmax_mm() {
  // M1
  // int8
  msettype(E8, M1, BA);
  msettilemi(2);
  msettileni(16);
  const int8_t i8_src1[] = {11, -2, -16, 4,   3,  3,  14,  -1,  -9,  -11, -5,
                            12, -9, 1,   -12, 2,  -2, 5,   14,  -13, -7,  -10,
                            -3, 3,  0,   2,   -6, -8, -15, -13, 13,  -7};
  const int8_t i8_src2[] = {-6, 4,   -6,  -16, -12, -1,  -8, -3, 1,   9, -10,
                            -7, 8,   -13, 7,   8,   -11, 2,  12, -16, 1, -12,
                            8,  -16, -8,  -5,  10,  10,  -3, 13, -3,  -7};
  const int8_t i8_ans[] = {11, 4, -6, 4, 3,  3,  14, -1, 1,   9, -5,
                           12, 8, 1,  7, 8,  -2, 5,  14, -13, 1, -10,
                           8,  3, 0,  2, 10, 10, -3, 13, 13,  -7};
  mint8m1_t i8_ts1 = mlce8_m1(i8_src1, 16 * sizeof(int8_t));
  mint8m1_t i8_ts2 = mlce8_m1(i8_src2, 16 * sizeof(int8_t));
  mint8m1_t i8_out = mmax_mm(i8_ts1, i8_ts2);
  msce8_m(i8_out, i8_buffer, 16 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans, i8_buffer, 32, "MMAX.MM  INT8   M1");
  // int16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(8);
  const int16_t i16_src1[] = {-17057, -16295, 25057, -10233, 28413,  12007,
                              -17399, -5668,  14152, 32019,  -31265, 10367,
                              29656,  31018,  -406,  9972,   11806,  21239,
                              8534,   32375,  1175,  22671,  924,    -24210};
  const int16_t i16_src2[] = {25294,  -8814,  19067,  -12513, 10960,  -21825,
                              -28789, -25397, 22934,  14200,  -16079, -32064,
                              681,    22377,  -10360, -28357, -9777,  25692,
                              -11362, -12121, 22015,  2715,   -20428, -31568};
  const int16_t i16_ans[] = {25294,  -8814, 25057, -10233, 28413,  12007,
                             -17399, -5668, 22934, 32019,  -16079, 10367,
                             29656,  31018, -406,  9972,   11806,  25692,
                             8534,   32375, 22015, 22671,  924,    -24210};
  mint16m1_t i16_ts1 = mlce16_m1(i16_src1, 8 * sizeof(int16_t));
  mint16m1_t i16_ts2 = mlce16_m1(i16_src2, 8 * sizeof(int16_t));
  mint16m1_t i16_out = mmax_mm(i16_ts1, i16_ts2);
  msce16_m(i16_out, i16_buffer, 8 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans, i16_buffer, 24, "MMAX.MM  INT16  M1");
  // int32
  msettype(E32, M1, BA);
  msettilemi(4);
  msettileni(4);
  const int32_t i32_src1[] = {-861287395, 204848147,   1305589136, -946171863,
                              -122792193, -1431910166, -836008516, 713072058,
                              -481112667, 915917386,   2065311754, -1702726167,
                              2131002886, -1748604417, 1133201978, 840473455};
  const int32_t i32_src2[] = {
      -1570586134, 12371755,   -932159079,  -1793785782,
      -1446584466, 1662684864, 175550111,   1165820824,
      -1085118973, -729951360, -1570190575, -1340295677,
      973362074,   2135436069, -989197087,  -1585731750};
  const int32_t i32_ans[] = {-861287395, 204848147,  1305589136, -946171863,
                             -122792193, 1662684864, 175550111,  1165820824,
                             -481112667, 915917386,  2065311754, -1340295677,
                             2131002886, 2135436069, 1133201978, 840473455};
  mint32m1_t i32_ts1 = mlce32_m1(i32_src1, 4 * sizeof(int32_t));
  mint32m1_t i32_ts2 = mlce32_m1(i32_src2, 4 * sizeof(int32_t));
  mint32m1_t i32_out = mmax_mm(i32_ts1, i32_ts2);
  msce32_m(i32_out, i32_buffer, 4 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans, i32_buffer, 16, "MMAX.MM  INT32  M1");
  // int64
  msettype(E64, M1, BA);
  msettilemi(5);
  msettileni(2);
  const int64_t i64_src1[] = {-2386763900129865948, -6521252643967237782,
                              -1311838717427789438, 6007446460365708976,
                              -2596146303161729557, 7920263681066851754,
                              -8987066433661000582, 2558313231798482650,
                              3363543829192178485,  -4090773115304906597};
  const int64_t i64_src2[] = {6156583523821316593,  1258142794881898238,
                              -1346139927759552177, 128717783922868959,
                              5884807807598642291,  7341804145767265910,
                              8640855197058903161,  -2579984807138425349,
                              1300564221154451147,  4372747360370556705};
  const int64_t i64_ans[] = {6156583523821316593,  1258142794881898238,
                             -1311838717427789438, 6007446460365708976,
                             5884807807598642291,  7920263681066851754,
                             8640855197058903161,  2558313231798482650,
                             3363543829192178485,  4372747360370556705};
  mint64m1_t i64_ts1 = mlce64_m1(i64_src1, 2 * sizeof(int64_t));
  mint64m1_t i64_ts2 = mlce64_m1(i64_src2, 2 * sizeof(int64_t));
  mint64m1_t i64_out = mmax_mm(i64_ts1, i64_ts2);
  msce64_m(i64_out, i64_buffer, 2 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans, i64_buffer, 10, "MMAX.MM  INT64  M1");
  // M2
  // int8
  msettype(E8, M2, BA);
  msettilemi(2);
  msettileni(32);
  const int8_t i8_src1_m2[] = {
      -81, 12,  44,  73,  50,  -106, 25,  79,  -78, -53, 79,   -109, 117,
      -82, -9,  -95, 39,  55,  -16,  80,  -63, 13,  88,  -13,  96,   -87,
      -79, 81,  0,   105, -24, -86,  -28, 67,  -10, 93,  106,  -128, 86,
      -28, -87, 81,  -31, -78, -54,  96,  49,  -28, 89,  -50,  -33,  -117,
      -97, -13, 97,  -37, -56, 118,  97,  -2,  103, -81, -117, -110};
  const int8_t i8_src2_m2[] = {
      39,  65,  -62, 84,   -27, 82,  14, 26,  -117, -62,  77,  -68, 94,
      126, -44, -40, 26,   -89, -88, 50, 91,  81,   -47,  106, -92, -107,
      -34, -14, 26,  5,    56,  -9,  85, -78, 31,   16,   -93, 63,  -92,
      -16, -53, -85, 29,   11,  122, 1,  -37, -28,  -127, 82,  -63, 51,
      121, 81,  -37, -108, -19, 4,   79, 34,  79,   -88,  24,  -23};
  const int8_t i8_ans_m2[] = {
      39, 65, 44,  84, 50,  82, 25, 79,  -78, -53, 79,  -68, 117, 126, -9, -40,
      39, 55, -16, 80, 91,  81, 88, 106, 96,  -87, -34, 81,  26,  105, 56, -9,
      85, 67, 31,  93, 106, 63, 86, -16, -53, 81,  29,  11,  122, 96,  49, -28,
      89, 82, -33, 51, 121, 81, 97, -37, -19, 118, 97,  34,  103, -81, 24, -23};
  mint8m2_t i8_ts1_m2 = mlce8_m2(i8_src1_m2, 32 * sizeof(int8_t));
  mint8m2_t i8_ts2_m2 = mlce8_m2(i8_src2_m2, 32 * sizeof(int8_t));
  mint8m2_t i8_out_m2 = mmax_mm(i8_ts1_m2, i8_ts2_m2);
  msce8_m(i8_out_m2, i8_buffer, 32 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m2, i8_buffer, 2 * 32, "MMAX.MM  INT8   M2");
  // int16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const int16_t i16_src1_m2[] = {
      -28586, 14903,  -28684, 8441,   -6598,  12853,  24815,  -18696,
      -1163,  3333,   3638,   -8571,  -7103,  29368,  2825,   -19955,
      26011,  -21658, -12474, -22053, -28267, 26795,  -13563, -28386,
      -32746, 21890,  -14962, -15430, 31602,  -24569, -20552, 14653,
      20871,  -9581,  -30229, 23857,  25140,  19157,  -16281, -139,
      -18348, 6601,   -3955,  16818,  21964,  -22687, 12922,  -12341};
  const int16_t i16_src2_m2[] = {
      -6400,  13308,  26287,  28982,  28479,  14614,  17118, -11985,
      11873,  -14912, -30214, 1247,   26801,  13946,  15196, -30306,
      -21135, 29455,  7096,   31615,  -30684, 6583,   18737, 24309,
      21514,  -26328, 17846,  -17321, -29596, 4817,   -1275, -23071,
      17005,  -1031,  22165,  -14570, 21444,  9204,   8498,  32182,
      -513,   7264,   8371,   31868,  1004,   -29968, -5543, -30805};
  const int16_t i16_ans_m2[] = {
      -6400,  14903, 26287, 28982, 28479, 14614,  24815, -11985, 11873, 3333,
      3638,   1247,  26801, 29368, 15196, -19955, 26011, 29455,  7096,  31615,
      -28267, 26795, 18737, 24309, 21514, 21890,  17846, -15430, 31602, 4817,
      -1275,  14653, 20871, -1031, 22165, 23857,  25140, 19157,  8498,  32182,
      -513,   7264,  8371,  31868, 21964, -22687, 12922, -12341};
  mint16m2_t i16_ts1_m2 = mlce16_m2(i16_src1_m2, 16 * sizeof(int16_t));
  mint16m2_t i16_ts2_m2 = mlce16_m2(i16_src2_m2, 16 * sizeof(int16_t));
  mint16m2_t i16_out_m2 = mmax_mm(i16_ts1_m2, i16_ts2_m2);
  msce16_m(i16_out_m2, i16_buffer, 16 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m2, i16_buffer, 3 * 16, "MMAX.MM  INT16  M2");
  // int32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const int32_t i32_src1_m2[] = {
      1152239637,  424940807,   1496735952,  -367070860, -1406447334,
      -772104783,  -1635442589, 2033091822,  1596769732, -1564847786,
      -1055281731, 1592733040,  -1348335683, 1544238734, 1500544908,
      -1062567539, -1582050446, -650927974,  2043758739, -551370786,
      -521054645,  -549843259,  -1426818676, 2077180445, 1417474459,
      -1848054403, 1430099168,  854365048,   1454755623, -483775051,
      -60592165,   -1647980348};
  const int32_t i32_src2_m2[] = {
      -1238908185, -911066435,  -1393743912, 901538129,  1917386403,
      665433011,   -961239956,  -1211094060, 1998208015, -2101555996,
      -1119725094, 752178286,   1336327848,  1998154314, -1063590309,
      2113237133,  -1463077441, -1432151578, 1037527736, 1977740832,
      1608546379,  -298973579,  2032626925,  1331682163, 1523170917,
      -1929477358, -1804760061, -57772429,   -603155045, 20152925,
      -1866705385, 1694191888};
  const int32_t i32_ans_m2[] = {
      1152239637, 424940807,   1496735952, 901538129,   1917386403,  665433011,
      -961239956, 2033091822,  1998208015, -1564847786, -1055281731, 1592733040,
      1336327848, 1998154314,  1500544908, 2113237133,  -1463077441, -650927974,
      2043758739, 1977740832,  1608546379, -298973579,  2032626925,  2077180445,
      1523170917, -1848054403, 1430099168, 854365048,   1454755623,  20152925,
      -60592165,  1694191888};
  mint32m2_t i32_ts1_m2 = mlce32_m2(i32_src1_m2, 8 * sizeof(int32_t));
  mint32m2_t i32_ts2_m2 = mlce32_m2(i32_src2_m2, 8 * sizeof(int32_t));
  mint32m2_t i32_out_m2 = mmax_mm(i32_ts1_m2, i32_ts2_m2);
  msce32_m(i32_out_m2, i32_buffer, 8 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m2, i32_buffer, 4 * 8, "MMAX.MM  INT32  M2");
  // int64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const int64_t i64_src1_m2[] = {
      -3497989859807276560, -6225505144761487190, -176763516097349650,
      4254784122066319476,  7210854805337128164,  5143882421829143796,
      -3989215578828998771, -3403029072853401808, -5958061118331809761,
      4091075272318781068,  -5379071385589217253, 8036647545840570845,
      -8568622871281723075, -2759618321762475322, 317284216841172490,
      -5868443406319236380, -3976832293951785969, 6954351795586615398,
      -1669146074609703872, -4939024960354945315};
  const int64_t i64_src2_m2[] = {
      -3745506351594394727, -7270910168597849364, -1931074084805256878,
      -4835725071023536993, 3316628091977006118,  5069297645940353455,
      -5108267062673700011, 5436081506571411061,  -5143356957028118362,
      -3949752644272014738, -5238044265827562834, -2956428878312298563,
      -6830518511272962334, -7200234488173285627, -1380234495301202880,
      5062665353608575005,  1772508446597040899,  7954762905729203732,
      1656752068276560699,  8507345340231592061};
  const int64_t i64_ans_m2[] = {
      -3497989859807276560, -6225505144761487190, -176763516097349650,
      4254784122066319476,  7210854805337128164,  5143882421829143796,
      -3989215578828998771, 5436081506571411061,  -5143356957028118362,
      4091075272318781068,  -5238044265827562834, 8036647545840570845,
      -6830518511272962334, -2759618321762475322, 317284216841172490,
      5062665353608575005,  1772508446597040899,  7954762905729203732,
      1656752068276560699,  8507345340231592061};
  mint64m2_t i64_ts1_m2 = mlce64_m2(i64_src1_m2, 4 * sizeof(int64_t));
  mint64m2_t i64_ts2_m2 = mlce64_m2(i64_src2_m2, 4 * sizeof(int64_t));
  mint64m2_t i64_out_m2 = mmax_mm(i64_ts1_m2, i64_ts2_m2);
  msce64_m(i64_out_m2, i64_buffer, 4 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m2, i64_buffer, 5 * 4, "MMAX.MM  INT64  M2");
  // M4
  // int8
  msettype(E8, M4, BA);
  msettilemi(2);
  msettileni(33);
  const int8_t i8_src1_m4[] = {
      -94, -95,  -120, -48, -110, 48,  39,  100,  93,   -15, 73,
      -48, 16,   122,  70,  11,   35,  92,  113,  -126, -8,  7,
      -9,  0,    -122, 46,  -115, -55, -27, 32,   -121, 60,  -82,
      68,  -101, -63,  4,   -72,  113, 125, -55,  68,   -89, 59,
      -75, 40,   94,   29,  -61,  65,  -33, -81,  116,  -77, -34,
      -78, 32,   30,   86,  -37,  -39, 0,   -109, -5,   -70, -71};
  const int8_t i8_src2_m4[] = {
      109,  -4,   67,  -35, -12,  -60,  -72, 90,   80,  -89,  92,
      -19,  74,   103, -81, -107, -80,  115, -117, 28,  58,   -4,
      -127, -123, 41,  -70, 109,  85,   59,  13,   112, -102, -5,
      -44,  107,  124, 88,  -110, -44,  54,  50,   41,  7,    106,
      88,   -69,  113, 89,  45,   -128, -18, -1,   110, 54,   -2,
      51,   62,   -3,  109, 26,   -90,  125, -117, -78, -85,  -74};
  const int8_t i8_ans_m4[] = {
      109, -4,  67,  -35, -12, 48,  39,   100, 93,  -15, 92,  -19, 74,  122,
      70,  11,  35,  115, 113, 28,  58,   7,   -9,  0,   41,  46,  109, 85,
      59,  32,  112, 60,  -5,  68,  107,  124, 88,  -72, 113, 125, 50,  68,
      7,   106, 88,  40,  113, 89,  45,   65,  -18, -1,  116, 54,  -2,  51,
      62,  30,  109, 26,  -39, 125, -109, -5,  -70, -71};
  mint8m4_t i8_ts1_m4 = mlce8_m4(i8_src1_m4, 33 * sizeof(int8_t));
  mint8m4_t i8_ts2_m4 = mlce8_m4(i8_src2_m4, 33 * sizeof(int8_t));
  mint8m4_t i8_out_m4 = mmax_mm(i8_ts1_m4, i8_ts2_m4);
  msce8_m(i8_out_m4, i8_buffer, 33 * sizeof(int8_t));
  EXCEPT_I8_ARRAY_EQ(i8_ans_m4, i8_buffer, 2 * 33, "MMAX.MM  INT8   M4");
  // int16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(17);
  const int16_t i16_src1_m4[] = {
      12044,  -8923,  -11546, -22685, -12258, 7198,  -10225, -19829, -31977,
      -17414, 23609,  -9857,  14975,  13194,  9354,  -23381, 7826,   -12053,
      -18497, 27113,  7747,   20980,  13919,  -229,  -19872, -17808, -30201,
      -29556, 26210,  14986,  25958,  -28817, -9869, 11004,  -9123,  -3587,
      11239,  -17595, -22850, 5375,   28076,  19590, -17374, 28382,  -18526,
      19082,  -9475,  16961,  11852,  -26944, 25952};
  const int16_t i16_src2_m4[] = {
      -30112, -9561,  17669,  29385, 22329,  26484,  25627, 14426,  -26430,
      -11709, 11454,  -29570, 31276, -6150,  -20728, 7998,  11470,  -22238,
      -20383, 21482,  -4490,  11661, -10459, -30895, 29390, -28801, 6186,
      -24168, 25132,  26539,  20409, 30499,  2865,   29807, 6757,   -27502,
      4598,   -20228, 4575,   2350,  -14072, 6897,   28917, 19335,  18553,
      -11674, 20519,  -1409,  -4040, 28780,  -15835};
  const int16_t i16_ans_m4[] = {
      12044,  -8923,  17669, 29385, 22329, 26484, 25627, 14426,  -26430,
      -11709, 23609,  -9857, 31276, 13194, 9354,  7998,  11470,  -12053,
      -18497, 27113,  7747,  20980, 13919, -229,  29390, -17808, 6186,
      -24168, 26210,  26539, 25958, 30499, 2865,  29807, 6757,   -3587,
      11239,  -17595, 4575,  5375,  28076, 19590, 28917, 28382,  18553,
      19082,  20519,  16961, 11852, 28780, 25952};
  mint16m4_t i16_ts1_m4 = mlce16_m4(i16_src1_m4, 17 * sizeof(int16_t));
  mint16m4_t i16_ts2_m4 = mlce16_m4(i16_src2_m4, 17 * sizeof(int16_t));
  mint16m4_t i16_out_m4 = mmax_mm(i16_ts1_m4, i16_ts2_m4);
  msce16_m(i16_out_m4, i16_buffer, 17 * sizeof(int16_t));
  EXCEPT_I16_ARRAY_EQ(i16_ans_m4, i16_buffer, 3 * 17, "MMAX.MM  INT16  M4");
  // int32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(9);
  const int32_t i32_src1_m4[] = {
      -107546509, 1061373018,  -203006088,  -1627654031, -452115372,
      -372568397, -1835385421, 1254321858,  1238567767,  1083987829,
      2031737439, 850859664,   -629283944,  -893747860,  133164563,
      189235536,  -1019927049, -1211206506, 1825135252,  597930670,
      270372613,  1723743113,  316522445,   2042488342,  -1200765455,
      1730514267, 1510639136,  449353600,   -890350411,  -160192004,
      -722454017, -1224876569, -1651087036, -1452194639, 369424073,
      1388944482};
  const int32_t i32_src2_m4[] = {
      -888065925,  1842301179,  1120457827,  -1042516264, 1867988453,
      -1002997331, -2019344898, 1548663607,  -1958807896, 1366959415,
      -1017365793, -1331790617, 2059032925,  1007377738,  456889304,
      388930764,   -1588851295, 1668972146,  -93685915,   -1191842143,
      1401993483,  583490830,   -2043406413, -969352820,  53405130,
      839751208,   -131238683,  605828624,   1113443259,  749555024,
      -395496170,  -167099260,  1807294234,  551085009,   -130418333,
      2145398516};
  const int32_t i32_ans_m4[] = {
      -107546509, 1842301179,  1120457827, -1042516264, 1867988453,
      -372568397, -1835385421, 1548663607, 1238567767,  1366959415,
      2031737439, 850859664,   2059032925, 1007377738,  456889304,
      388930764,  -1019927049, 1668972146, 1825135252,  597930670,
      1401993483, 1723743113,  316522445,  2042488342,  53405130,
      1730514267, 1510639136,  605828624,  1113443259,  749555024,
      -395496170, -167099260,  1807294234, 551085009,   369424073,
      2145398516};
  mint32m4_t i32_ts1_m4 = mlce32_m4(i32_src1_m4, 9 * sizeof(int32_t));
  mint32m4_t i32_ts2_m4 = mlce32_m4(i32_src2_m4, 9 * sizeof(int32_t));
  mint32m4_t i32_out_m4 = mmax_mm(i32_ts1_m4, i32_ts2_m4);
  msce32_m(i32_out_m4, i32_buffer, 9 * sizeof(int32_t));
  EXCEPT_I32_ARRAY_EQ(i32_ans_m4, i32_buffer, 4 * 9, "MMAX.MM  INT32  M4");
  // int64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(5);
  const int64_t i64_src1_m4[] = {
      -292846494494946252,  -5004920598596784986, 3672600659534726631,
      -6302130903397328159, 6022598380354156099,  4278892181320243823,
      -7321747016654118411, 1556345141128742445,  7846017289101175795,
      1066232904055001441,  5178454904129708964,  3286220841660868530,
      4977793620167682562,  3446090839662537742,  4773548521424208325,
      -9030607720564377254, 2313005843848748521,  2708675313624541002,
      -7447559343775291688, 5618836284824161649,  4308735213895223793,
      4136326328178381172,  -3464235821086704432, -8345816362715559369,
      2052741992749163170};
  const int64_t i64_src2_m4[] = {
      2390727524138714098,  -7247128473199802113, -2399542649015421992,
      1575192761959022767,  2272110244226803987,  7536141930770478353,
      7231996022794488565,  -2479326123023727976, 8087972636584304330,
      6904084717411830026,  -5342114445539405798, -381543070176215830,
      -2630263788326511031, -3170810125016900894, 5564773214690265904,
      8965083126459328209,  4992120024963374116,  -1075572278157786016,
      18255984616054789,    -6375202565259384624, 7402278423952160082,
      -7383297035163360025, 1016296297476937805,  4349895850306688512,
      85847858260022338};
  const int64_t i64_ans_m4[] = {
      2390727524138714098, -5004920598596784986, 3672600659534726631,
      1575192761959022767, 6022598380354156099,  7536141930770478353,
      7231996022794488565, 1556345141128742445,  8087972636584304330,
      6904084717411830026, 5178454904129708964,  3286220841660868530,
      4977793620167682562, 3446090839662537742,  5564773214690265904,
      8965083126459328209, 4992120024963374116,  2708675313624541002,
      18255984616054789,   5618836284824161649,  7402278423952160082,
      4136326328178381172, 1016296297476937805,  4349895850306688512,
      2052741992749163170};
  mint64m4_t i64_ts1_m4 = mlce64_m4(i64_src1_m4, 5 * sizeof(int64_t));
  mint64m4_t i64_ts2_m4 = mlce64_m4(i64_src2_m4, 5 * sizeof(int64_t));
  mint64m4_t i64_out_m4 = mmax_mm(i64_ts1_m4, i64_ts2_m4);
  msce64_m(i64_out_m4, i64_buffer, 5 * sizeof(int64_t));
  EXCEPT_I64_ARRAY_EQ(i64_ans_m4, i64_buffer, 5 * 5, "MMAX.MM  INT64  M4");
}

static void test_mfmax_mm() {
  // M1
  // fp16
  msettype(E16, M1, BA);
  msettilemi(3);
  msettileni(8);
  const fp16_t fp16_src1[] = {
      -0.641, 1.274,   -0.5757, 0.7256,  -1.534,  0.593,   -1.165,  2.162,
      0.2944, -0.714,  0.2566,  -0.3442, -0.669,  -0.6343, 0.117,   -1.321,
      0.636,  -0.1808, 0.8984,  -0.2937, -0.6978, -1.882,  0.04224, 1.137};
  const fp16_t fp16_src2[] = {
      1.129,   0.4475,  -0.5806, -1.445,  0.307,   2.766,  0.08813, -1.221,
      -0.1545, 0.2212,  -0.1305, -0.9863, -0.9478, 0.6777, -1.476,  -0.394,
      -0.8354, 0.05124, -0.1344, 0.1136,  -0.4602, 0.4934, -1.589,  1.027};
  const fp16_t fp16_ans[] = {1.129,   1.274,  -0.5757, 0.7256, 0.307,   2.766,
                             0.08813, 2.162,  0.2944,  0.2212, 0.2566,  -0.3442,
                             -0.669,  0.6777, 0.117,   -0.394, 0.636,   0.05124,
                             0.8984,  0.1136, -0.4602, 0.4934, 0.04224, 1.137};
  mfloat16m1_t fp16_ts1 = mlce16_m1(fp16_src1, 8 * sizeof(fp16_t));
  mfloat16m1_t fp16_ts2 = mlce16_m1(fp16_src2, 8 * sizeof(fp16_t));
  mfloat16m1_t fp16_out = mfmax_mm(fp16_ts1, fp16_ts2);
  msce16_m(fp16_out, fp16_buffer, 8 * sizeof(fp16_t));
  EXCEPT_FP16_ARRAY_EQ(fp16_ans, fp16_buffer, 24, "MFMAX.MM FP16   M1");
  // fp32
  msettype(E32, M1, BA);
  msettilemi(4);
  msettileni(4);
  const fp32_t fp32_src1[] = {
      -0.4690982, -0.28848022, -0.23181526, -2.0541718, 0.18218172, 0.7917702,
      0.6092491,  0.19054824,  -0.5287594,  0.13876893, 0.00224436, -1.4519596,
      2.015604,   1.2912354,   -1.2530205,  -0.25601363};
  const fp32_t fp32_src2[] = {-0.84642494, 0.16054851, -1.7505393, -0.3455231,
                              -0.19710808, 0.10227215, 0.12655504, 0.8003212,
                              0.9909784,   0.17909421, -1.3823507, -0.78190917,
                              -1.4348396,  -1.1776177, 0.6670935,  1.7894806};
  const fp32_t fp32_ans[] = {-0.4690982, 0.16054851, -0.23181526, -0.3455231,
                             0.18218172, 0.7917702,  0.6092491,   0.8003212,
                             0.9909784,  0.17909421, 0.00224436,  -0.78190917,
                             2.015604,   1.2912354,  0.6670935,   1.7894806};
  mfloat32m1_t fp32_ts1 = mlce32_m1(fp32_src1, 4 * sizeof(fp32_t));
  mfloat32m1_t fp32_ts2 = mlce32_m1(fp32_src2, 4 * sizeof(fp32_t));
  mfloat32m1_t fp32_out = mfmax_mm(fp32_ts1, fp32_ts2);
  msce32_m(fp32_out, fp32_buffer, 4 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_EQ(fp32_ans, fp32_buffer, 16, "MFMAX.MM FP32   M1");
  // fp64
  msettype(E64, M1, BA);
  msettilemi(5);
  msettileni(2);
  const fp64_t fp64_src1[] = {-0.98383261, -0.3942304, -0.15611482, 2.16339874,
                              -0.74209649, -1.5500069, -1.62072863, -0.54966375,
                              0.54711649,  -1.22067194};
  const fp64_t fp64_src2[] = {-2.61784465, 0.02490006, 1.32696526, 0.74632626,
                              0.91131296,  1.1365966,  0.20496439, -1.32838022,
                              -0.1165156,  -0.94767632};
  const fp64_t fp64_ans[] = {-0.98383261, 0.02490006, 1.32696526, 2.16339874,
                             0.91131296,  1.1365966,  0.20496439, -0.54966375,
                             0.54711649,  -0.94767632};
  mfloat64m1_t fp64_ts1 = mlce64_m1(fp64_src1, 2 * sizeof(fp64_t));
  mfloat64m1_t fp64_ts2 = mlce64_m1(fp64_src2, 2 * sizeof(fp64_t));
  mfloat64m1_t fp64_out = mfmax_mm(fp64_ts1, fp64_ts2);
  msce64_m(fp64_out, fp64_buffer, 2 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_EQ(fp64_ans, fp64_buffer, 10, "MFMAX.MM FP64   M1");
  // M2
  // fp16
  msettype(E16, M2, BA);
  msettilemi(3);
  msettileni(16);
  const fp16_t fp16_src1_m2[] = {
      15360.,  -3210.,  -64192., 58304.,  -64640., -1113.,  -47680., -59232.,
      -29440., 45760.,  -46048., -41888., 48352.,  -51136., -25600., -40640.,
      -58080., 17376.,  -23280., -11064., -7300.,  -21184., -45120., -5468.,
      -46272., 25648.,  -53824., 807.5,   819.5,   -47584., -21312., -35904.,
      23904.,  -47040., 30352.,  14144.,  -11488., 2966.,   -38208., -44128.,
      -15344., -34208., 63360.,  -47584., -53568., 40224.,  62432.,  30144.};
  const fp16_t fp16_src2_m2[] = {
      -2.042e+04, -4.397e+04, -5.955e+04, 5.821e+04,  -1.885e+04, 7.012e+03,
      5.626e+04,  -1.808e+04, -4.147e+04, -2.216e+04, -3.914e+04, 4.330e+04,
      1.787e+04,  -4.723e+04, 2.378e+04,  9.710e+02,  -3.602e+03, -6.243e+04,
      5.075e+04,  4.573e+04,  5.388e+03,  -4.048e+04, -7.428e+03, 2.893e+04,
      -1.789e+04, -6.262e+04, -5.674e+04, 2.131e+04,  -6.432e+04, -5.965e+04,
      -4.781e+04, -2.893e+04, -5.133e+04, -4.016e+04, -1.098e+04, 2.259e+04,
      5.645e+04,  -5.920e+04, -2.320e+04, 1.527e+04,  3.259e+04,  1.296e+04,
      -1.989e+04, 5.962e+01,  -4.410e+04, -3.962e+04, -4.867e+04, 2.808e+04};
  const fp16_t fp16_ans_m2[] = {
      1.536e+04,  -3.210e+03, -5.955e+04, 5.830e+04,  -1.885e+04, 7.012e+03,
      5.626e+04,  -1.808e+04, -2.944e+04, 4.576e+04,  -3.914e+04, 4.330e+04,
      4.835e+04,  -4.723e+04, 2.378e+04,  9.710e+02,  -3.602e+03, 1.738e+04,
      5.075e+04,  4.573e+04,  5.388e+03,  -2.118e+04, -7.428e+03, 2.893e+04,
      -1.789e+04, 2.565e+04,  -5.382e+04, 2.131e+04,  8.195e+02,  -4.758e+04,
      -2.131e+04, -2.893e+04, 2.390e+04,  -4.016e+04, 3.035e+04,  2.259e+04,
      5.645e+04,  2.966e+03,  -2.320e+04, 1.527e+04,  3.259e+04,  1.296e+04,
      6.336e+04,  5.962e+01,  -4.410e+04, 4.022e+04,  6.243e+04,  3.014e+04};
  mfloat16m2_t fp16_ts1_m2 = mlce16_m2(fp16_src1_m2, 16 * sizeof(fp16_t));
  mfloat16m2_t fp16_ts2_m2 = mlce16_m2(fp16_src2_m2, 16 * sizeof(fp16_t));
  mfloat16m2_t fp16_out_m2 = mfmax_mm(fp16_ts1_m2, fp16_ts2_m2);
  msce16_m(fp16_out_m2, fp16_buffer, 16 * sizeof(fp16_t));
  EXCEPT_FP16_ARRAY_EQ(fp16_ans_m2, fp16_buffer, 24, "MFMAX.MM FP16   M2");
  // fp32
  msettype(E32, M2, BA);
  msettilemi(4);
  msettileni(8);
  const fp32_t fp32_src1_m2[] = {
      2.4259926e+38,  2.1661987e+38,  -7.3449765e+37, -1.7276011e+38,
      -1.7575777e+38, -1.2884004e+38, 3.0408628e+38,  2.0387397e+38,
      2.2033788e+38,  -5.1702042e+37, 1.6499942e+38,  -2.4802383e+38,
      1.3979542e+38,  -2.4074717e+38, -3.0738010e+38, 2.7269683e+38,
      1.5332678e+37,  -1.3193484e+38, 2.2461608e+38,  -1.7993434e+38,
      -8.5601910e+37, -9.6566266e+37, 3.0211684e+38,  3.2914891e+38,
      2.5451739e+38,  -3.3588459e+38, 2.9875819e+38,  1.2499478e+38,
      -1.8691770e+38, -2.1583776e+38, 1.6992016e+38,  1.4018130e+37};
  const fp32_t fp32_src2_m2[] = {
      3.1384919e+38,  1.1881581e+38,  -7.5865075e+37, 3.2809126e+38,
      2.1702537e+38,  -1.1798905e+38, 2.4177014e+38,  -2.4639059e+38,
      2.4856351e+38,  -6.1919205e+37, -3.1340465e+38, 1.9232878e+38,
      1.3892017e+38,  -2.9703039e+38, 2.5448800e+38,  1.7670372e+38,
      6.3664947e+37,  -5.8513844e+37, 9.5325088e+36,  -3.2292993e+38,
      -2.5251730e+38, 1.1079277e+38,  -7.9959384e+37, 5.0637672e+37,
      2.9370406e+38,  -3.3836953e+38, 2.1677355e+38,  3.2664222e+38,
      3.1061070e+38,  6.1725462e+37,  7.3037393e+37,  1.7143753e+38};
  const fp32_t fp32_ans_m2[] = {
      3.1384919e+38,  2.1661987e+38,  -7.3449765e+37, 3.2809126e+38,
      2.1702537e+38,  -1.1798905e+38, 3.0408628e+38,  2.0387397e+38,
      2.4856351e+38,  -5.1702042e+37, 1.6499942e+38,  1.9232878e+38,
      1.3979542e+38,  -2.4074717e+38, 2.5448800e+38,  2.7269683e+38,
      6.3664947e+37,  -5.8513844e+37, 2.2461608e+38,  -1.7993434e+38,
      -8.5601910e+37, 1.1079277e+38,  3.0211684e+38,  3.2914891e+38,
      2.9370406e+38,  -3.3588459e+38, 2.9875819e+38,  3.2664222e+38,
      3.1061070e+38,  6.1725462e+37,  1.6992016e+38,  1.7143753e+38};
  mfloat32m2_t fp32_ts1_m2 = mlce32_m2(fp32_src1_m2, 8 * sizeof(fp32_t));
  mfloat32m2_t fp32_ts2_m2 = mlce32_m2(fp32_src2_m2, 8 * sizeof(fp32_t));
  mfloat32m2_t fp32_out_m2 = mfmax_mm(fp32_ts1_m2, fp32_ts2_m2);
  msce32_m(fp32_out_m2, fp32_buffer, 8 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_EQ(fp32_ans_m2, fp32_buffer, 4 * 8, "MFMAX.MM FP32   M2");
  // fp64
  msettype(E64, M2, BA);
  msettilemi(5);
  msettileni(4);
  const fp64_t fp64_src1_m2[] = {
      1.76830926e+306,  6.03924838e+305,  -6.58522680e+305, 1.12087432e+305,
      -8.22814992e+301, -1.54850725e+306, -4.70405852e+305, 1.55465021e+306,
      8.05822755e+305,  -1.71607880e+305, 3.54813047e+305,  6.92368211e+305,
      1.34957309e+306,  -1.68025002e+306, -3.02440345e+305, -3.69235789e+303,
      -7.73088877e+305, 1.27936551e+306,  -2.70638279e+305, -4.26539068e+305};
  const fp64_t fp64_src2_m2[] = {
      1.50219255e+306,  1.65337023e+306,  -7.61199640e+305, 5.87531083e+305,
      -6.21536436e+305, 5.65731212e+305,  1.73427845e+306,  2.40161543e+305,
      -4.27498560e+305, 4.70031384e+305,  5.12098735e+305,  -9.17549495e+305,
      7.20582430e+305,  1.35035702e+306,  1.48392832e+306,  -1.11561906e+306,
      1.33956134e+306,  -6.87542802e+305, 5.34947995e+305,  -5.20524404e+305};
  const fp64_t fp64_ans_m2[] = {
      1.76830926e+306,  1.65337023e+306, -6.58522680e+305, 5.87531083e+305,
      -8.22814992e+301, 5.65731212e+305, 1.73427845e+306,  1.55465021e+306,
      8.05822755e+305,  4.70031384e+305, 5.12098735e+305,  6.92368211e+305,
      1.34957309e+306,  1.35035702e+306, 1.48392832e+306,  -3.69235789e+303,
      1.33956134e+306,  1.27936551e+306, 5.34947995e+305,  -4.26539068e+305};
  mfloat64m2_t fp64_ts1_m2 = mlce64_m2(fp64_src1_m2, 4 * sizeof(fp64_t));
  mfloat64m2_t fp64_ts2_m2 = mlce64_m2(fp64_src2_m2, 4 * sizeof(fp64_t));
  mfloat64m2_t fp64_out_m2 = mfmax_mm(fp64_ts1_m2, fp64_ts2_m2);
  msce64_m(fp64_out_m2, fp64_buffer, 4 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_EQ(fp64_ans_m2, fp64_buffer, 5 * 4, "MFMAX.MM FP64   M2");
  // M4
  // fp16
  msettype(E16, M4, BA);
  msettilemi(3);
  msettileni(17);
  const fp16_t fp16_src1_m4[] = {
      -3238.,  23376.,  -23088., -3806.,  -24352., -29152., 26688.,  9512.,
      -25536., 16992.,  53472.,  -35072., 3610.,   30512.,  45088.,  -7256.,
      -18720., 13368.,  8336.,   36960.,  -16048., -62208., -36064., 52992.,
      -9608.,  2498.,   3838.,   -63040., 11872.,  29664.,  -62720., 54944.,
      63232.,  -15736., -54560., 40896.,  -54656., -13584., -39488., -46400.,
      44352.,  44800.,  -1862.,  49536.,  38784.,  -27616., 24496.,  18112.,
      -3112.,  -35520., -40192.};
  const fp16_t fp16_src2_m4[] = {
      -25216., -10576., -13112., 12856.,  -26192., -13928., -1708.,  43136.,
      -59680., -32656., 8100.,   -45408., -51744., 23696.,  -36896., -17088.,
      -58208., -27552., 62176.,  -56224., -49120., 53952.,  31456.,  8296.,
      38784.,  -5232.,  -61152., 8616.,   -37888., 11096.,  -22736., -39712.,
      -13704., -21840., 56672.,  49056.,  13152.,  41216.,  -39456., 63104.,
      12544.,  -546.5,  -60928., 9336.,   49632.,  41952.,  60320.,  28416.,
      -10336., -21360., -8776.};
  const fp16_t fp16_ans_m4[] = {
      -3238.,  23376.,  -13112., 12856.,  -24352., -13928., 26688.,  43136.,
      -25536., 16992.,  53472.,  -35072., 3610.,   30512.,  45088.,  -7256.,
      -18720., 13368.,  62176.,  36960.,  -16048., 53952.,  31456.,  52992.,
      38784.,  2498.,   3838.,   8616.,   11872.,  29664.,  -22736., 54944.,
      63232.,  -15736., 56672.,  49056.,  13152.,  41216.,  -39456., 63104.,
      44352.,  44800.,  -1862.,  49536.,  49632.,  41952.,  60320.,  28416.,
      -3112.,  -21360., -8776.};
  mfloat16m4_t fp16_ts1_m4 = mlce16_m4(fp16_src1_m4, 17 * sizeof(fp16_t));
  mfloat16m4_t fp16_ts2_m4 = mlce16_m4(fp16_src2_m4, 17 * sizeof(fp16_t));
  mfloat16m4_t fp16_out_m4 = mfmax_mm(fp16_ts1_m4, fp16_ts2_m4);
  msce16_m(fp16_out_m4, fp16_buffer, 17 * sizeof(fp16_t));
  EXCEPT_FP16_ARRAY_EQ(fp16_ans_m4, fp16_buffer, 3 * 17, "MFMAX.MM FP16   M4");
  // fp32
  msettype(E32, M4, BA);
  msettilemi(4);
  msettileni(9);
  const fp32_t fp32_src1_m4[] = {
      2.4043665e+38,  -1.2787262e+38, 2.7773880e+38,  -2.0351181e+38,
      -3.0797618e+38, -8.6378756e+37, 2.7569847e+38,  1.7453362e+38,
      -8.6465494e+37, 1.8028117e+38,  -1.6717509e+38, -7.4916426e+37,
      -2.0466945e+38, 3.2694749e+38,  8.1205768e+37,  -1.9948612e+38,
      -1.0839902e+38, 2.5501595e+38,  -3.6849533e+37, 1.5647348e+38,
      7.3300273e+37,  3.1201295e+38,  -2.4588290e+38, 4.9233156e+37,
      -3.2026896e+38, 4.9894520e+37,  1.2155564e+38,  -1.2375921e+38,
      -1.9767514e+38, 1.3756097e+38,  -2.2995894e+38, -1.5967804e+38,
      -1.3388152e+38, 2.9437522e+38,  4.8935015e+37,  9.2365221e+37};
  const fp32_t fp32_src2_m4[] = {
      3.3411879e+38,  2.0638577e+38,  -1.5371271e+38, -2.4871295e+38,
      -1.3339463e+38, -1.6153714e+38, -1.0610361e+36, -1.4976083e+38,
      -2.6986395e+38, 2.5676902e+38,  -2.6491490e+38, -3.0086024e+38,
      2.5359867e+38,  -1.7023043e+38, -1.9261219e+38, -1.3284559e+38,
      2.0859805e+38,  5.6378421e+37,  1.2111452e+38,  2.2126028e+38,
      -3.5450858e+37, -1.6329770e+38, -2.4073512e+38, -4.4260959e+37,
      3.0879781e+37,  -2.9922785e+38, 3.5667335e+37,  1.6872677e+38,
      1.0457881e+38,  2.1474859e+38,  -2.5630623e+38, 3.1539380e+38,
      -7.5898582e+37, -2.6361370e+38, 1.4243194e+38,  -2.9178696e+38};
  const fp32_t fp32_ans_m4[] = {
      3.3411879e+38,  2.0638577e+38,  2.7773880e+38,  -2.0351181e+38,
      -1.3339463e+38, -8.6378756e+37, 2.7569847e+38,  1.7453362e+38,
      -8.6465494e+37, 2.5676902e+38,  -1.6717509e+38, -7.4916426e+37,
      2.5359867e+38,  3.2694749e+38,  8.1205768e+37,  -1.3284559e+38,
      2.0859805e+38,  2.5501595e+38,  1.2111452e+38,  2.2126028e+38,
      7.3300273e+37,  3.1201295e+38,  -2.4073512e+38, 4.9233156e+37,
      3.0879781e+37,  4.9894520e+37,  1.2155564e+38,  1.6872677e+38,
      1.0457881e+38,  2.1474859e+38,  -2.2995894e+38, 3.1539380e+38,
      -7.5898582e+37, 2.9437522e+38,  1.4243194e+38,  9.2365221e+37};
  mfloat32m4_t fp32_ts1_m4 = mlce32_m4(fp32_src1_m4, 9 * sizeof(fp32_t));
  mfloat32m4_t fp32_ts2_m4 = mlce32_m4(fp32_src2_m4, 9 * sizeof(fp32_t));
  mfloat32m4_t fp32_out_m4 = mfmax_mm(fp32_ts1_m4, fp32_ts2_m4);
  msce32_m(fp32_out_m4, fp32_buffer, 9 * sizeof(fp32_t));
  EXCEPT_FP32_ARRAY_EQ(fp32_ans_m4, fp32_buffer, 4 * 9, "MFMAX.MM FP32   M4");
  // fp64
  msettype(E64, M4, BA);
  msettilemi(5);
  msettileni(5);
  const fp64_t fp64_src1_m4[] = {
      -1.13147706e+40, 1.59853686e+40, 1.07506053e+41, 5.43120486e+40,
      1.08951315e+41,  5.24579418e+40, 2.08104235e+41, 8.55855061e+40,
      2.07762838e+41,  1.36569561e+41, 4.51400728e+40, 1.49531585e+41,
      -1.27329659e+40, 3.34647332e+40, 1.87548497e+41, 1.66878972e+41,
      3.25604023e+41,  1.93674765e+41, 9.65858679e+40, 1.59962742e+41,
      -2.51517510e+40, 2.57793717e+41, 2.31836157e+41, 2.75587614e+41,
      2.92669701e+41};
  const fp64_t fp64_src2_m4[] = {
      1.27918897e+41,  -1.89693184e+39, 4.63464588e+40, 9.79005769e+40,
      7.21616361e+40,  7.65370246e+40,  2.84823209e+41, 2.52382971e+41,
      -3.15660974e+40, 6.15351119e+40,  2.19621263e+41, 2.00399163e+41,
      2.57517674e+41,  4.78371987e+40,  1.23660021e+41, -8.50407832e+39,
      7.24412393e+40,  1.30389775e+41,  3.88394748e+40, 1.48525602e+41,
      7.77558706e+40,  4.74822169e+40,  1.94283684e+41, 2.58172144e+41,
      1.24916539e+41};
  const fp64_t fp64_ans_m4[] = {
      1.27918897e+41, 1.59853686e+40, 1.07506053e+41, 9.79005769e+40,
      1.08951315e+41, 7.65370246e+40, 2.84823209e+41, 2.52382971e+41,
      2.07762838e+41, 1.36569561e+41, 2.19621263e+41, 2.00399163e+41,
      2.57517674e+41, 4.78371987e+40, 1.87548497e+41, 1.66878972e+41,
      3.25604023e+41, 1.93674765e+41, 9.65858679e+40, 1.59962742e+41,
      7.77558706e+40, 2.57793717e+41, 2.31836157e+41, 2.75587614e+41,
      2.92669701e+41};
  mfloat64m4_t fp64_ts1_m4 = mlce64_m4(fp64_src1_m4, 5 * sizeof(fp64_t));
  mfloat64m4_t fp64_ts2_m4 = mlce64_m4(fp64_src2_m4, 5 * sizeof(fp64_t));
  mfloat64m4_t fp64_out_m4 = mfmax_mm(fp64_ts1_m4, fp64_ts2_m4);
  msce64_m(fp64_out_m4, fp64_buffer, 5 * sizeof(fp64_t));
  EXCEPT_FP64_ARRAY_EQ(fp64_ans_m4, fp64_buffer, 5 * 5, "MFMAX.MM FP64   M4");
}

int main() {
  test_mmaxu_mm();
  test_mmax_mm();
  test_mfmax_mm();
  return 0;
}